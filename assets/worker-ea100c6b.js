class Os{constructor(){this._listeners={}}addEventListener(e,r){const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].indexOf(r)===-1&&n[e].push(r),this}removeEventListener(e,r){if(this._listeners===void 0)return this;const s=this._listeners[e];if(s!==void 0){const a=s.indexOf(r);a!==-1&&s.splice(a,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const n=this._listeners[e.type];if(n!==void 0){const s=n.slice(0);for(let a=0,c=s.length;a<c;a++)s[a].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class gr extends Os{constructor(e,r,n,s={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=r,this._child=n,this._attributes=s,!r.isOnGraph(n))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class fh extends Os{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(r=>r.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(r=>r.getChild())}disconnectParents(e,r){let n=this.listParentEdges(e);return r&&(n=n.filter(s=>r(s.getParent()))),n.forEach(s=>s.dispose()),this}createEdge(e,r,n,s){return this._registerEdge(new gr(e,r,n,s))}_registerEdge(e){this._edges.add(e);const r=e.getParent();this._parentEdges.has(r)||this._parentEdges.set(r,new Set),this._parentEdges.get(r).add(e);const n=e.getChild();return this._childEdges.has(n)||this._childEdges.set(n,new Set),this._childEdges.get(n).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function Lr(){return Lr=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Lr.apply(this,arguments)}function gs(t){return t instanceof gr}function Or(t){return Array.isArray(t)&&t[0]instanceof gr}function Dr(t){return!!(hh(t)&&uh(t)instanceof gr)}function uh(t){for(const e in t)return t[e]}function hh(t){return!!t&&Object.getPrototypeOf(t)===Object.prototype}const we=Symbol("attributes"),ur=Symbol("immutableKeys");class Ds extends Os{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[we]=void 0,this[ur]=void 0,this.graph=e,this[ur]=new Set,this[we]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),r={};for(const n in e){const s=e[n];if(s instanceof Ds){const a=this.graph.createEdge(n,this,s);a.addEventListener("dispose",()=>s.dispose()),this[ur].add(n),r[n]=a}else r[n]=s}return r}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,r){for(const n in this[we]){const s=this[we][n];if(gs(s)){const a=s;a.getChild()===e&&this.setRef(n,r,a.getAttributes())}else if(Or(s)){const c=s.find(f=>f.getChild()===e);if(c){const f=c.getAttributes();this.removeRef(n,e).addRef(n,r,f)}}else if(Dr(s)){const a=s;for(const c in a){const f=a[c];f.getChild()===e&&this.setRefMap(n,c,r,f.getAttributes())}}}return this}get(e){return this[we][e]}set(e,r){return this[we][e]=r,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const r=this[we][e];return r?r.getChild():null}setRef(e,r,n){if(this[ur].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const s=this[we][e];if(s&&s.dispose(),!r)return this;const a=this.graph.createEdge(e,this,r,n);return a.addEventListener("dispose",()=>{delete this[we][e],this.dispatchEvent({type:"change",attribute:e})}),this[we][e]=a,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[we][e].map(n=>n.getChild())}addRef(e,r,n){const s=this.graph.createEdge(e,this,r,n),a=this[we][e];return a.push(s),s.addEventListener("dispose",()=>{let c;for(;(c=a.indexOf(s))!==-1;)a.splice(c,1);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,r){return this[we][e].filter(a=>a.getChild()===r).forEach(a=>a.dispose()),this}listRefMapKeys(e){return Object.keys(this[we][e])}listRefMapValues(e){return Object.values(this[we][e]).map(r=>r.getChild())}getRefMap(e,r){const n=this[we][e];return n[r]?n[r].getChild():null}setRefMap(e,r,n,s){const a=this[we][e],c=a[r];if(c&&c.dispose(),!n)return this;s=Object.assign(s||{},{key:r});const f=this.graph.createEdge(e,this,n,Lr({},s,{key:r}));return f.addEventListener("dispose",()=>{delete a[r],this.dispatchEvent({type:"change",attribute:e,key:r})}),a[r]=f,this.dispatchEvent({type:"change",attribute:e,key:r})}dispatchEvent(e){return super.dispatchEvent(Lr({},e,{target:this})),this.graph.dispatchEvent(Lr({},e,{target:this,type:`node:${e.type}`})),this}}const Sa="v3.8.0",mr="@glb.bin";var W,Mn,tt,ht,Jt;(function(t){t.ACCESSOR="Accessor",t.ANIMATION="Animation",t.ANIMATION_CHANNEL="AnimationChannel",t.ANIMATION_SAMPLER="AnimationSampler",t.BUFFER="Buffer",t.CAMERA="Camera",t.MATERIAL="Material",t.MESH="Mesh",t.PRIMITIVE="Primitive",t.PRIMITIVE_TARGET="PrimitiveTarget",t.NODE="Node",t.ROOT="Root",t.SCENE="Scene",t.SKIN="Skin",t.TEXTURE="Texture",t.TEXTURE_INFO="TextureInfo"})(W||(W={})),function(t){t.INTERLEAVED="interleaved",t.SEPARATE="separate"}(Mn||(Mn={})),function(t){t.ARRAY_BUFFER="ARRAY_BUFFER",t.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",t.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",t.OTHER="OTHER",t.SPARSE="SPARSE"}(tt||(tt={})),function(t){t[t.R=4096]="R",t[t.G=256]="G",t[t.B=16]="B",t[t.A=1]="A"}(ht||(ht={})),function(t){t.GLTF="GLTF",t.GLB="GLB"}(Jt||(Jt={}));const _n={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var dn,ms=typeof Float32Array<"u"?Float32Array:Array;function cs(t){return Math.hypot(t[0],t[1],t[2])}function dh(t,e,r){var n=e[0],s=e[1],a=e[2],c=r[3]*n+r[7]*s+r[11]*a+r[15];return t[0]=(r[0]*n+r[4]*s+r[8]*a+r[12])/(c=c||1),t[1]=(r[1]*n+r[5]*s+r[9]*a+r[13])/c,t[2]=(r[2]*n+r[6]*s+r[10]*a+r[14])/c,t}function ph(t){const e={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},r=t.propertyType===W.NODE?[t]:t.listChildren();for(const n of r)n.traverse(s=>{const a=s.getMesh();if(!a)return;const c=gh(a,s.getWorldMatrix());vs(c.min,e),vs(c.max,e)});return e}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),dn=new ms(3),ms!=Float32Array&&(dn[0]=0,dn[1]=0,dn[2]=0);function gh(t,e){const r={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const n of t.listPrimitives()){const s=n.getAttribute("POSITION");if(!s)continue;let a=[0,0,0],c=[0,0,0];for(let f=0;f<s.getCount();f++)a=s.getElement(f,a),c=dh(c,a,e),vs(c,r)}return r}function vs(t,e){for(let r=0;r<3;r++)e.min[r]=Math.min(t[r],e.min[r]),e.max[r]=Math.max(t[r],e.max[r])}class ae{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const r=atob(e.split(",")[1]),n=new Uint8Array(r.length);for(let s=0;s<r.length;s++)n[s]=r.charCodeAt(s);return n}{const r=e.split(",")[1],n=e.indexOf("base64")>=0;return Buffer.from(r,n?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let r=0;for(const a of e)r+=a.byteLength;const n=new Uint8Array(r);let s=0;for(const a of e)n.set(a,s),s+=a.byteLength;return n}static pad(e,r=0){const n=this.padNumber(e.byteLength);if(n===e.byteLength)return e;const s=new Uint8Array(n);if(s.set(e),r!==0)for(let a=e.byteLength;a<n;a++)s[a]=r;return s}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,r){if(e===r)return!0;if(e.byteLength!==r.byteLength)return!1;let n=e.byteLength;for(;n--;)if(e[n]!==r[n])return!1;return!0}static toView(e,r=0,n=1/0){return new Uint8Array(e.buffer,e.byteOffset+r,Math.min(e.byteLength,n))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}let Ze=class{static hexToFactor(e,r){e=Math.floor(e);const n=r;return n[0]=(e>>16&255)/255,n[1]=(e>>8&255)/255,n[2]=(255&e)/255,this.convertSRGBToLinear(r,r)}static factorToHex(e){const r=[...e],[n,s,a]=this.convertLinearToSRGB(e,r);return 255*n<<16^255*s<<8^255*a<<0}static convertSRGBToLinear(e,r){const n=e,s=r;for(let a=0;a<3;a++)s[a]=n[a]<.04045?.0773993808*n[a]:Math.pow(.9478672986*n[a]+.0521327014,2.4);return r}static convertLinearToSRGB(e,r){const n=e,s=r;for(let a=0;a<3;a++)s[a]=n[a]<.0031308?12.92*n[a]:1.055*Math.pow(n[a],.41666)-.055;return r}},Ca=class Na{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const r=new DataView(e.buffer,e.byteOffset);return ae.decodeText(e.slice(12,16))===Na.PNG_FRIED_CHUNK_NAME?[r.getUint32(32,!1),r.getUint32(36,!1)]:[r.getUint32(16,!1),r.getUint32(20,!1)]}getChannels(e){return 4}};Ca.PNG_FRIED_CHUNK_NAME="CgBI";let xt=class{static registerFormat(e,r){this.impls[e]=r}static getMimeType(e){for(const r in this.impls)if(this.impls[r].match(e))return r;return null}static getSize(e,r){return this.impls[r]?this.impls[r].getSize(e):null}static getChannels(e,r){return this.impls[r]?this.impls[r].getChannels(e):null}static getVRAMByteLength(e,r){if(!this.impls[r])return null;if(this.impls[r].getVRAMByteLength)return this.impls[r].getVRAMByteLength(e);let n=0;const s=this.getSize(e,r);if(!s)return null;for(;s[0]>1||s[1]>1;)n+=s[0]*s[1]*4,s[0]=Math.max(Math.floor(s[0]/2),1),s[1]=Math.max(Math.floor(s[1]/2),1);return n+=4,n}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}};function mh(t,e){if(e>t.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(t.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return t}xt.impls={"image/jpeg":new class{match(t){return t.length>=3&&t[0]===255&&t[1]===216&&t[2]===255}getSize(t){let e,r,n=new DataView(t.buffer,t.byteOffset+4);for(;n.byteLength;){if(e=n.getUint16(0,!1),mh(n,e),r=n.getUint8(e+1),r===192||r===193||r===194)return[n.getUint16(e+7,!1),n.getUint16(e+5,!1)];n=new DataView(t.buffer,n.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(t){return 3}},"image/png":new Ca};let vr=class{static basename(e){const r=e.split(/[\\/]/).pop();return r.substring(0,r.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const r=e.match(/data:(image\/\w+)/)[1];return xt.mimeTypeToExtension(r)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}};function Zi(t){return Object.prototype.toString.call(t)==="[object Object]"}function Yt(t){if(Zi(t)===!1)return!1;const e=t.constructor;if(e===void 0)return!0;const r=e.prototype;return Zi(r)!==!1&&Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")!==!1}var ls,ys;(function(t){t[t.SILENT=4]="SILENT",t[t.ERROR=3]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=1]="INFO",t[t.DEBUG=0]="DEBUG"})(ys||(ys={}));let Zt=class $r{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=$r.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=$r.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=$r.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=$r.Verbosity.ERROR&&console.error(e)}};function vh(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],x=e[8],w=e[9],M=e[10],A=e[11],F=e[12],m=e[13],C=e[14],T=e[15],_=r[0],b=r[1],N=r[2],$=r[3];return t[0]=_*n+b*f+N*x+$*F,t[1]=_*s+b*h+N*w+$*m,t[2]=_*a+b*d+N*M+$*C,t[3]=_*c+b*g+N*A+$*T,t[4]=(_=r[4])*n+(b=r[5])*f+(N=r[6])*x+($=r[7])*F,t[5]=_*s+b*h+N*w+$*m,t[6]=_*a+b*d+N*M+$*C,t[7]=_*c+b*g+N*A+$*T,t[8]=(_=r[8])*n+(b=r[9])*f+(N=r[10])*x+($=r[11])*F,t[9]=_*s+b*h+N*w+$*m,t[10]=_*a+b*d+N*M+$*C,t[11]=_*c+b*g+N*A+$*T,t[12]=(_=r[12])*n+(b=r[13])*f+(N=r[14])*x+($=r[15])*F,t[13]=_*s+b*h+N*w+$*m,t[14]=_*a+b*d+N*M+$*C,t[15]=_*c+b*g+N*A+$*T,t}ls=Zt,Zt.Verbosity=ys,Zt.DEFAULT_INSTANCE=new ls(ls.Verbosity.INFO);let Ne=class xs{static identity(e){return e}static eq(e,r,n=1e-5){if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(Math.abs(e[s]-r[s])>n)return!1;return!0}static decodeNormalizedInt(e,r){switch(r){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static denormalize(e,r){return xs.decodeNormalizedInt(e,r)}static encodeNormalizedInt(e,r){switch(r){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static normalize(e,r){return xs.encodeNormalizedInt(e,r)}static decompose(e,r,n,s){let a=cs([e[0],e[1],e[2]]);const c=cs([e[4],e[5],e[6]]),f=cs([e[8],e[9],e[10]]);var h,d,g,x,w,M,A,F,m,C,T,_,b,N,$,z,B;((d=(h=e)[0])*(A=h[5])-(g=h[1])*(M=h[4]))*((_=h[10])*(B=h[15])-(b=h[11])*(z=h[14]))-(d*(F=h[6])-(x=h[2])*M)*((T=h[9])*B-b*($=h[13]))+(d*(m=h[7])-(w=h[3])*M)*(T*z-_*$)+(g*F-x*A)*((C=h[8])*B-b*(N=h[12]))-(g*m-w*A)*(C*z-_*N)+(x*m-w*F)*(C*$-T*N)<0&&(a=-a),r[0]=e[12],r[1]=e[13],r[2]=e[14];const k=e.slice(),G=1/a,H=1/c,K=1/f;k[0]*=G,k[1]*=G,k[2]*=G,k[4]*=H,k[5]*=H,k[6]*=H,k[8]*=K,k[9]*=K,k[10]*=K,function(L,U){var ee=new ms(3);(function(dt,ze){var qe=ze[4],Nt=ze[5],It=ze[6],rr=ze[8],Tt=ze[9],Yr=ze[10];dt[0]=Math.hypot(ze[0],ze[1],ze[2]),dt[1]=Math.hypot(qe,Nt,It),dt[2]=Math.hypot(rr,Tt,Yr)})(ee,U);var fe=1/ee[0],re=1/ee[1],ye=1/ee[2],me=U[0]*fe,xe=U[1]*re,Te=U[2]*ye,_e=U[4]*fe,ke=U[5]*re,be=U[6]*ye,Se=U[8]*fe,Qe=U[9]*re,Ve=U[10]*ye,rt=me+ke+Ve,Ce=0;rt>0?(Ce=2*Math.sqrt(rt+1),L[3]=.25*Ce,L[0]=(be-Qe)/Ce,L[1]=(Se-Te)/Ce,L[2]=(xe-_e)/Ce):me>ke&&me>Ve?(Ce=2*Math.sqrt(1+me-ke-Ve),L[3]=(be-Qe)/Ce,L[0]=.25*Ce,L[1]=(xe+_e)/Ce,L[2]=(Se+Te)/Ce):ke>Ve?(Ce=2*Math.sqrt(1+ke-me-Ve),L[3]=(Se-Te)/Ce,L[0]=(xe+_e)/Ce,L[1]=.25*Ce,L[2]=(be+Qe)/Ce):(Ce=2*Math.sqrt(1+Ve-me-ke),L[3]=(xe-_e)/Ce,L[0]=(Se+Te)/Ce,L[1]=(be+Qe)/Ce,L[2]=.25*Ce)}(n,k),s[0]=a,s[1]=c,s[2]=f}static compose(e,r,n,s){const a=s,c=r[0],f=r[1],h=r[2],d=r[3],g=c+c,x=f+f,w=h+h,M=c*g,A=c*x,F=c*w,m=f*x,C=f*w,T=h*w,_=d*g,b=d*x,N=d*w,$=n[0],z=n[1],B=n[2];return a[0]=(1-(m+T))*$,a[1]=(A+N)*$,a[2]=(F-b)*$,a[3]=0,a[4]=(A-N)*z,a[5]=(1-(M+T))*z,a[6]=(C+_)*z,a[7]=0,a[8]=(F+b)*B,a[9]=(C-_)*B,a[10]=(1-(M+m))*B,a[11]=0,a[12]=e[0],a[13]=e[1],a[14]=e[2],a[15]=1,a}};function yh(t,e){if(!!t!=!!e)return!1;const r=t.getChild(),n=e.getChild();return r===n||r.equals(n)}function xh(t,e){if(!!t!=!!e||t.length!==e.length)return!1;for(let r=0;r<t.length;r++){const n=t[r],s=e[r];if(n.getChild()!==s.getChild()&&!n.getChild().equals(s.getChild()))return!1}return!0}function Th(t,e){if(!!t!=!!e)return!1;const r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(const s in t){const a=t[s],c=e[s];if(!!a!=!!c)return!1;const f=a.getChild(),h=c.getChild();if(f!==h&&!f.equals(h))return!1}return!0}function Fa(t,e){if(t===e)return!0;if(!!t!=!!e||!t||!e||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Oa(t,e){if(t===e)return!0;if(!!t!=!!e)return!1;if(!Yt(t)||!Yt(e))return t===e;const r=t,n=e;let s,a=0,c=0;for(s in r)a++;for(s in n)c++;if(a!==c)return!1;for(s in r){const f=r[s],h=n[s];if(Rn(f)&&Rn(h)){if(!Fa(f,h))return!1}else if(Yt(f)&&Yt(h)){if(!Oa(f,h))return!1}else if(f!==h)return!1}return!0}function Rn(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const Qi=new Set,Eh=function(){let t="";for(let e=0;e<6;e++)t+="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ".charAt(Math.floor(42*Math.random()));return t},wh=function(){for(let t=0;t<999;t++){const e=Eh();if(!Qi.has(e))return Qi.add(e),e}return""},ea="https://null.example";let jr=class{static dirname(e){const r=e.lastIndexOf("/");return r===-1?"./":e.substring(0,r+1)}static basename(e){return vr.basename(new URL(e,ea).pathname)}static extension(e){return vr.extension(new URL(e,ea).pathname)}static resolve(e,r){if(!this.isRelativePath(r))return r;const n=e.split("/"),s=r.split("/");n.pop();for(let a=0;a<s.length;a++)s[a]!=="."&&(s[a]===".."?n.pop():n.push(s[a]));return n.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}};jr.DEFAULT_INIT={},jr.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const At=t=>t,Mh=new Set;let $s=class extends Ds{constructor(e,r=""){super(e),this[we].name=r,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,r){return Array.isArray(r)&&(r=r.slice()),super.set(e,r)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,At)}copy(e,r=At){for(const n in this[we]){const s=this[we][n];if(s instanceof gr)this[ur].has(n)||s.dispose();else if(Or(s))for(const a of s)a.dispose();else if(Dr(s))for(const a in s)s[a].dispose()}for(const n in e[we]){const s=this[we][n],a=e[we][n];if(a instanceof gr)this[ur].has(n)?s.getChild().copy(r(a.getChild()),r):this.setRef(n,r(a.getChild()),a.getAttributes());else if(Or(a))for(const c of a)this.addRef(n,r(c.getChild()),c.getAttributes());else if(Dr(a))for(const c in a){const f=a[c];this.setRefMap(n,c,r(f.getChild()),f.getAttributes())}else this[we][n]=Yt(a)?JSON.parse(JSON.stringify(a)):Array.isArray(a)||a instanceof ArrayBuffer||ArrayBuffer.isView(a)?a.slice():a}return this}equals(e,r=Mh){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const n in this[we]){if(r.has(n))continue;const s=this[we][n],a=e[we][n];if(gs(s)||gs(a)){if(!yh(s,a))return!1}else if(Or(s)||Or(a)){if(!xh(s,a))return!1}else if(Dr(s)||Dr(a)){if(!Th(s,a))return!1}else if(Yt(s)||Yt(a)){if(!Oa(s,a))return!1}else if(Rn(s)||Rn(a)){if(!Fa(s,a))return!1}else if(s!==a)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}},Je=class extends $s{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,r){return r&&r.t(this),this.setRefMap("extensions",e,r)}listExtensions(){return this.listRefMapValues("extensions")}},te=class Ae extends Je{constructor(...e){super(...e),this.i=Ne.identity,this.o=Ne.identity}init(){this.propertyType=W.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:Ae.Type.SCALAR,componentType:Ae.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}copy(e,r=At){return super.copy(e,r),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case Ae.Type.SCALAR:return 1;case Ae.Type.VEC2:return 2;case Ae.Type.VEC3:return 3;case Ae.Type.VEC4:case Ae.Type.MAT2:return 4;case Ae.Type.MAT3:return 9;case Ae.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case Ae.ComponentType.BYTE:case Ae.ComponentType.UNSIGNED_BYTE:return 1;case Ae.ComponentType.SHORT:case Ae.ComponentType.UNSIGNED_SHORT:return 2;case Ae.ComponentType.UNSIGNED_INT:case Ae.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const r=this.getElementSize();this.getMin(e);for(let n=0;n<r;n++)e[n]=this.o(e[n]);return e}getMin(e){const r=this.get("array"),n=this.getCount(),s=this.getElementSize();for(let a=0;a<s;a++)e[a]=1/0;for(let a=0;a<n*s;a+=s)for(let c=0;c<s;c++){const f=r[a+c];Number.isFinite(f)&&(e[c]=Math.min(e[c],f))}return e}getMaxNormalized(e){const r=this.getElementSize();this.getMax(e);for(let n=0;n<r;n++)e[n]=this.o(e[n]);return e}getMax(e){const r=this.get("array"),n=this.getCount(),s=this.getElementSize();for(let a=0;a<s;a++)e[a]=-1/0;for(let a=0;a<n*s;a+=s)for(let c=0;c<s;c++){const f=r[a+c];Number.isFinite(f)&&(e[c]=Math.max(e[c],f))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return Ae.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=r=>Ne.decodeNormalizedInt(r,this.get("componentType")),this.i=r=>Ne.encodeNormalizedInt(r,this.get("componentType"))):(this.o=Ne.identity,this.i=Ne.identity),this}getScalar(e){const r=this.getElementSize();return this.o(this.get("array")[e*r])}setScalar(e,r){return this.get("array")[e*this.getElementSize()]=this.i(r),this}getElement(e,r){const n=this.getElementSize(),s=this.get("array");for(let a=0;a<n;a++)r[a]=this.o(s[e*n+a]);return r}setElement(e,r){const n=this.getElementSize(),s=this.get("array");for(let a=0;a<n;a++)s[e*n+a]=this.i(r[a]);return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(r){switch(r.constructor){case Float32Array:return Ae.ComponentType.FLOAT;case Uint32Array:return Ae.ComponentType.UNSIGNED_INT;case Uint16Array:return Ae.ComponentType.UNSIGNED_SHORT;case Uint8Array:return Ae.ComponentType.UNSIGNED_BYTE;case Int16Array:return Ae.ComponentType.SHORT;case Int8Array:return Ae.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):Ae.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}};te.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},te.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};let Da=class extends Je{init(){this.propertyType=W.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}},Ps=class extends Je{init(){this.propertyType=W.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}};Ps.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};let Pn=class $a extends Je{init(){this.propertyType=W.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:$a.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:tt.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:tt.OTHER})}};Pn.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};let Pa=class extends Je{init(){this.propertyType=W.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}},Xr=class ka extends Je{init(){this.propertyType=W.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:ka.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}};Xr.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};let $e=class extends $s{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}};$e.EXTENSION_NAME=void 0;let Fe=class Ts extends Je{init(){this.propertyType=W.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:Ts.WrapMode.REPEAT,wrapT:Ts.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}};Fe.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Fe.MagFilter={NEAREST:9728,LINEAR:9729},Fe.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:pn,G:gn,B:mn,A:_h}=ht;let yr=class Ua extends Je{init(){this.propertyType=W.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:Ua.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Fe(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Fe(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Fe(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Fe(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Fe(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const r=this.get("baseColorFactor").slice();return r[3]=e,this.set("baseColorFactor",r)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return Ze.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const r=this.get("baseColorFactor").slice();return this.set("baseColorFactor",Ze.hexToFactor(e,r))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:pn|gn|mn|_h,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return Ze.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const r=this.get("emissiveFactor").slice();return this.set("emissiveFactor",Ze.hexToFactor(e,r))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:pn|gn|mn,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:pn|gn|mn})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:pn})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:gn|mn})}};yr.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};let La=class extends Je{init(){this.propertyType=W.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}},ja=class extends Je{constructor(...e){super(...e),this.u=null,this.h=new Set}init(){this.propertyType=W.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,r=At){if(r===At)throw new Error("Node cannot be copied.");return super.copy(e,r)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Ne.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const r=this.get("translation").slice(),n=this.get("rotation").slice(),s=this.get("scale").slice();return Ne.decompose(e,r,n,s),this.set("translation",r).set("rotation",n).set("scale",s)}getWorldTranslation(){const e=[0,0,0];return Ne.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Ne.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Ne.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let s=this;s!=null;s=s.u)e.push(s);let r;const n=e.pop().getMatrix();for(;r=e.pop();)vh(n,n,r.getMatrix());return n}addChild(e){if(e.u&&e.u.removeChild(e),e.h.size)for(const n of e.h)n.removeChild(e);this.addRef("children",e),e.u=this;const r=this[we].children;return r[r.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u?this.u:this.listParents().find(e=>e.propertyType===W.SCENE)||null}getParentNode(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const r of this.listChildren())r.traverse(e);return this}},Gr=class Ba extends Je{init(){this.propertyType=W.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:Ba.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:tt.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:tt.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}};Gr.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};let Rh=class extends $s{init(){this.propertyType=W.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:tt.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}};function Ke(){return Ke=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Ke.apply(this,arguments)}let Va=class extends Je{init(){this.propertyType=W.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,r=At){if(r===At)throw new Error("Scene cannot be copied.");return super.copy(e,r)}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.h.add(this);const r=this[we].children;return r[r.length-1].addEventListener("dispose",()=>e.h.delete(this)),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const r of this.listChildren())r.traverse(e);return this}},za=class extends Je{init(){this.propertyType=W.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:tt.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}},Ga=class extends Je{init(){this.propertyType=W.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||xt.extensionToMimeType(vr.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const r=xt.extensionToMimeType(vr.extension(e));return r&&this.set("mimeType",r),this}getImage(){return this.get("image")}setImage(e){return this.set("image",ae.assertView(e))}getSize(){const e=this.get("image");return e?xt.getSize(e,this.getMimeType()):null}},Ha=class extends Je{init(){this.propertyType=W.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${Sa}`,version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.l=new Set,e.addEventListener("node:create",r=>{this.g(r.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,r=At){if(r===At)throw new Error("Root cannot be copied.");this.set("asset",Ke({},e.get("asset"))),this.setName(e.getName()),this.setExtras(Ke({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?r(e.getDefaultScene()):null);for(const n of e.listRefMapKeys("extensions")){const s=e.getExtension(n);this.setExtension(n,r(s))}return this}g(e){return e instanceof Va?this.addRef("scenes",e):e instanceof ja?this.addRef("nodes",e):e instanceof Xr?this.addRef("cameras",e):e instanceof za?this.addRef("skins",e):e instanceof La?this.addRef("meshes",e):e instanceof yr?this.addRef("materials",e):e instanceof Ga?this.addRef("textures",e):e instanceof Da?this.addRef("animations",e):e instanceof te?this.addRef("accessors",e):e instanceof Pa&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.l)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}p(e){return this.l.add(e),this}m(e){return this.l.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}},ks=class xn{static fromGraph(e){return xn.v.get(e)||null}constructor(){this.T=new fh,this.S=new Ha(this.T),this.M=Zt.DEFAULT_INSTANCE,xn.v.set(this.T,this)}getRoot(){return this.S}getGraph(){return this.T}getLogger(){return this.M}setLogger(e){return this.M=e,this}clone(){return new xn().setLogger(this.M).merge(this)}merge(e){for(const a of e.getRoot().listExtensionsUsed()){const c=this.createExtension(a.constructor);a.isRequired()&&c.setRequired(!0)}const r=new Set,n=new Map;r.add(e.S),n.set(e.S,this.S);for(const a of e.T.listEdges())for(const c of[a.getParent(),a.getChild()]){if(r.has(c))continue;let f;f=c.propertyType===W.TEXTURE_INFO?c:new c.constructor(this.T),n.set(c,f),r.add(c)}const s=a=>{const c=n.get(a);if(!c)throw new Error("Could resolve property.");return c};for(const a of r){const c=n.get(a);if(!c)throw new Error("Could resolve property.");c.propertyType!==W.TEXTURE_INFO&&c.copy(a,s)}return this}async transform(...e){const r=e.map(n=>n.name);for(const n of e)await n(this,{stack:r});return this}createExtension(e){const r=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(n=>n.extensionName===r)||new e(this)}createScene(e=""){return new Va(this.T,e)}createNode(e=""){return new ja(this.T,e)}createCamera(e=""){return new Xr(this.T,e)}createSkin(e=""){return new za(this.T,e)}createMesh(e=""){return new La(this.T,e)}createPrimitive(){return new Gr(this.T)}createPrimitiveTarget(e=""){return new Rh(this.T,e)}createMaterial(e=""){return new yr(this.T,e)}createTexture(e=""){return new Ga(this.T,e)}createAnimation(e=""){return new Da(this.T,e)}createAnimationChannel(e=""){return new Ps(this.T,e)}createAnimationSampler(e=""){return new Pn(this.T,e)}createAccessor(e="",r=null){return r||(r=this.getRoot().listBuffers()[0]),new te(this.T,e).setBuffer(r)}createBuffer(e=""){return new Pa(this.T,e)}};ks.v=new WeakMap;let Ie=class{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.I=void 0,this.document=e,e.getRoot().p(this),this.I=n=>{const s=n,a=s.target;a instanceof $e&&a.extensionName===this.extensionName&&(s.type==="node:create"&&this.N(a),s.type==="node:dispose"&&this.O(a))};const r=e.getGraph();r.addEventListener("node:create",this.I),r.addEventListener("node:dispose",this.I)}dispose(){this.document.getRoot().m(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.I),e.removeEventListener("node:dispose",this.I);for(const r of this.properties)r.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}N(e){return this.properties.add(e),this}O(e){return this.properties.delete(e),this}install(e,r){return this}preread(e,r){return this}prewrite(e,r){return this}};Ie.EXTENSION_NAME=void 0;let bh=class{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,r){this.textureInfos.set(e,r),r.texCoord!==void 0&&e.setTexCoord(r.texCoord),r.extras!==void 0&&e.setExtras(r.extras);const n=this.jsonDoc.json.textures[r.index];if(n.sampler===void 0)return;const s=this.jsonDoc.json.samplers[n.sampler];s.magFilter!==void 0&&e.setMagFilter(s.magFilter),s.minFilter!==void 0&&e.setMinFilter(s.minFilter),s.wrapS!==void 0&&e.setWrapS(s.wrapS),s.wrapT!==void 0&&e.setWrapT(s.wrapT)}};const ta={logger:Zt.DEFAULT_INSTANCE,extensions:[],dependencies:{}};let Ah=class{static read(e,r=ta){const n=Ke({},ta,r),{json:s}=e,a=new ks().setLogger(n.logger);this.validate(e,n);const c=new bh(e),f=s.asset,h=a.getRoot().getAsset();f.copyright&&(h.copyright=f.copyright),f.extras&&(h.extras=f.extras),s.extras!==void 0&&a.getRoot().setExtras(Ke({},s.extras));const d=s.extensionsUsed||[],g=s.extensionsRequired||[];for(const T of n.extensions)if(d.includes(T.EXTENSION_NAME)){const _=a.createExtension(T).setRequired(g.includes(T.EXTENSION_NAME));for(const b of _.readDependencies)_.install(b,n.dependencies[b])}const x=s.buffers||[];a.getRoot().listExtensionsUsed().filter(T=>T.prereadTypes.includes(W.BUFFER)).forEach(T=>T.preread(c,W.BUFFER)),c.buffers=x.map(T=>{const _=a.createBuffer(T.name);return T.extras&&_.setExtras(T.extras),T.uri&&T.uri.indexOf("__")!==0&&_.setURI(T.uri),_}),c.bufferViewBuffers=(s.bufferViews||[]).map((T,_)=>{if(!c.bufferViews[_]){const b=e.json.buffers[T.buffer];c.bufferViews[_]=ae.toView(b.uri?e.resources[b.uri]:e.resources[mr],T.byteOffset||0,T.byteLength)}return c.buffers[T.buffer]});const w=s.accessors||[];c.accessors=w.map(T=>{const _=a.createAccessor(T.name,c.bufferViewBuffers[T.bufferView]).setType(T.type);return T.extras&&_.setExtras(T.extras),T.normalized!==void 0&&_.setNormalized(T.normalized),T.bufferView===void 0||_.setArray(vn(T,c)),_});const M=s.images||[],A=s.textures||[];a.getRoot().listExtensionsUsed().filter(T=>T.prereadTypes.includes(W.TEXTURE)).forEach(T=>T.preread(c,W.TEXTURE)),c.textures=M.map(T=>{const _=a.createTexture(T.name);if(T.extras&&_.setExtras(T.extras),T.bufferView!==void 0){const b=s.bufferViews[T.bufferView],N=e.json.buffers[b.buffer],$=b.byteOffset||0,z=(N.uri?e.resources[N.uri]:e.resources[mr]).slice($,$+b.byteLength);_.setImage(z)}else T.uri!==void 0&&(_.setImage(e.resources[T.uri]),T.uri.indexOf("__")!==0&&_.setURI(T.uri));if(T.mimeType!==void 0)_.setMimeType(T.mimeType);else if(T.uri){const b=vr.extension(T.uri);_.setMimeType(xt.extensionToMimeType(b))}return _}),c.materials=(s.materials||[]).map(T=>{const _=a.createMaterial(T.name);T.extras&&_.setExtras(T.extras),T.alphaMode!==void 0&&_.setAlphaMode(T.alphaMode),T.alphaCutoff!==void 0&&_.setAlphaCutoff(T.alphaCutoff),T.doubleSided!==void 0&&_.setDoubleSided(T.doubleSided);const b=T.pbrMetallicRoughness||{};if(b.baseColorFactor!==void 0&&_.setBaseColorFactor(b.baseColorFactor),T.emissiveFactor!==void 0&&_.setEmissiveFactor(T.emissiveFactor),b.metallicFactor!==void 0&&_.setMetallicFactor(b.metallicFactor),b.roughnessFactor!==void 0&&_.setRoughnessFactor(b.roughnessFactor),b.baseColorTexture!==void 0){const N=b.baseColorTexture;_.setBaseColorTexture(c.textures[A[N.index].source]),c.setTextureInfo(_.getBaseColorTextureInfo(),N)}if(T.emissiveTexture!==void 0){const N=T.emissiveTexture;_.setEmissiveTexture(c.textures[A[N.index].source]),c.setTextureInfo(_.getEmissiveTextureInfo(),N)}if(T.normalTexture!==void 0){const N=T.normalTexture;_.setNormalTexture(c.textures[A[N.index].source]),c.setTextureInfo(_.getNormalTextureInfo(),N),T.normalTexture.scale!==void 0&&_.setNormalScale(T.normalTexture.scale)}if(T.occlusionTexture!==void 0){const N=T.occlusionTexture;_.setOcclusionTexture(c.textures[A[N.index].source]),c.setTextureInfo(_.getOcclusionTextureInfo(),N),T.occlusionTexture.strength!==void 0&&_.setOcclusionStrength(T.occlusionTexture.strength)}if(b.metallicRoughnessTexture!==void 0){const N=b.metallicRoughnessTexture;_.setMetallicRoughnessTexture(c.textures[A[N.index].source]),c.setTextureInfo(_.getMetallicRoughnessTextureInfo(),N)}return _});const F=s.meshes||[];a.getRoot().listExtensionsUsed().filter(T=>T.prereadTypes.includes(W.PRIMITIVE)).forEach(T=>T.preread(c,W.PRIMITIVE)),c.meshes=F.map(T=>{const _=a.createMesh(T.name);return T.extras&&_.setExtras(T.extras),T.weights!==void 0&&_.setWeights(T.weights),(T.primitives||[]).forEach(b=>{const N=a.createPrimitive();b.extras&&N.setExtras(b.extras),b.material!==void 0&&N.setMaterial(c.materials[b.material]),b.mode!==void 0&&N.setMode(b.mode);for(const[z,B]of Object.entries(b.attributes||{}))N.setAttribute(z,c.accessors[B]);b.indices!==void 0&&N.setIndices(c.accessors[b.indices]);const $=T.extras&&T.extras.targetNames||[];(b.targets||[]).forEach((z,B)=>{const k=$[B]||B.toString(),G=a.createPrimitiveTarget(k);for(const[H,K]of Object.entries(z))G.setAttribute(H,c.accessors[K]);N.addTarget(G)}),_.addPrimitive(N)}),_}),c.cameras=(s.cameras||[]).map(T=>{const _=a.createCamera(T.name).setType(T.type);if(T.extras&&_.setExtras(T.extras),T.type===Xr.Type.PERSPECTIVE){const b=T.perspective;_.setYFov(b.yfov),_.setZNear(b.znear),b.zfar!==void 0&&_.setZFar(b.zfar),b.aspectRatio!==void 0&&_.setAspectRatio(b.aspectRatio)}else{const b=T.orthographic;_.setZNear(b.znear).setZFar(b.zfar).setXMag(b.xmag).setYMag(b.ymag)}return _});const m=s.nodes||[];a.getRoot().listExtensionsUsed().filter(T=>T.prereadTypes.includes(W.NODE)).forEach(T=>T.preread(c,W.NODE)),c.nodes=m.map(T=>{const _=a.createNode(T.name);if(T.extras&&_.setExtras(T.extras),T.translation!==void 0&&_.setTranslation(T.translation),T.rotation!==void 0&&_.setRotation(T.rotation),T.scale!==void 0&&_.setScale(T.scale),T.matrix!==void 0){const b=[0,0,0],N=[0,0,0,1],$=[1,1,1];Ne.decompose(T.matrix,b,N,$),_.setTranslation(b),_.setRotation(N),_.setScale($)}return T.weights!==void 0&&_.setWeights(T.weights),_}),c.skins=(s.skins||[]).map(T=>{const _=a.createSkin(T.name);T.extras&&_.setExtras(T.extras),T.inverseBindMatrices!==void 0&&_.setInverseBindMatrices(c.accessors[T.inverseBindMatrices]),T.skeleton!==void 0&&_.setSkeleton(c.nodes[T.skeleton]);for(const b of T.joints)_.addJoint(c.nodes[b]);return _}),m.map((T,_)=>{const b=c.nodes[_];(T.children||[]).forEach(N=>b.addChild(c.nodes[N])),T.mesh!==void 0&&b.setMesh(c.meshes[T.mesh]),T.camera!==void 0&&b.setCamera(c.cameras[T.camera]),T.skin!==void 0&&b.setSkin(c.skins[T.skin])}),c.animations=(s.animations||[]).map(T=>{const _=a.createAnimation(T.name);T.extras&&_.setExtras(T.extras);const b=(T.samplers||[]).map(N=>{const $=a.createAnimationSampler().setInput(c.accessors[N.input]).setOutput(c.accessors[N.output]).setInterpolation(N.interpolation||Pn.Interpolation.LINEAR);return N.extras&&$.setExtras(N.extras),_.addSampler($),$});return(T.channels||[]).forEach(N=>{const $=a.createAnimationChannel().setSampler(b[N.sampler]).setTargetPath(N.target.path);N.target.node!==void 0&&$.setTargetNode(c.nodes[N.target.node]),N.extras&&$.setExtras(N.extras),_.addChannel($)}),_});const C=s.scenes||[];return a.getRoot().listExtensionsUsed().filter(T=>T.prereadTypes.includes(W.SCENE)).forEach(T=>T.preread(c,W.SCENE)),c.scenes=C.map(T=>{const _=a.createScene(T.name);return T.extras&&_.setExtras(T.extras),(T.nodes||[]).map(b=>c.nodes[b]).forEach(b=>_.addChild(b)),_}),s.scene!==void 0&&a.getRoot().setDefaultScene(c.scenes[s.scene]),a.getRoot().listExtensionsUsed().forEach(T=>T.read(c)),w.forEach((T,_)=>{const b=c.accessors[_],N=!!T.sparse,$=!T.bufferView&&!b.getArray();(N||$)&&b.setSparse(!0).setArray(function(z,B){const k=_n[z.componentType],G=te.getElementSize(z.type);let H;H=z.bufferView!==void 0?vn(z,B):new k(z.count*G);const K=z.sparse;if(!K)return H;const L=K.count,U=Ke({},z,K.indices,{count:L,type:"SCALAR"}),ee=Ke({},z,K.values,{count:L}),fe=vn(U,B),re=vn(ee,B);for(let ye=0;ye<U.count;ye++)for(let me=0;me<G;me++)H[fe[ye]*G+me]=re[ye*G+me];return H}(T,c))}),a}static validate(e,r){const n=e.json;if(n.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${n.asset.version}".`);if(n.extensionsRequired){for(const s of n.extensionsRequired)if(!r.extensions.find(a=>a.EXTENSION_NAME===s))throw new Error(`Missing required extension, "${s}".`)}if(n.extensionsUsed)for(const s of n.extensionsUsed)r.extensions.find(a=>a.EXTENSION_NAME===s)||r.logger.warn(`Missing optional extension, "${s}".`)}};function vn(t,e){const r=e.bufferViews[t.bufferView],n=e.jsonDoc.json.bufferViews[t.bufferView],s=_n[t.componentType],a=te.getElementSize(t.type),c=s.BYTES_PER_ELEMENT;if(n.byteStride!==void 0&&n.byteStride!==a*c)return function(h,d){const g=d.bufferViews[h.bufferView],x=d.jsonDoc.json.bufferViews[h.bufferView],w=_n[h.componentType],M=te.getElementSize(h.type),A=w.BYTES_PER_ELEMENT,F=h.byteOffset||0,m=new w(h.count*M),C=new DataView(g.buffer,g.byteOffset,g.byteLength),T=x.byteStride;for(let _=0;_<h.count;_++)for(let b=0;b<M;b++){const N=F+_*T+b*A;let $;switch(h.componentType){case te.ComponentType.FLOAT:$=C.getFloat32(N,!0);break;case te.ComponentType.UNSIGNED_INT:$=C.getUint32(N,!0);break;case te.ComponentType.UNSIGNED_SHORT:$=C.getUint16(N,!0);break;case te.ComponentType.UNSIGNED_BYTE:$=C.getUint8(N);break;case te.ComponentType.SHORT:$=C.getInt16(N,!0);break;case te.ComponentType.BYTE:$=C.getInt8(N);break;default:throw new Error(`Unexpected componentType "${h.componentType}".`)}m[_*M+b]=$}return m}(t,e);const f=r.byteOffset+(t.byteOffset||0);return new s(r.buffer.slice(f,f+t.count*a*c))}var Br;(function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(Br||(Br={}));let ut=class{constructor(e,r,n){this.C=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.F=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.C=e,this.jsonDoc=r,this.options=n;const s=e.getRoot(),a=s.listBuffers().length,c=s.listTextures().length;this.bufferURIGenerator=new ra(a>1,()=>n.basename||"buffer"),this.imageURIGenerator=new ra(c>1,f=>function(h,d){const g=h.getGraph().listParentEdges(d).find(x=>x.getParent()!==h.getRoot());return g?g.getName().replace(/texture$/i,""):""}(e,f)||n.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,r){const n={magFilter:r.getMagFilter()||void 0,minFilter:r.getMinFilter()||void 0,wrapS:r.getWrapS(),wrapT:r.getWrapT()},s=JSON.stringify(n);this.samplerDefIndexMap.has(s)||(this.samplerDefIndexMap.set(s,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(n));const a={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(s)},c=JSON.stringify(a);this.textureDefIndexMap.has(c)||(this.textureDefIndexMap.set(c,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(a));const f={index:this.textureDefIndexMap.get(c)};return r.getTexCoord()!==0&&(f.texCoord=r.getTexCoord()),Object.keys(r.getExtras()).length>0&&(f.extras=r.getExtras()),this.textureInfoDefMap.set(r,f),f}createPropertyDef(e){const r={};return e.getName()&&(r.name=e.getName()),Object.keys(e.getExtras()).length>0&&(r.extras=e.getExtras()),r}createAccessorDef(e){const r=this.createPropertyDef(e);return r.type=e.getType(),r.componentType=e.getComponentType(),r.count=e.getCount(),this.C.getGraph().listParentEdges(e).some(n=>n.getName()==="attributes"&&n.getAttributes().key==="POSITION"||n.getName()==="input")&&(r.max=e.getMax([]).map(Math.fround),r.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(r.normalized=e.getNormalized()),r}createImageData(e,r,n){if(this.options.format===Jt.GLB)this.imageBufferViews.push(r),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:r.byteLength});else{const s=xt.mimeTypeToExtension(n.getMimeType());e.uri=this.imageURIGenerator.createURI(n,s),this.jsonDoc.resources[e.uri]=r}}getAccessorUsage(e){const r=this.F.get(e);if(r)return r;if(e.getSparse())return tt.SPARSE;for(const n of this.C.getGraph().listParentEdges(e)){const{usage:s}=n.getAttributes();if(s)return s;n.getParent().propertyType!==W.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${n.getName()}".`)}return tt.OTHER}addAccessorToUsageGroup(e,r){const n=this.F.get(e);if(n&&n!==r)throw new Error(`Accessor with usage "${n}" cannot be reused as "${r}".`);return this.F.set(e,r),this}listAccessorUsageGroups(){const e={};for(const[r,n]of Array.from(this.F.entries()))e[n]=e[n]||[],e[n].push(r);return e}};ut.BufferViewTarget=Br,ut.BufferViewUsage=tt,ut.USAGE_TO_TARGET={[tt.ARRAY_BUFFER]:Br.ARRAY_BUFFER,[tt.ELEMENT_ARRAY_BUFFER]:Br.ELEMENT_ARRAY_BUFFER};let ra=class{constructor(e,r){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=r}createURI(e,r){if(e.getURI())return e.getURI();if(this.multiple){const n=this.basename(e);return this.counter[n]=this.counter[n]||1,`${n}_${this.counter[n]++}.${r}`}return`${this.basename(e)}.${r}`}};const{BufferViewUsage:yn}=ut,{UNSIGNED_INT:Ih,UNSIGNED_SHORT:Sh,UNSIGNED_BYTE:Ch}=te.ComponentType;let Nh=class{static write(e,r){const n=e.getRoot(),s={asset:Ke({generator:`glTF-Transform ${Sa}`},n.getAsset()),extras:Ke({},n.getExtras())},a={json:s,resources:{}},c=new ut(e,a,r),f=r.logger||Zt.DEFAULT_INSTANCE,h=new Set(r.extensions.map(m=>m.EXTENSION_NAME)),d=e.getRoot().listExtensionsUsed().filter(m=>h.has(m.extensionName)),g=e.getRoot().listExtensionsRequired().filter(m=>h.has(m.extensionName));d.length<e.getRoot().listExtensionsUsed().length&&f.warn("Some extensions were not registered for I/O, and will not be written.");for(const m of d)for(const C of m.writeDependencies)m.install(C,r.dependencies[C]);function x(m,C,T,_){const b=[];let N=0;for(const z of m){const B=c.createAccessorDef(z);B.bufferView=s.bufferViews.length;const k=z.getArray(),G=ae.pad(ae.toView(k));B.byteOffset=N,N+=G.byteLength,b.push(G),c.accessorIndexMap.set(z,s.accessors.length),s.accessors.push(B)}const $={buffer:C,byteOffset:T,byteLength:ae.concat(b).byteLength};return _&&($.target=_),s.bufferViews.push($),{buffers:b,byteLength:N}}function w(m,C,T){const _=m[0].getCount();let b=0;for(const B of m){const k=c.createAccessorDef(B);k.bufferView=s.bufferViews.length,k.byteOffset=b;const G=B.getElementSize(),H=B.getComponentSize();b+=ae.padNumber(G*H),c.accessorIndexMap.set(B,s.accessors.length),s.accessors.push(k)}const N=_*b,$=new ArrayBuffer(N),z=new DataView($);for(let B=0;B<_;B++){let k=0;for(const G of m){const H=G.getElementSize(),K=G.getComponentSize(),L=G.getComponentType(),U=G.getArray();for(let ee=0;ee<H;ee++){const fe=B*b+k+ee*K,re=U[B*H+ee];switch(L){case te.ComponentType.FLOAT:z.setFloat32(fe,re,!0);break;case te.ComponentType.BYTE:z.setInt8(fe,re);break;case te.ComponentType.SHORT:z.setInt16(fe,re,!0);break;case te.ComponentType.UNSIGNED_BYTE:z.setUint8(fe,re);break;case te.ComponentType.UNSIGNED_SHORT:z.setUint16(fe,re,!0);break;case te.ComponentType.UNSIGNED_INT:z.setUint32(fe,re,!0);break;default:throw new Error("Unexpected component type: "+L)}}k+=ae.padNumber(H*K)}}return s.bufferViews.push({buffer:C,byteOffset:T,byteLength:N,byteStride:b,target:ut.BufferViewTarget.ARRAY_BUFFER}),{byteLength:N,buffers:[new Uint8Array($)]}}function M(m,C,T){const _=[];let b=0;const N=new Map;let $=-1/0;for(const L of m){const U=c.createAccessorDef(L);s.accessors.push(U),c.accessorIndexMap.set(L,s.accessors.length-1);const ee=[],fe=[],re=[],ye=new Array(L.getElementSize()).fill(0);for(let _e=0,ke=L.getCount();_e<ke;_e++)if(L.getElement(_e,re),!Ne.eq(re,ye,0)){$=Math.max(_e,$),ee.push(_e);for(let be=0;be<re.length;be++)fe.push(re[be])}const me=ee.length,xe={accessorDef:U,count:me};if(N.set(L,xe),me===0)continue;if(me>L.getCount()/3){const _e=(100*ee.length/L.getCount()).toFixed(1);f.warn(`Sparse accessor with many non-zero elements (${_e}%) may increase file size.`)}const Te=_n[L.getComponentType()];xe.indices=ee,xe.values=new Te(fe)}if(!Number.isFinite($))return{buffers:_,byteLength:b};const z=$<255?Uint8Array:$<65535?Uint16Array:Uint32Array,B=$<255?Ch:$<65535?Sh:Ih,k={buffer:C,byteOffset:T+b,byteLength:0};for(const L of m){const U=N.get(L);if(U.count===0)continue;U.indicesByteOffset=k.byteLength;const ee=ae.pad(ae.toView(new z(U.indices)));_.push(ee),b+=ee.byteLength,k.byteLength+=ee.byteLength}s.bufferViews.push(k);const G=s.bufferViews.length-1,H={buffer:C,byteOffset:T+b,byteLength:0};for(const L of m){const U=N.get(L);if(U.count===0)continue;U.valuesByteOffset=H.byteLength;const ee=ae.pad(ae.toView(U.values));_.push(ee),b+=ee.byteLength,H.byteLength+=ee.byteLength}s.bufferViews.push(H);const K=s.bufferViews.length-1;for(const L of m){const U=N.get(L);U.count!==0&&(U.accessorDef.sparse={count:U.count,indices:{bufferView:G,byteOffset:U.indicesByteOffset,componentType:B},values:{bufferView:K,byteOffset:U.valuesByteOffset}})}return{buffers:_,byteLength:b}}const A=new Map;for(const m of e.getGraph().listEdges()){if(m.getParent()===n)continue;const C=m.getChild();if(C instanceof te){const T=A.get(C)||[];T.push(m),A.set(C,T)}}if(s.accessors=[],s.bufferViews=[],s.samplers=[],s.textures=[],s.images=n.listTextures().map((m,C)=>{const T=c.createPropertyDef(m);m.getMimeType()&&(T.mimeType=m.getMimeType());const _=m.getImage();return _&&c.createImageData(T,_,m),c.imageIndexMap.set(m,C),T}),d.filter(m=>m.prewriteTypes.includes(W.ACCESSOR)).forEach(m=>m.prewrite(c,W.ACCESSOR)),n.listAccessors().forEach(m=>{const C=c.accessorUsageGroupedByParent,T=c.accessorParents;if(c.accessorIndexMap.has(m))return;const _=A.get(m)||[],b=c.getAccessorUsage(m);if(c.addAccessorToUsageGroup(m,b),C.has(b)){const N=_[0].getParent(),$=T.get(N)||new Set;$.add(m),T.set(N,$)}}),d.filter(m=>m.prewriteTypes.includes(W.BUFFER)).forEach(m=>m.prewrite(c,W.BUFFER)),(n.listAccessors().length>0||n.listTextures().length>0||c.otherBufferViews.size>0)&&n.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");s.buffers=[],n.listBuffers().forEach((m,C)=>{const T=c.createPropertyDef(m),_=c.accessorUsageGroupedByParent,b=c.accessorParents,N=m.listParents().filter(H=>H instanceof te),$=new Set(N),z=[],B=s.buffers.length;let k=0;const G=c.listAccessorUsageGroups();for(const H in G)if(_.has(H))for(const K of Array.from(b.values())){const L=Array.from(K).filter(U=>$.has(U)).filter(U=>c.getAccessorUsage(U)===H);if(L.length)if(H!==yn.ARRAY_BUFFER||r.vertexLayout===Mn.INTERLEAVED){const U=H===yn.ARRAY_BUFFER?w(L,B,k):x(L,B,k);k+=U.byteLength,z.push(...U.buffers)}else for(const U of L){const ee=w([U],B,k);k+=ee.byteLength,z.push(...ee.buffers)}}else{const K=G[H].filter(ee=>$.has(ee));if(!K.length)continue;const L=H===yn.ELEMENT_ARRAY_BUFFER?ut.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0,U=H===yn.SPARSE?M(K,B,k):x(K,B,k,L);k+=U.byteLength,z.push(...U.buffers)}if(c.imageBufferViews.length&&C===0){for(let H=0;H<c.imageBufferViews.length;H++)if(s.bufferViews[s.images[H].bufferView].byteOffset=k,k+=c.imageBufferViews[H].byteLength,z.push(c.imageBufferViews[H]),k%8){const K=8-k%8;k+=K,z.push(new Uint8Array(K))}}if(c.otherBufferViews.has(m))for(const H of c.otherBufferViews.get(m))s.bufferViews.push({buffer:B,byteOffset:k,byteLength:H.byteLength}),c.otherBufferViewsIndexMap.set(H,s.bufferViews.length-1),k+=H.byteLength,z.push(H);if(k){let H;r.format===Jt.GLB?H=mr:(H=c.bufferURIGenerator.createURI(m,"bin"),T.uri=H),T.byteLength=k,a.resources[H]=ae.concat(z)}s.buffers.push(T),c.bufferIndexMap.set(m,C)}),n.listAccessors().find(m=>!m.getBuffer())&&f.warn("Skipped writing one or more Accessors: no Buffer assigned."),s.materials=n.listMaterials().map((m,C)=>{const T=c.createPropertyDef(m);if(m.getAlphaMode()!==yr.AlphaMode.OPAQUE&&(T.alphaMode=m.getAlphaMode()),m.getAlphaMode()===yr.AlphaMode.MASK&&(T.alphaCutoff=m.getAlphaCutoff()),m.getDoubleSided()&&(T.doubleSided=!0),T.pbrMetallicRoughness={},Ne.eq(m.getBaseColorFactor(),[1,1,1,1])||(T.pbrMetallicRoughness.baseColorFactor=m.getBaseColorFactor()),Ne.eq(m.getEmissiveFactor(),[0,0,0])||(T.emissiveFactor=m.getEmissiveFactor()),m.getRoughnessFactor()!==1&&(T.pbrMetallicRoughness.roughnessFactor=m.getRoughnessFactor()),m.getMetallicFactor()!==1&&(T.pbrMetallicRoughness.metallicFactor=m.getMetallicFactor()),m.getBaseColorTexture()){const _=m.getBaseColorTexture(),b=m.getBaseColorTextureInfo();T.pbrMetallicRoughness.baseColorTexture=c.createTextureInfoDef(_,b)}if(m.getEmissiveTexture()){const _=m.getEmissiveTexture(),b=m.getEmissiveTextureInfo();T.emissiveTexture=c.createTextureInfoDef(_,b)}if(m.getNormalTexture()){const _=m.getNormalTexture(),b=m.getNormalTextureInfo(),N=c.createTextureInfoDef(_,b);m.getNormalScale()!==1&&(N.scale=m.getNormalScale()),T.normalTexture=N}if(m.getOcclusionTexture()){const _=m.getOcclusionTexture(),b=m.getOcclusionTextureInfo(),N=c.createTextureInfoDef(_,b);m.getOcclusionStrength()!==1&&(N.strength=m.getOcclusionStrength()),T.occlusionTexture=N}if(m.getMetallicRoughnessTexture()){const _=m.getMetallicRoughnessTexture(),b=m.getMetallicRoughnessTextureInfo();T.pbrMetallicRoughness.metallicRoughnessTexture=c.createTextureInfoDef(_,b)}return c.materialIndexMap.set(m,C),T}),s.meshes=n.listMeshes().map((m,C)=>{const T=c.createPropertyDef(m);let _=null;return T.primitives=m.listPrimitives().map(b=>{const N={attributes:{}};N.mode=b.getMode();const $=b.getMaterial();$&&(N.material=c.materialIndexMap.get($)),Object.keys(b.getExtras()).length&&(N.extras=b.getExtras());const z=b.getIndices();z&&(N.indices=c.accessorIndexMap.get(z));for(const B of b.listSemantics())N.attributes[B]=c.accessorIndexMap.get(b.getAttribute(B));for(const B of b.listTargets()){const k={};for(const G of B.listSemantics())k[G]=c.accessorIndexMap.get(B.getAttribute(G));N.targets=N.targets||[],N.targets.push(k)}return b.listTargets().length&&!_&&(_=b.listTargets().map(B=>B.getName())),N}),m.getWeights().length&&(T.weights=m.getWeights()),_&&(T.extras=T.extras||{},T.extras.targetNames=_),c.meshIndexMap.set(m,C),T}),s.cameras=n.listCameras().map((m,C)=>{const T=c.createPropertyDef(m);if(T.type=m.getType(),T.type===Xr.Type.PERSPECTIVE){T.perspective={znear:m.getZNear(),zfar:m.getZFar(),yfov:m.getYFov()};const _=m.getAspectRatio();_!==null&&(T.perspective.aspectRatio=_)}else T.orthographic={znear:m.getZNear(),zfar:m.getZFar(),xmag:m.getXMag(),ymag:m.getYMag()};return c.cameraIndexMap.set(m,C),T}),s.nodes=n.listNodes().map((m,C)=>{const T=c.createPropertyDef(m);return Ne.eq(m.getTranslation(),[0,0,0])||(T.translation=m.getTranslation()),Ne.eq(m.getRotation(),[0,0,0,1])||(T.rotation=m.getRotation()),Ne.eq(m.getScale(),[1,1,1])||(T.scale=m.getScale()),m.getWeights().length&&(T.weights=m.getWeights()),c.nodeIndexMap.set(m,C),T}),s.skins=n.listSkins().map((m,C)=>{const T=c.createPropertyDef(m),_=m.getInverseBindMatrices();_&&(T.inverseBindMatrices=c.accessorIndexMap.get(_));const b=m.getSkeleton();return b&&(T.skeleton=c.nodeIndexMap.get(b)),T.joints=m.listJoints().map(N=>c.nodeIndexMap.get(N)),c.skinIndexMap.set(m,C),T}),n.listNodes().forEach((m,C)=>{const T=s.nodes[C],_=m.getMesh();_&&(T.mesh=c.meshIndexMap.get(_));const b=m.getCamera();b&&(T.camera=c.cameraIndexMap.get(b));const N=m.getSkin();N&&(T.skin=c.skinIndexMap.get(N)),m.listChildren().length>0&&(T.children=m.listChildren().map($=>c.nodeIndexMap.get($)))}),s.animations=n.listAnimations().map((m,C)=>{const T=c.createPropertyDef(m),_=new Map;return T.samplers=m.listSamplers().map((b,N)=>{const $=c.createPropertyDef(b);return $.input=c.accessorIndexMap.get(b.getInput()),$.output=c.accessorIndexMap.get(b.getOutput()),$.interpolation=b.getInterpolation(),_.set(b,N),$}),T.channels=m.listChannels().map(b=>{const N=c.createPropertyDef(b);return N.sampler=_.get(b.getSampler()),N.target={node:c.nodeIndexMap.get(b.getTargetNode()),path:b.getTargetPath()},N}),c.animationIndexMap.set(m,C),T}),s.scenes=n.listScenes().map((m,C)=>{const T=c.createPropertyDef(m);return T.nodes=m.listChildren().map(_=>c.nodeIndexMap.get(_)),c.sceneIndexMap.set(m,C),T});const F=n.getDefaultScene();return F&&(s.scene=n.listScenes().indexOf(F)),s.extensionsUsed=d.map(m=>m.extensionName),s.extensionsRequired=g.map(m=>m.extensionName),d.forEach(m=>m.write(c)),function(m){const C=[];for(const T in m){const _=m[T];(Array.isArray(_)&&_.length===0||_===null||_===""||_&&typeof _=="object"&&Object.keys(_).length===0)&&C.push(T)}for(const T of C)delete m[T]}(s),a}};var bn;(function(t){t[t.JSON=1313821514]="JSON",t[t.BIN=5130562]="BIN"})(bn||(bn={}));let Fh=class{constructor(){this.M=Zt.DEFAULT_INSTANCE,this.l=new Set,this.U={},this.P=Mn.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.M=e,this}registerExtensions(e){for(const r of e)this.l.add(r),r.register();return this}registerDependencies(e){return Object.assign(this.U,e),this}setVertexLayout(e){return this.P=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const r=await this.readURI(e,"view");this.lastReadBytes=r.byteLength;const n=na(r)?this.L(r):{json:JSON.parse(ae.decodeText(r)),resources:{}};return await this.j(n,this.dirname(e)),this.D(n),n}async readJSON(e){return e=this._(e),this.D(e),Ah.read(e,{extensions:Array.from(this.l),dependencies:this.U,logger:this.M})}async binaryToJSON(e){const r=this.L(ae.assertView(e));this.D(r);const n=r.json;if(n.buffers&&n.buffers.some(s=>function(a,c){return c.uri!==void 0&&!(c.uri in a.resources)}(r,s)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(n.images&&n.images.some(s=>function(a,c){return c.uri!==void 0&&!(c.uri in a.resources)&&c.bufferView===void 0}(r,s)))throw new Error("Cannot resolve external images with binaryToJSON().");return r}async readBinary(e){return this.readJSON(await this.binaryToJSON(ae.assertView(e)))}async writeJSON(e,r={}){if(r.format===Jt.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return Nh.write(e,{format:r.format||Jt.GLTF,basename:r.basename||"",logger:this.M,vertexLayout:this.P,dependencies:Ke({},this.U),extensions:Array.from(this.l)})}async writeBinary(e){const{json:r,resources:n}=await this.writeJSON(e,{format:Jt.GLB}),s=new Uint32Array([1179937895,2,12]),a=JSON.stringify(r),c=ae.pad(ae.encodeText(a),32),f=ae.toView(new Uint32Array([c.byteLength,1313821514])),h=ae.concat([f,c]);s[s.length-1]+=h.byteLength;const d=Object.values(n)[0];if(!d||!d.byteLength)return ae.concat([ae.toView(s),h]);const g=ae.pad(d,0),x=ae.toView(new Uint32Array([g.byteLength,5130562])),w=ae.concat([x,g]);return s[s.length-1]+=w.byteLength,ae.concat([ae.toView(s),h,w])}async j(e,r){var n=this;const s=[...e.json.images||[],...e.json.buffers||[]].map(async function(a){const c=a.uri;if(!c||c.match(/data:/))return Promise.resolve();e.resources[c]=await n.readURI(n.resolve(r,c),"view"),n.lastReadBytes+=e.resources[c].byteLength});await Promise.all(s)}D(e){function r(n){if(n.uri){if(n.uri in e.resources)ae.assertView(e.resources[n.uri]);else if(n.uri.match(/data:/)){const s=`__${wh()}.${vr.extension(n.uri)}`;e.resources[s]=ae.createBufferFromDataURI(n.uri),n.uri=s}}}(e.json.images||[]).forEach(n=>{if(n.bufferView===void 0&&n.uri===void 0)throw new Error("Missing resource URI or buffer view.");r(n)}),(e.json.buffers||[]).forEach(r)}_(e){const{images:r,buffers:n}=e.json;return e={json:Ke({},e.json),resources:Ke({},e.resources)},r&&(e.json.images=r.map(s=>Ke({},s))),n&&(e.json.buffers=n.map(s=>Ke({},s))),e}L(e){if(!na(e))throw new Error("Invalid glTF 2.0 binary.");const r=new Uint32Array(e.buffer,e.byteOffset+12,2);if(r[1]!==bn.JSON)throw new Error("Missing required GLB JSON chunk.");const n=r[0],s=ae.decodeText(ae.toView(e,20,n)),a=JSON.parse(s),c=20+n;if(e.byteLength<=c)return{json:a,resources:{}};const f=new Uint32Array(e.buffer,e.byteOffset+c,2);if(f[1]!==bn.BIN)throw new Error("Expected GLB BIN in second chunk.");const h=ae.toView(e,c+8,f[0]);return{json:a,resources:{[mr]:h}}}};function na(t){if(t.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(t.buffer,t.byteOffset,3);return e[0]===1179937895&&e[1]===2}let Oh=class extends Fh{constructor(e=jr.DEFAULT_INIT){super(),this.J=void 0,this.J=e}async readURI(e,r){const n=await fetch(e,this.J);switch(r){case"view":return new Uint8Array(await n.arrayBuffer());case"text":return n.text()}}resolve(e,r){return jr.resolve(e,r)}dirname(e){return jr.dirname(e)}};const Dh=0,$h=0,Ph=0,kh=2,Uh=0,Lh=163,jh=166,Bh=0,Vh=2,zh=1,Gh=64,Hh=0;class qh{constructor(){this.vkFormat=Hh,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=Dh,this.levels=[],this.dataFormatDescriptor=[{vendorId:Ph,descriptorType:$h,descriptorBlockSize:0,versionNumber:kh,colorModel:Uh,colorPrimaries:zh,transferFunction:Vh,flags:Bh,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Sr{constructor(e,r,n,s){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+r,n),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian),r=this._dataView.getUint32(this._offset+4,this._littleEndian),n=e+2**32*r;return this._offset+=8,n}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const r=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,r}_skip(e){return this._offset+=e,this}_scan(e,r=0){const n=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==r&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,s)}}const Xe=[171,75,84,88,32,50,48,187,13,10,26,10];function sa(t){return typeof TextDecoder<"u"?new TextDecoder().decode(t):Buffer.from(t).toString("utf8")}function fs(t){const e=new Uint8Array(t.buffer,t.byteOffset,Xe.length);if(e[0]!==Xe[0]||e[1]!==Xe[1]||e[2]!==Xe[2]||e[3]!==Xe[3]||e[4]!==Xe[4]||e[5]!==Xe[5]||e[6]!==Xe[6]||e[7]!==Xe[7]||e[8]!==Xe[8]||e[9]!==Xe[9]||e[10]!==Xe[10]||e[11]!==Xe[11])throw new Error("Missing KTX 2.0 identifier.");const r=new qh,n=17*Uint32Array.BYTES_PER_ELEMENT,s=new Sr(t,Xe.length,n,!0);r.vkFormat=s._nextUint32(),r.typeSize=s._nextUint32(),r.pixelWidth=s._nextUint32(),r.pixelHeight=s._nextUint32(),r.pixelDepth=s._nextUint32(),r.layerCount=s._nextUint32(),r.faceCount=s._nextUint32();const a=s._nextUint32();r.supercompressionScheme=s._nextUint32();const c=s._nextUint32(),f=s._nextUint32(),h=s._nextUint32(),d=s._nextUint32(),g=s._nextUint64(),x=s._nextUint64(),w=a*3*8,M=new Sr(t,Xe.length+n,w,!0);for(let xe=0;xe<a;xe++)r.levels.push({levelData:new Uint8Array(t.buffer,t.byteOffset+M._nextUint64(),M._nextUint64()),uncompressedByteLength:M._nextUint64()});const A=new Sr(t,c,f,!0),F={vendorId:A._skip(4)._nextUint16(),descriptorType:A._nextUint16(),versionNumber:A._nextUint16(),descriptorBlockSize:A._nextUint16(),colorModel:A._nextUint8(),colorPrimaries:A._nextUint8(),transferFunction:A._nextUint8(),flags:A._nextUint8(),texelBlockDimension:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],bytesPlane:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],samples:[]},m=6,C=4,T=(F.descriptorBlockSize/4-m)/C;for(let xe=0;xe<T;xe++){const Te={bitOffset:A._nextUint16(),bitLength:A._nextUint8(),channelType:A._nextUint8(),samplePosition:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};Te.channelType&Gh?(Te.sampleLower=A._nextInt32(),Te.sampleUpper=A._nextInt32()):(Te.sampleLower=A._nextUint32(),Te.sampleUpper=A._nextUint32()),F.samples[xe]=Te}r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(F);const _=new Sr(t,h,d,!0);for(;_._offset<d;){const xe=_._nextUint32(),Te=_._scan(xe),_e=sa(Te);if(r.keyValue[_e]=_._nextUint8Array(xe-Te.byteLength-1),_e.match(/^ktx/i)){const be=sa(r.keyValue[_e]);r.keyValue[_e]=be.substring(0,be.lastIndexOf("\0"))}const ke=xe%4?4-xe%4:0;_._skip(ke)}if(x<=0)return r;const b=new Sr(t,g,x,!0),N=b._nextUint16(),$=b._nextUint16(),z=b._nextUint32(),B=b._nextUint32(),k=b._nextUint32(),G=b._nextUint32(),H=[];for(let xe=0;xe<a;xe++)H.push({imageFlags:b._nextUint32(),rgbSliceByteOffset:b._nextUint32(),rgbSliceByteLength:b._nextUint32(),alphaSliceByteOffset:b._nextUint32(),alphaSliceByteLength:b._nextUint32()});const K=g+b._offset,L=K+z,U=L+B,ee=U+k,fe=new Uint8Array(t.buffer,t.byteOffset+K,z),re=new Uint8Array(t.buffer,t.byteOffset+L,B),ye=new Uint8Array(t.buffer,t.byteOffset+U,k),me=new Uint8Array(t.buffer,t.byteOffset+ee,G);return r.globalData={endpointCount:N,selectorCount:$,imageDescs:H,endpointsData:fe,selectorsData:re,tablesData:ye,extendedData:me},r}const Us="EXT_mesh_gpu_instancing",Es="EXT_meshopt_compression",qa="KHR_draco_mesh_compression",Ls="KHR_lights_punctual",js="KHR_materials_anisotropy",Bs="KHR_materials_clearcoat",Vs="KHR_materials_emissive_strength",zs="KHR_materials_ior",Gs="KHR_materials_iridescence",Hs="KHR_materials_pbrSpecularGlossiness",qs="KHR_materials_sheen",Ws="KHR_materials_specular",Xs="KHR_materials_transmission",Ys="KHR_materials_unlit",Ks="KHR_materials_volume",tr="KHR_materials_variants",Js="KHR_texture_transform",An="KHR_xmp_json_ld",ws="INSTANCE_ATTRIBUTE";class Wa extends $e{init(){this.extensionName=Us,this.propertyType="InstancedMesh",this.parentTypes=[W.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:ws})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}Wa.EXTENSION_NAME=Us;const kt=Us;class Xa extends Ie{constructor(...e){super(...e),this.extensionName=kt,this.provideTypes=[W.NODE],this.prewriteTypes=[W.ACCESSOR]}createInstancedMesh(){return new Wa(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((r,n)=>{if(!r.extensions||!r.extensions[kt])return;const s=r.extensions[kt],a=this.createInstancedMesh();for(const c in s.attributes)a.setAttribute(c,e.accessors[s.attributes[c]]);e.nodes[n].setExtension(kt,a)}),this}prewrite(e){e.accessorUsageGroupedByParent.add(ws);for(const r of this.properties)for(const n of r.listAttributes())e.addAccessorToUsageGroup(n,ws);return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listNodes().forEach(n=>{const s=n.getExtension(kt);if(s){const a=e.nodeIndexMap.get(n),c=r.json.nodes[a],f={attributes:{}};s.listSemantics().forEach(h=>{const d=s.getAttribute(h);f.attributes[h]=e.accessorIndexMap.get(d)}),c.extensions=c.extensions||{},c.extensions[kt]=f}}),this}}function bt(){return bt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},bt.apply(this,arguments)}var Hr,pr,De;Xa.EXTENSION_NAME=kt,function(t){t.QUANTIZE="quantize",t.FILTER="filter"}(Hr||(Hr={})),function(t){t.ATTRIBUTES="ATTRIBUTES",t.TRIANGLES="TRIANGLES",t.INDICES="INDICES"}(pr||(pr={})),function(t){t.NONE="NONE",t.OCTAHEDRAL="OCTAHEDRAL",t.QUATERNION="QUATERNION",t.EXPONENTIAL="EXPONENTIAL"}(De||(De={}));const{BYTE:Wh,SHORT:ia,FLOAT:Xh}=te.ComponentType,{encodeNormalizedInt:aa,decodeNormalizedInt:us}=Ne;function Yh(t,e,r,n){const{filter:s,bits:a}=n,c={array:t.getArray(),byteStride:t.getElementSize()*t.getComponentSize(),componentType:t.getComponentType(),normalized:t.getNormalized()};if(r!==pr.ATTRIBUTES)return c;if(s!==De.NONE){let f=t.getNormalized()?function(h){const d=h.getComponentType(),g=h.getArray(),x=new Float32Array(g.length);for(let w=0;w<g.length;w++)x[w]=us(g[w],d);return x}(t):new Float32Array(c.array);switch(s){case De.EXPONENTIAL:c.byteStride=4*t.getElementSize(),c.componentType=Xh,c.normalized=!1,c.array=e.encodeFilterExp(f,t.getCount(),c.byteStride,a);break;case De.OCTAHEDRAL:c.byteStride=a>8?8:4,c.componentType=a>8?ia:Wh,c.normalized=!0,f=t.getElementSize()===3?function(h){const d=new Float32Array(4*h.length/3);for(let g=0,x=h.length/3;g<x;g++)d[4*g]=h[3*g],d[4*g+1]=h[3*g+1],d[4*g+2]=h[3*g+2];return d}(f):f,c.array=e.encodeFilterOct(f,t.getCount(),c.byteStride,a);break;case De.QUATERNION:c.byteStride=8,c.componentType=ia,c.normalized=!0,c.array=e.encodeFilterQuat(f,t.getCount(),c.byteStride,a);break;default:throw new Error("Invalid filter.")}c.min=t.getMin([]),c.max=t.getMax([]),t.getNormalized()&&(c.min=c.min.map(h=>us(h,t.getComponentType())),c.max=c.max.map(h=>us(h,t.getComponentType()))),c.normalized&&(c.min=c.min.map(h=>aa(h,c.componentType)),c.max=c.max.map(h=>aa(h,c.componentType)))}else c.byteStride%4&&(c.array=function(f,h){const d=ae.padNumber(f.BYTES_PER_ELEMENT*h)/f.BYTES_PER_ELEMENT,g=new f.constructor(f.length/h*d);for(let x=0;x*h<f.length;x++)for(let w=0;w<h;w++)g[x*d+w]=f[x*h+w];return g}(c.array,t.getElementSize()),c.byteStride=c.array.byteLength/t.getCount());return c}function Kh(t,e){return e===ut.BufferViewUsage.ELEMENT_ARRAY_BUFFER?t.listParents().some(r=>r instanceof Gr&&r.getMode()===Gr.Mode.TRIANGLES)?pr.TRIANGLES:pr.INDICES:pr.ATTRIBUTES}function Jh(t,e){const r=e.getGraph().listParentEdges(t).filter(n=>!(n.getParent()instanceof Ha));for(const n of r){const s=n.getName(),a=n.getAttributes().key||"",c=n.getParent().propertyType===W.PRIMITIVE_TARGET;if(s==="indices")return{filter:De.NONE};if(s==="attributes"){if(a==="POSITION")return{filter:De.NONE};if(a==="TEXCOORD_0")return{filter:De.NONE};if(a.startsWith("JOINTS_"))return{filter:De.NONE};if(a.startsWith("WEIGHTS_"))return{filter:De.NONE};if(a==="NORMAL"||a==="TANGENT")return c?{filter:De.NONE}:{filter:De.OCTAHEDRAL,bits:8}}if(s==="output"){const f=Ya(t);return f==="rotation"?{filter:De.QUATERNION,bits:16}:f==="translation"||f==="scale"?{filter:De.EXPONENTIAL,bits:12}:{filter:De.NONE}}if(s==="input")return{filter:De.NONE};if(s==="inverseBindMatrices")return{filter:De.NONE}}return{filter:De.NONE}}function Ya(t){for(const e of t.listParents())if(e instanceof Pn){for(const r of e.listParents())if(r instanceof Ps)return r.getTargetPath()}return null}const Ye=Es,oa={method:Hr.QUANTIZE};class Ms extends Ie{constructor(...e){super(...e),this.extensionName=Ye,this.prereadTypes=[W.BUFFER,W.PRIMITIVE],this.prewriteTypes=[W.BUFFER,W.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=oa,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,r){return e==="meshopt.decoder"&&(this._decoder=r),e==="meshopt.encoder"&&(this._encoder=r),this}setEncoderOptions(e){return this._encoderOptions=bt({},oa,e),this}preread(e,r){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${Ye}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${Ye}]: Missing WASM support.`)}return r===W.BUFFER?this._prereadBuffers(e):r===W.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const r=e.jsonDoc;(r.json.bufferViews||[]).forEach((n,s)=>{if(!n.extensions||!n.extensions[Ye])return;const a=n.extensions[Ye],c=a.byteOffset||0,f=a.byteLength||0,h=a.count,d=a.byteStride,g=new Uint8Array(h*d),x=r.json.buffers[a.buffer],w=ae.toView(x.uri?r.resources[x.uri]:r.resources[mr],c,f);this._decoder.decodeGltfBuffer(g,h,d,w,a.mode,a.filter),e.bufferViews[s]=g})}_prereadPrimitives(e){const r=e.jsonDoc;(r.json.bufferViews||[]).forEach(n=>{var s;n.extensions&&n.extensions[Ye]&&(s=r.json.buffers[n.buffer]).extensions&&s.extensions[Es]&&s.extensions[Es].fallback&&this._decoderFallbackBufferMap.set(e.buffers[n.buffer],e.buffers[n.extensions[Ye].buffer])})}read(e){if(!this.isRequired())return this;for(const[r,n]of this._decoderFallbackBufferMap){for(const s of r.listParents())s instanceof te&&s.swap(r,n);r.dispose()}return this}prewrite(e,r){return r===W.ACCESSOR?this._prewriteAccessors(e):r===W.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const r=e.jsonDoc.json,n=this._encoder,s=this._encoderOptions,a=this.document.createBuffer(),c=this.document.getRoot().listBuffers().indexOf(a);this._encoderFallbackBuffer=a,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const f of this.document.getRoot().listAccessors()){if(Ya(f)==="weights"||f.getSparse())continue;const h=e.getAccessorUsage(f),d=Kh(f,h),g=s.method===Hr.FILTER?Jh(f,this.document):{filter:De.NONE},x=Yh(f,n,d,g),{array:w,byteStride:M}=x,A=f.getBuffer();if(!A)throw new Error(`${Ye}: Missing buffer for accessor.`);const F=this.document.getRoot().listBuffers().indexOf(A),m=[h,d,g.filter,M,F].join(":");let C=this._encoderBufferViews[m],T=this._encoderBufferViewData[m],_=this._encoderBufferViewAccessors[m];C&&T||(_=this._encoderBufferViewAccessors[m]=[],T=this._encoderBufferViewData[m]=[],C=this._encoderBufferViews[m]={buffer:c,target:ut.USAGE_TO_TARGET[h],byteOffset:0,byteLength:0,byteStride:h===ut.BufferViewUsage.ARRAY_BUFFER?M:void 0,extensions:{[Ye]:{buffer:F,byteOffset:0,byteLength:0,mode:d,filter:g.filter!==De.NONE?g.filter:void 0,byteStride:M,count:0}}});const b=e.createAccessorDef(f);b.componentType=x.componentType,b.normalized=x.normalized,b.byteOffset=C.byteLength,b.min&&x.min&&(b.min=x.min),b.max&&x.max&&(b.max=x.max),e.accessorIndexMap.set(f,r.accessors.length),r.accessors.push(b),_.push(b),T.push(new Uint8Array(w.buffer,w.byteOffset,w.byteLength)),C.byteLength+=w.byteLength,C.extensions.EXT_meshopt_compression.count+=f.getCount()}}_prewriteBuffers(e){const r=this._encoder;for(const n in this._encoderBufferViews){const s=this._encoderBufferViews[n],a=this._encoderBufferViewData[n],c=this.document.getRoot().listBuffers()[s.extensions[Ye].buffer],f=e.otherBufferViews.get(c)||[],{count:h,byteStride:d,mode:g}=s.extensions[Ye],x=ae.concat(a),w=r.encodeGltfBuffer(x,h,d,g),M=ae.pad(w);s.extensions[Ye].byteLength=w.byteLength,a.length=0,a.push(M),f.push(M),e.otherBufferViews.set(c,f)}}write(e){let r=0;for(const c in this._encoderBufferViews){const f=this._encoderBufferViews[c],h=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[c][0]),d=this._encoderBufferViewAccessors[c];for(const w of d)w.bufferView=h;const g=e.jsonDoc.json.bufferViews[h],x=g.byteOffset||0;Object.assign(g,f),g.byteOffset=r,g.extensions[Ye].byteOffset=x,r+=ae.padNumber(f.byteLength)}const n=this._encoderFallbackBuffer,s=e.bufferIndexMap.get(n),a=e.jsonDoc.json.buffers[s];return a.byteLength=r,a.extensions={[Ye]:{fallback:!0}},n.dispose(),this}}Ms.EXTENSION_NAME=Ye,Ms.EncoderMethod=Hr;const Pr="EXT_texture_avif";class Zh{match(e){return e.length>=12&&ae.decodeText(e.slice(4,12))==="ftypavif"}getSize(e){if(!this.match(e))return null;const r=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=ca(r,0);if(!n)return null;let s=n.end;for(;n=ca(r,s);)if(n.type==="meta")s=n.start+4;else if(n.type==="iprp"||n.type==="ipco")s=n.start;else{if(n.type==="ispe")return[r.getUint32(n.start+4),r.getUint32(n.start+8)];if(n.type==="mdat")break;s=n.end}return null}getChannels(e){return 4}}class Ka extends Ie{constructor(...e){super(...e),this.extensionName=Pr,this.prereadTypes=[W.TEXTURE]}static register(){xt.registerFormat("image/avif",new Zh)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(r=>{r.extensions&&r.extensions[Pr]&&(r.source=r.extensions[Pr].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/avif"){const s=e.imageIndexMap.get(n);(r.json.textures||[]).forEach(a=>{a.source===s&&(a.extensions=a.extensions||{},a.extensions[Pr]={source:a.source},delete a.source)})}}),this}}function ca(t,e){if(t.byteLength<4+e)return null;const r=t.getUint32(e);return t.byteLength<r+e||r<8?null:{type:ae.decodeText(new Uint8Array(t.buffer,t.byteOffset+e+4,4)),start:e+8,end:e+r}}Ka.EXTENSION_NAME=Pr;const kr="EXT_texture_webp";class Qh{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const r=ae.decodeText(e.slice(0,4)),n=ae.decodeText(e.slice(8,12));if(r!=="RIFF"||n!=="WEBP")return null;const s=new DataView(e.buffer,e.byteOffset);let a=12;for(;a<s.byteLength;){const c=ae.decodeText(new Uint8Array([s.getUint8(a),s.getUint8(a+1),s.getUint8(a+2),s.getUint8(a+3)])),f=s.getUint32(a+4,!0);if(c==="VP8 ")return[16383&s.getInt16(a+14,!0),16383&s.getInt16(a+16,!0)];if(c==="VP8L"){const h=s.getUint8(a+9),d=s.getUint8(a+10),g=s.getUint8(a+11);return[1+((63&d)<<8|h),1+((15&s.getUint8(a+12))<<10|g<<2|(192&d)>>6)]}a+=8+f+f%2}return null}getChannels(e){return 4}}class Ja extends Ie{constructor(...e){super(...e),this.extensionName=kr,this.prereadTypes=[W.TEXTURE]}static register(){xt.registerFormat("image/webp",new Qh)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(r=>{r.extensions&&r.extensions[kr]&&(r.source=r.extensions[kr].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/webp"){const s=e.imageIndexMap.get(n);(r.json.textures||[]).forEach(a=>{a.source===s&&(a.extensions=a.extensions||{},a.extensions[kr]={source:a.source},delete a.source)})}}),this}}Ja.EXTENSION_NAME=kr;const la=qa;let Ue,Za,Qa,it;function ed(t,e){const r=new Ue.DecoderBuffer;try{if(r.Init(e,e.length),t.GetEncodedGeometryType(r)!==Ue.TRIANGULAR_MESH)throw new Error(`[${la}] Unknown geometry type.`);const n=new Ue.Mesh;if(!t.DecodeBufferToMesh(r,n).ok()||n.ptr===0)throw new Error(`[${la}] Decoding failure.`);return n}finally{Ue.destroy(r)}}function td(t,e){const r=3*e.num_faces();let n,s;if(e.num_points()<=65534){const a=r*Uint16Array.BYTES_PER_ELEMENT;n=Ue._malloc(a),t.GetTrianglesUInt16Array(e,a,n),s=new Uint16Array(Ue.HEAPU16.buffer,n,r).slice()}else{const a=r*Uint32Array.BYTES_PER_ELEMENT;n=Ue._malloc(a),t.GetTrianglesUInt32Array(e,a,n),s=new Uint32Array(Ue.HEAPU32.buffer,n,r).slice()}return Ue._free(n),s}function rd(t,e,r,n){const s=Qa[n.componentType],a=Za[n.componentType],c=r.num_components(),f=e.num_points()*c,h=f*a.BYTES_PER_ELEMENT,d=Ue._malloc(h);t.GetAttributeDataArrayForAllPoints(e,r,s,h,d);const g=new a(Ue.HEAPF32.buffer,d,f).slice();return Ue._free(d),g}var qr,at;(function(t){t[t.EDGEBREAKER=1]="EDGEBREAKER",t[t.SEQUENTIAL=0]="SEQUENTIAL"})(qr||(qr={})),function(t){t.POSITION="POSITION",t.NORMAL="NORMAL",t.COLOR="COLOR",t.TEX_COORD="TEX_COORD",t.GENERIC="GENERIC"}(at||(at={}));const eo={[at.POSITION]:14,[at.NORMAL]:10,[at.COLOR]:8,[at.TEX_COORD]:12,[at.GENERIC]:12},fa={decodeSpeed:5,encodeSpeed:5,method:qr.EDGEBREAKER,quantizationBits:eo,quantizationVolume:"mesh"};function nd(t,e=fa){const r=bt({},fa,e);r.quantizationBits=bt({},eo,e.quantizationBits);const n=new it.MeshBuilder,s=new it.Mesh,a=new it.ExpertEncoder(s),c={},f=new it.DracoInt8Array,h=t.listTargets().length>0;let d=!1;for(const F of t.listSemantics()){const m=t.getAttribute(F);if(m.getSparse()){d=!0;continue}const C=sd(F),T=id(n,m.getComponentType(),s,it[C],m.getCount(),m.getElementSize(),m.getArray());if(T===-1)throw new Error(`Error compressing "${F}" attribute.`);if(c[F]=T,r.quantizationVolume==="mesh"||F!=="POSITION")a.SetAttributeQuantization(T,r.quantizationBits[C]);else{if(typeof r.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:_}=r,b=Math.max(_.max[0]-_.min[0],_.max[1]-_.min[1],_.max[2]-_.min[2]);a.SetAttributeExplicitQuantization(T,r.quantizationBits[C],m.getElementSize(),_.min,b)}}}const g=t.getIndices();if(!g)throw new _s("Primitive must have indices.");n.AddFacesToMesh(s,g.getCount()/3,g.getArray()),a.SetSpeedOptions(r.encodeSpeed,r.decodeSpeed),a.SetTrackEncodedProperties(!0),a.SetEncodingMethod(r.method===qr.SEQUENTIAL||h||d?it.MESH_SEQUENTIAL_ENCODING:it.MESH_EDGEBREAKER_ENCODING);const x=a.EncodeToDracoBuffer(!(h||d),f);if(x<=0)throw new _s("Error applying Draco compression.");const w=new Uint8Array(x);for(let F=0;F<x;++F)w[F]=f.GetValue(F);const M=a.GetNumberOfEncodedPoints(),A=3*a.GetNumberOfEncodedFaces();return it.destroy(f),it.destroy(s),it.destroy(n),it.destroy(a),{numVertices:M,numIndices:A,data:w,attributeIDs:c}}function sd(t){return t==="POSITION"?at.POSITION:t==="NORMAL"?at.NORMAL:t.startsWith("COLOR_")?at.COLOR:t.startsWith("TEXCOORD_")?at.TEX_COORD:at.GENERIC}function id(t,e,r,n,s,a,c){switch(e){case te.ComponentType.UNSIGNED_BYTE:return t.AddUInt8Attribute(r,n,s,a,c);case te.ComponentType.BYTE:return t.AddInt8Attribute(r,n,s,a,c);case te.ComponentType.UNSIGNED_SHORT:return t.AddUInt16Attribute(r,n,s,a,c);case te.ComponentType.SHORT:return t.AddInt16Attribute(r,n,s,a,c);case te.ComponentType.UNSIGNED_INT:return t.AddUInt32Attribute(r,n,s,a,c);case te.ComponentType.FLOAT:return t.AddFloatAttribute(r,n,s,a,c);default:throw new Error(`Unexpected component type, "${e}".`)}}class _s extends Error{}const Oe=qa;class Rs extends Ie{constructor(...e){super(...e),this.extensionName=Oe,this.prereadTypes=[W.PRIMITIVE],this.prewriteTypes=[W.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,r){return e==="draco3d.decoder"&&(this._decoderModule=r,Ue=this._decoderModule,Za={[te.ComponentType.FLOAT]:Float32Array,[te.ComponentType.UNSIGNED_INT]:Uint32Array,[te.ComponentType.UNSIGNED_SHORT]:Uint16Array,[te.ComponentType.UNSIGNED_BYTE]:Uint8Array,[te.ComponentType.SHORT]:Int16Array,[te.ComponentType.BYTE]:Int8Array},Qa={[te.ComponentType.FLOAT]:Ue.DT_FLOAT32,[te.ComponentType.UNSIGNED_INT]:Ue.DT_UINT32,[te.ComponentType.UNSIGNED_SHORT]:Ue.DT_UINT16,[te.ComponentType.UNSIGNED_BYTE]:Ue.DT_UINT8,[te.ComponentType.SHORT]:Ue.DT_INT16,[te.ComponentType.BYTE]:Ue.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=r,it=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${Oe}] Please install extension dependency, "draco3d.decoder".`);const r=this.document.getLogger(),n=e.jsonDoc,s=new Map;try{const a=n.json.meshes||[];for(const c of a)for(const f of c.primitives){if(!f.extensions||!f.extensions[Oe])continue;const h=f.extensions[Oe];let[d,g]=s.get(h.bufferView)||[];if(!g||!d){const x=n.json.bufferViews[h.bufferView],w=n.json.buffers[x.buffer],M=ae.toView(w.uri?n.resources[w.uri]:n.resources[mr],x.byteOffset||0,x.byteLength);d=new this._decoderModule.Decoder,g=ed(d,M),s.set(h.bufferView,[d,g]),r.debug(`[${Oe}] Decompressed ${M.byteLength} bytes.`)}for(const x in f.attributes){const w=e.jsonDoc.json.accessors[f.attributes[x]],M=d.GetAttributeByUniqueId(g,h.attributes[x]),A=rd(d,g,M,w);e.accessors[f.attributes[x]].setArray(A)}f.indices!==void 0&&e.accessors[f.indices].setArray(td(d,g))}}finally{for(const[a,c]of Array.from(s.values()))this._decoderModule.destroy(a),this._decoderModule.destroy(c)}return this}read(e){return this}prewrite(e,r){if(!this._encoderModule)throw new Error(`[${Oe}] Please install extension dependency, "draco3d.encoder".`);const n=this.document.getLogger();n.debug(`[${Oe}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const s=function(f){const h=f.getLogger(),d=new Set,g=new Set;for(const m of f.getRoot().listMeshes())for(const C of m.listPrimitives())C.getIndices()?C.getMode()!==Gr.Mode.TRIANGLES?(g.add(C),h.warn(`[${Oe}] Skipping Draco compression on non-TRIANGLES primitive.`)):d.add(C):(g.add(C),h.warn(`[${Oe}] Skipping Draco compression on non-indexed primitive.`));const x=f.getRoot().listAccessors(),w=new Map;for(let m=0;m<x.length;m++)w.set(x[m],m);const M=new Map,A=new Set,F=new Map;for(const m of Array.from(d)){let C=ua(m,w);if(A.has(C))F.set(m,C);else{if(M.has(m.getIndices())){const T=m.getIndices(),_=T.clone();w.set(_,f.getRoot().listAccessors().length-1),m.swap(T,_)}for(const T of m.listAttributes())if(M.has(T)){const _=T.clone();w.set(_,f.getRoot().listAccessors().length-1),m.swap(T,_)}C=ua(m,w),A.add(C),F.set(m,C),M.set(m.getIndices(),C);for(const T of m.listAttributes())M.set(T,C)}}for(const m of Array.from(M.keys())){const C=new Set(m.listParents().map(T=>T.propertyType));if(C.size!==2||!C.has(W.PRIMITIVE)||!C.has(W.ROOT))throw new Error(`[${Oe}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const m of Array.from(d)){const C=F.get(m),T=m.getIndices();if(M.get(T)!==C||m.listAttributes().some(_=>M.get(_)!==C))throw new Error(`[${Oe}] Draco primitives must share all, or no, accessors.`)}for(const m of Array.from(g)){const C=m.getIndices();if(M.has(C)||m.listAttributes().some(T=>M.has(T)))throw new Error(`[${Oe}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return F}(this.document),a=new Map;let c="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?n.warn(`[${Oe}]: quantizationVolume=scene requires exactly 1 scene.`):c=ph(this.document.getRoot().listScenes().pop()));for(const f of Array.from(s.keys())){const h=s.get(f);if(!h)throw new Error("Unexpected primitive.");if(a.has(h)){a.set(h,a.get(h));continue}const d=f.getIndices(),g=e.jsonDoc.json.accessors;let x;try{x=nd(f,bt({},this._encoderOptions,{quantizationVolume:c}))}catch(A){if(A instanceof _s){n.warn(`[${Oe}]: ${A.message} Skipping primitive compression.`);continue}throw A}a.set(h,x);const w=e.createAccessorDef(d);w.count=x.numIndices,e.accessorIndexMap.set(d,g.length),g.push(w);for(const A of f.listSemantics()){const F=f.getAttribute(A);if(x.attributeIDs[A]===void 0)continue;const m=e.createAccessorDef(F);m.count=x.numVertices,e.accessorIndexMap.set(F,g.length),g.push(m)}const M=f.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(M)||e.otherBufferViews.set(M,[]),e.otherBufferViews.get(M).push(x.data)}return n.debug(`[${Oe}] Compressed ${s.size} primitives.`),e.extensionData[Oe]={primitiveHashMap:s,primitiveEncodingMap:a},this}write(e){const r=e.extensionData[Oe];for(const n of this.document.getRoot().listMeshes()){const s=e.jsonDoc.json.meshes[e.meshIndexMap.get(n)];for(let a=0;a<n.listPrimitives().length;a++){const c=n.listPrimitives()[a],f=s.primitives[a],h=r.primitiveHashMap.get(c);if(!h)continue;const d=r.primitiveEncodingMap.get(h);d&&(f.extensions=f.extensions||{},f.extensions[Oe]={bufferView:e.otherBufferViewsIndexMap.get(d.data),attributes:d.attributeIDs})}}if(!r.primitiveHashMap.size){const n=e.jsonDoc.json;n.extensionsUsed=(n.extensionsUsed||[]).filter(s=>s!==Oe),n.extensionsRequired=(n.extensionsRequired||[]).filter(s=>s!==Oe)}return this}}function ua(t,e){const r=[],n=t.getIndices();r.push(e.get(n));for(const s of t.listAttributes())r.push(e.get(s));return r.sort().join("|")}Rs.EXTENSION_NAME=Oe,Rs.EncoderMethod=qr;class xr extends $e{init(){this.extensionName=Ls,this.propertyType="Light",this.parentTypes=[W.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:xr.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return Ze.factorToHex(this.getColor())}setColorHex(e){const r=this.getColor().slice();return Ze.hexToFactor(e,r),this.setColor(r)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}xr.EXTENSION_NAME=Ls,xr.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const mt=Ls;class to extends Ie{constructor(...e){super(...e),this.extensionName=mt}createLight(e=""){return new xr(this.document.getGraph(),e)}read(e){const r=e.jsonDoc;if(!r.json.extensions||!r.json.extensions[mt])return this;const n=(r.json.extensions[mt].lights||[]).map(s=>{var a,c;const f=this.createLight().setName(s.name||"").setType(s.type);return s.color!==void 0&&f.setColor(s.color),s.intensity!==void 0&&f.setIntensity(s.intensity),s.range!==void 0&&f.setRange(s.range),((a=s.spot)==null?void 0:a.innerConeAngle)!==void 0&&f.setInnerConeAngle(s.spot.innerConeAngle),((c=s.spot)==null?void 0:c.outerConeAngle)!==void 0&&f.setOuterConeAngle(s.spot.outerConeAngle),f});return r.json.nodes.forEach((s,a)=>{s.extensions&&s.extensions[mt]&&e.nodes[a].setExtension(mt,n[s.extensions[mt].light])}),this}write(e){const r=e.jsonDoc;if(this.properties.size===0)return this;const n=[],s=new Map;for(const a of this.properties){const c=a,f={type:c.getType()};Ne.eq(c.getColor(),[1,1,1])||(f.color=c.getColor()),c.getIntensity()!==1&&(f.intensity=c.getIntensity()),c.getRange()!=null&&(f.range=c.getRange()),c.getName()&&(f.name=c.getName()),c.getType()===xr.Type.SPOT&&(f.spot={innerConeAngle:c.getInnerConeAngle(),outerConeAngle:c.getOuterConeAngle()}),n.push(f),s.set(c,n.length-1)}return this.document.getRoot().listNodes().forEach(a=>{const c=a.getExtension(mt);if(c){const f=e.nodeIndexMap.get(a),h=r.json.nodes[f];h.extensions=h.extensions||{},h.extensions[mt]={light:s.get(c)}}}),r.json.extensions=r.json.extensions||{},r.json.extensions[mt]={lights:n},this}}to.EXTENSION_NAME=mt;const{R:ad,G:od,B:cd}=ht;class ro extends $e{init(){this.extensionName=js,this.propertyType="Anisotropy",this.parentTypes=[W.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new Fe(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:ad|od|cd})}}ro.EXTENSION_NAME=js;const Ut=js;class no extends Ie{constructor(...e){super(...e),this.extensionName=Ut}createAnisotropy(){return new ro(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[Ut]){const c=this.createAnisotropy();e.materials[a].setExtension(Ut,c);const f=s.extensions[Ut];if(f.anisotropyStrength!==void 0&&c.setAnisotropyStrength(f.anisotropyStrength),f.anisotropyRotation!==void 0&&c.setAnisotropyRotation(f.anisotropyRotation),f.anisotropyTexture!==void 0){const h=f.anisotropyTexture;c.setAnisotropyTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getAnisotropyTextureInfo(),h)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Ut);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[Ut]={};if(s.getAnisotropyStrength()>0&&(f.anisotropyStrength=s.getAnisotropyStrength()),s.getAnisotropyRotation()!==0&&(f.anisotropyRotation=s.getAnisotropyRotation()),s.getAnisotropyTexture()){const h=s.getAnisotropyTexture(),d=s.getAnisotropyTextureInfo();f.anisotropyTexture=e.createTextureInfoDef(h,d)}}}),this}}no.EXTENSION_NAME=Ut;const{R:ha,G:da,B:ld}=ht;class so extends $e{init(){this.extensionName=Bs,this.propertyType="Clearcoat",this.parentTypes=[W.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new Fe(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new Fe(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new Fe(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:ha})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:da})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:ha|da|ld})}}so.EXTENSION_NAME=Bs;const Lt=Bs;class io extends Ie{constructor(...e){super(...e),this.extensionName=Lt}createClearcoat(){return new so(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[Lt]){const c=this.createClearcoat();e.materials[a].setExtension(Lt,c);const f=s.extensions[Lt];if(f.clearcoatFactor!==void 0&&c.setClearcoatFactor(f.clearcoatFactor),f.clearcoatRoughnessFactor!==void 0&&c.setClearcoatRoughnessFactor(f.clearcoatRoughnessFactor),f.clearcoatTexture!==void 0){const h=f.clearcoatTexture;c.setClearcoatTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getClearcoatTextureInfo(),h)}if(f.clearcoatRoughnessTexture!==void 0){const h=f.clearcoatRoughnessTexture;c.setClearcoatRoughnessTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getClearcoatRoughnessTextureInfo(),h)}if(f.clearcoatNormalTexture!==void 0){const h=f.clearcoatNormalTexture;c.setClearcoatNormalTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getClearcoatNormalTextureInfo(),h),h.scale!==void 0&&c.setClearcoatNormalScale(h.scale)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Lt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[Lt]={clearcoatFactor:s.getClearcoatFactor(),clearcoatRoughnessFactor:s.getClearcoatRoughnessFactor()};if(s.getClearcoatTexture()){const h=s.getClearcoatTexture(),d=s.getClearcoatTextureInfo();f.clearcoatTexture=e.createTextureInfoDef(h,d)}if(s.getClearcoatRoughnessTexture()){const h=s.getClearcoatRoughnessTexture(),d=s.getClearcoatRoughnessTextureInfo();f.clearcoatRoughnessTexture=e.createTextureInfoDef(h,d)}if(s.getClearcoatNormalTexture()){const h=s.getClearcoatNormalTexture(),d=s.getClearcoatNormalTextureInfo();f.clearcoatNormalTexture=e.createTextureInfoDef(h,d),s.getClearcoatNormalScale()!==1&&(f.clearcoatNormalTexture.scale=s.getClearcoatNormalScale())}}}),this}}io.EXTENSION_NAME=Lt;class ao extends $e{init(){this.extensionName=Vs,this.propertyType="EmissiveStrength",this.parentTypes=[W.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}ao.EXTENSION_NAME=Vs;const jt=Vs;class oo extends Ie{constructor(...e){super(...e),this.extensionName=jt}createEmissiveStrength(){return new ao(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((r,n)=>{if(r.extensions&&r.extensions[jt]){const s=this.createEmissiveStrength();e.materials[n].setExtension(jt,s);const a=r.extensions[jt];a.emissiveStrength!==void 0&&s.setEmissiveStrength(a.emissiveStrength)}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(jt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{},c.extensions[jt]={emissiveStrength:s.getEmissiveStrength()}}}),this}}oo.EXTENSION_NAME=jt;class co extends $e{init(){this.extensionName=zs,this.propertyType="IOR",this.parentTypes=[W.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}co.EXTENSION_NAME=zs;const Bt=zs;class lo extends Ie{constructor(...e){super(...e),this.extensionName=Bt}createIOR(){return new co(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((r,n)=>{if(r.extensions&&r.extensions[Bt]){const s=this.createIOR();e.materials[n].setExtension(Bt,s);const a=r.extensions[Bt];a.ior!==void 0&&s.setIOR(a.ior)}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Bt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{},c.extensions[Bt]={ior:s.getIOR()}}}),this}}lo.EXTENSION_NAME=Bt;const{R:fd,G:ud}=ht;class fo extends $e{init(){this.extensionName=Gs,this.propertyType="Iridescence",this.parentTypes=[W.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new Fe(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new Fe(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:fd})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:ud})}}fo.EXTENSION_NAME=Gs;const Vt=Gs;class uo extends Ie{constructor(...e){super(...e),this.extensionName=Vt}createIridescence(){return new fo(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[Vt]){const c=this.createIridescence();e.materials[a].setExtension(Vt,c);const f=s.extensions[Vt];if(f.iridescenceFactor!==void 0&&c.setIridescenceFactor(f.iridescenceFactor),f.iridescenceIor!==void 0&&c.setIridescenceIOR(f.iridescenceIor),f.iridescenceThicknessMinimum!==void 0&&c.setIridescenceThicknessMinimum(f.iridescenceThicknessMinimum),f.iridescenceThicknessMaximum!==void 0&&c.setIridescenceThicknessMaximum(f.iridescenceThicknessMaximum),f.iridescenceTexture!==void 0){const h=f.iridescenceTexture;c.setIridescenceTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getIridescenceTextureInfo(),h)}if(f.iridescenceThicknessTexture!==void 0){const h=f.iridescenceThicknessTexture;c.setIridescenceThicknessTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getIridescenceThicknessTextureInfo(),h)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Vt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[Vt]={};if(s.getIridescenceFactor()>0&&(f.iridescenceFactor=s.getIridescenceFactor()),s.getIridescenceIOR()!==1.3&&(f.iridescenceIor=s.getIridescenceIOR()),s.getIridescenceThicknessMinimum()!==100&&(f.iridescenceThicknessMinimum=s.getIridescenceThicknessMinimum()),s.getIridescenceThicknessMaximum()!==400&&(f.iridescenceThicknessMaximum=s.getIridescenceThicknessMaximum()),s.getIridescenceTexture()){const h=s.getIridescenceTexture(),d=s.getIridescenceTextureInfo();f.iridescenceTexture=e.createTextureInfoDef(h,d)}if(s.getIridescenceThicknessTexture()){const h=s.getIridescenceThicknessTexture(),d=s.getIridescenceThicknessTextureInfo();f.iridescenceThicknessTexture=e.createTextureInfoDef(h,d)}}}),this}}uo.EXTENSION_NAME=Vt;const{R:pa,G:ga,B:ma,A:va}=ht;class ho extends $e{init(){this.extensionName=Hs,this.propertyType="PBRSpecularGlossiness",this.parentTypes=[W.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new Fe(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new Fe(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return Ze.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const r=this.getDiffuseFactor().slice();return this.setDiffuseFactor(Ze.hexToFactor(e,r))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:pa|ga|ma|va,isColor:!0})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:pa|ga|ma|va})}}ho.EXTENSION_NAME=Hs;const zt=Hs;class po extends Ie{constructor(...e){super(...e),this.extensionName=zt}createPBRSpecularGlossiness(){return new ho(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[zt]){const c=this.createPBRSpecularGlossiness();e.materials[a].setExtension(zt,c);const f=s.extensions[zt];if(f.diffuseFactor!==void 0&&c.setDiffuseFactor(f.diffuseFactor),f.specularFactor!==void 0&&c.setSpecularFactor(f.specularFactor),f.glossinessFactor!==void 0&&c.setGlossinessFactor(f.glossinessFactor),f.diffuseTexture!==void 0){const h=f.diffuseTexture;c.setDiffuseTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getDiffuseTextureInfo(),h)}if(f.specularGlossinessTexture!==void 0){const h=f.specularGlossinessTexture;c.setSpecularGlossinessTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getSpecularGlossinessTextureInfo(),h)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(zt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[zt]={diffuseFactor:s.getDiffuseFactor(),specularFactor:s.getSpecularFactor(),glossinessFactor:s.getGlossinessFactor()};if(s.getDiffuseTexture()){const h=s.getDiffuseTexture(),d=s.getDiffuseTextureInfo();f.diffuseTexture=e.createTextureInfoDef(h,d)}if(s.getSpecularGlossinessTexture()){const h=s.getSpecularGlossinessTexture(),d=s.getSpecularGlossinessTextureInfo();f.specularGlossinessTexture=e.createTextureInfoDef(h,d)}}}),this}}po.EXTENSION_NAME=zt;const{R:hd,G:dd,B:pd,A:gd}=ht;class go extends $e{init(){this.extensionName=qs,this.propertyType="Sheen",this.parentTypes=[W.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new Fe(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new Fe(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return Ze.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const r=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",Ze.hexToFactor(e,r))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:hd|dd|pd,isColor:!0})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:gd})}}go.EXTENSION_NAME=qs;const Gt=qs;class mo extends Ie{constructor(...e){super(...e),this.extensionName=Gt}createSheen(){return new go(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[Gt]){const c=this.createSheen();e.materials[a].setExtension(Gt,c);const f=s.extensions[Gt];if(f.sheenColorFactor!==void 0&&c.setSheenColorFactor(f.sheenColorFactor),f.sheenRoughnessFactor!==void 0&&c.setSheenRoughnessFactor(f.sheenRoughnessFactor),f.sheenColorTexture!==void 0){const h=f.sheenColorTexture;c.setSheenColorTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getSheenColorTextureInfo(),h)}if(f.sheenRoughnessTexture!==void 0){const h=f.sheenRoughnessTexture;c.setSheenRoughnessTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getSheenRoughnessTextureInfo(),h)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Gt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[Gt]={sheenColorFactor:s.getSheenColorFactor(),sheenRoughnessFactor:s.getSheenRoughnessFactor()};if(s.getSheenColorTexture()){const h=s.getSheenColorTexture(),d=s.getSheenColorTextureInfo();f.sheenColorTexture=e.createTextureInfoDef(h,d)}if(s.getSheenRoughnessTexture()){const h=s.getSheenRoughnessTexture(),d=s.getSheenRoughnessTextureInfo();f.sheenRoughnessTexture=e.createTextureInfoDef(h,d)}}}),this}}mo.EXTENSION_NAME=Gt;const{R:md,G:vd,B:yd,A:xd}=ht;class vo extends $e{init(){this.extensionName=Ws,this.propertyType="Specular",this.parentTypes=[W.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new Fe(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new Fe(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return Ze.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const r=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",Ze.hexToFactor(e,r))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:xd})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:md|vd|yd,isColor:!0})}}vo.EXTENSION_NAME=Ws;const Ht=Ws;class yo extends Ie{constructor(...e){super(...e),this.extensionName=Ht}createSpecular(){return new vo(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[Ht]){const c=this.createSpecular();e.materials[a].setExtension(Ht,c);const f=s.extensions[Ht];if(f.specularFactor!==void 0&&c.setSpecularFactor(f.specularFactor),f.specularColorFactor!==void 0&&c.setSpecularColorFactor(f.specularColorFactor),f.specularTexture!==void 0){const h=f.specularTexture;c.setSpecularTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getSpecularTextureInfo(),h)}if(f.specularColorTexture!==void 0){const h=f.specularColorTexture;c.setSpecularColorTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getSpecularColorTextureInfo(),h)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Ht);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[Ht]={};if(s.getSpecularFactor()!==1&&(f.specularFactor=s.getSpecularFactor()),Ne.eq(s.getSpecularColorFactor(),[1,1,1])||(f.specularColorFactor=s.getSpecularColorFactor()),s.getSpecularTexture()){const h=s.getSpecularTexture(),d=s.getSpecularTextureInfo();f.specularTexture=e.createTextureInfoDef(h,d)}if(s.getSpecularColorTexture()){const h=s.getSpecularColorTexture(),d=s.getSpecularColorTextureInfo();f.specularColorTexture=e.createTextureInfoDef(h,d)}}}),this}}yo.EXTENSION_NAME=Ht;const{R:Td}=ht;class xo extends $e{init(){this.extensionName=Xs,this.propertyType="Transmission",this.parentTypes=[W.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new Fe(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:Td})}}xo.EXTENSION_NAME=Xs;const qt=Xs;class To extends Ie{constructor(...e){super(...e),this.extensionName=qt}createTransmission(){return new xo(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[qt]){const c=this.createTransmission();e.materials[a].setExtension(qt,c);const f=s.extensions[qt];if(f.transmissionFactor!==void 0&&c.setTransmissionFactor(f.transmissionFactor),f.transmissionTexture!==void 0){const h=f.transmissionTexture;c.setTransmissionTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getTransmissionTextureInfo(),h)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(qt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[qt]={transmissionFactor:s.getTransmissionFactor()};if(s.getTransmissionTexture()){const h=s.getTransmissionTexture(),d=s.getTransmissionTextureInfo();f.transmissionTexture=e.createTextureInfoDef(h,d)}}}),this}}To.EXTENSION_NAME=qt;class Eo extends $e{init(){this.extensionName=Ys,this.propertyType="Unlit",this.parentTypes=[W.MATERIAL]}}Eo.EXTENSION_NAME=Ys;const fr=Ys;class Zs extends Ie{constructor(...e){super(...e),this.extensionName=fr}createUnlit(){return new Eo(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((r,n)=>{r.extensions&&r.extensions[fr]&&e.materials[n].setExtension(fr,this.createUnlit())}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{if(n.getExtension(fr)){const s=e.materialIndexMap.get(n),a=r.json.materials[s];a.extensions=a.extensions||{},a.extensions[fr]={}}}),this}}Zs.EXTENSION_NAME=fr;class wo extends $e{init(){this.extensionName=tr,this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}wo.EXTENSION_NAME=tr;class Mo extends $e{init(){this.extensionName=tr,this.propertyType="MappingList",this.parentTypes=[W.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}Mo.EXTENSION_NAME=tr;class bs extends $e{init(){this.extensionName=tr,this.propertyType="Variant",this.parentTypes=["MappingList"]}}bs.EXTENSION_NAME=tr;const vt=tr;class _o extends Ie{constructor(...e){super(...e),this.extensionName=vt}createMappingList(){return new Mo(this.document.getGraph())}createVariant(e=""){return new bs(this.document.getGraph(),e)}createMapping(){return new wo(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof bs)}read(e){const r=e.jsonDoc;if(!r.json.extensions||!r.json.extensions[vt])return this;const n=(r.json.extensions[vt].variants||[]).map(s=>this.createVariant().setName(s.name||""));return(r.json.meshes||[]).forEach((s,a)=>{const c=e.meshes[a];(s.primitives||[]).forEach((f,h)=>{if(!f.extensions||!f.extensions[vt])return;const d=this.createMappingList(),g=f.extensions[vt];for(const x of g.mappings){const w=this.createMapping();x.material!==void 0&&w.setMaterial(e.materials[x.material]);for(const M of x.variants||[])w.addVariant(n[M]);d.addMapping(w)}c.listPrimitives()[h].setExtension(vt,d)})}),this}write(e){const r=e.jsonDoc,n=this.listVariants();if(!n.length)return this;const s=[],a=new Map;for(const c of n)a.set(c,s.length),s.push(e.createPropertyDef(c));for(const c of this.document.getRoot().listMeshes()){const f=e.meshIndexMap.get(c);c.listPrimitives().forEach((h,d)=>{const g=h.getExtension(vt);if(!g)return;const x=e.jsonDoc.json.meshes[f].primitives[d],w=g.listMappings().map(M=>{const A=e.createPropertyDef(M),F=M.getMaterial();return F&&(A.material=e.materialIndexMap.get(F)),A.variants=M.listVariants().map(m=>a.get(m)),A});x.extensions=x.extensions||{},x.extensions[vt]={mappings:w}})}return r.json.extensions=r.json.extensions||{},r.json.extensions[vt]={variants:s},this}}_o.EXTENSION_NAME=vt;const{G:Ed}=ht;class Ro extends $e{init(){this.extensionName=Ks,this.propertyType="Volume",this.parentTypes=[W.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new Fe(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:Ed})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return Ze.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const r=this.getAttenuationColor().slice();return this.set("attenuationColor",Ze.hexToFactor(e,r))}}Ro.EXTENSION_NAME=Ks;const Wt=Ks;class bo extends Ie{constructor(...e){super(...e),this.extensionName=Wt}createVolume(){return new Ro(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[Wt]){const c=this.createVolume();e.materials[a].setExtension(Wt,c);const f=s.extensions[Wt];if(f.thicknessFactor!==void 0&&c.setThicknessFactor(f.thicknessFactor),f.attenuationDistance!==void 0&&c.setAttenuationDistance(f.attenuationDistance),f.attenuationColor!==void 0&&c.setAttenuationColor(f.attenuationColor),f.thicknessTexture!==void 0){const h=f.thicknessTexture;c.setThicknessTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getThicknessTextureInfo(),h)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Wt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[Wt]={};if(s.getThicknessFactor()>0&&(f.thicknessFactor=s.getThicknessFactor()),Number.isFinite(s.getAttenuationDistance())&&(f.attenuationDistance=s.getAttenuationDistance()),Ne.eq(s.getAttenuationColor(),[1,1,1])||(f.attenuationColor=s.getAttenuationColor()),s.getThicknessTexture()){const h=s.getThicknessTexture(),d=s.getThicknessTextureInfo();f.thicknessTexture=e.createTextureInfoDef(h,d)}}}),this}}bo.EXTENSION_NAME=Wt;const Ao="KHR_mesh_quantization";class Io extends Ie{constructor(...e){super(...e),this.extensionName=Ao}read(e){return this}write(e){return this}}Io.EXTENSION_NAME=Ao;const Ur="KHR_texture_basisu";class wd{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const r=fs(e);return[r.pixelWidth,r.pixelHeight]}getChannels(e){const r=fs(e).dataFormatDescriptor[0];if(r.colorModel===Lh)return r.samples.length===2&&(15&r.samples[1].channelType)==15?4:3;if(r.colorModel===jh)return(15&r.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${r.colorModel}".`)}getVRAMByteLength(e){const r=fs(e),n=this.getChannels(e)>3;let s=0;for(let a=0;a<r.levels.length;a++){const c=r.levels[a];s+=c.uncompressedByteLength?c.uncompressedByteLength:Math.max(1,Math.floor(r.pixelWidth/Math.pow(2,a)))/4*(Math.max(1,Math.floor(r.pixelHeight/Math.pow(2,a)))/4)*(n?16:8)}return s}}class So extends Ie{constructor(...e){super(...e),this.extensionName=Ur,this.prereadTypes=[W.TEXTURE]}static register(){xt.registerFormat("image/ktx2",new wd)}preread(e){return e.jsonDoc.json.textures.forEach(r=>{r.extensions&&r.extensions[Ur]&&(r.source=r.extensions[Ur].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/ktx2"){const s=e.imageIndexMap.get(n);r.json.textures.forEach(a=>{a.source===s&&(a.extensions=a.extensions||{},a.extensions[Ur]={source:a.source},delete a.source)})}}),this}}So.EXTENSION_NAME=Ur;class Co extends $e{init(){this.extensionName=Js,this.propertyType="Transform",this.parentTypes=[W.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}Co.EXTENSION_NAME=Js;const Xt=Js;class No extends Ie{constructor(...e){super(...e),this.extensionName=Xt}createTransform(){return new Co(this.document.getGraph())}read(e){for(const[r,n]of Array.from(e.textureInfos.entries())){if(!n.extensions||!n.extensions[Xt])continue;const s=this.createTransform(),a=n.extensions[Xt];a.offset!==void 0&&s.setOffset(a.offset),a.rotation!==void 0&&s.setRotation(a.rotation),a.scale!==void 0&&s.setScale(a.scale),a.texCoord!==void 0&&s.setTexCoord(a.texCoord),r.setExtension(Xt,s)}return this}write(e){const r=Array.from(e.textureInfoDefMap.entries());for(const[n,s]of r){const a=n.getExtension(Xt);if(!a)continue;s.extensions=s.extensions||{};const c={},f=Ne.eq;f(a.getOffset(),[0,0])||(c.offset=a.getOffset()),a.getRotation()!==0&&(c.rotation=a.getRotation()),f(a.getScale(),[1,1])||(c.scale=a.getScale()),a.getTexCoord()!=null&&(c.texCoord=a.getTexCoord()),s.extensions[Xt]=c}return this}}No.EXTENSION_NAME=Xt;const Md=[W.ROOT,W.SCENE,W.NODE,W.MESH,W.MATERIAL,W.TEXTURE,W.ANIMATION];class Fo extends $e{init(){this.extensionName=An,this.propertyType="Packet",this.parentTypes=Md}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",bt({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const r=this.get("properties");return e in r?r[e]:null}setProperty(e,r){this._assertContext(e);const n=bt({},this.get("properties"));return r?n[e]=r:delete n[e],this.set("properties",n)}toJSONLD(){return bt({"@context":hs(this.get("context"))},hs(this.get("properties")))}fromJSONLD(e){const r=(e=hs(e))["@context"];return r&&this.set("context",r),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`${An}: Missing context for term, "${e}".`)}}function hs(t){return JSON.parse(JSON.stringify(t))}Fo.EXTENSION_NAME=An;const Rt=An;class Oo extends Ie{constructor(...e){super(...e),this.extensionName=Rt}createPacket(){return new Fo(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var r;const n=(r=e.jsonDoc.json.extensions)==null?void 0:r[Rt];if(!n||!n.packets)return this;const s=e.jsonDoc.json,a=this.document.getRoot(),c=n.packets.map(d=>this.createPacket().fromJSONLD(d)),f=[[s.asset],s.scenes,s.nodes,s.meshes,s.materials,s.images,s.animations],h=[[a],a.listScenes(),a.listNodes(),a.listMeshes(),a.listMaterials(),a.listTextures(),a.listAnimations()];for(let d=0;d<f.length;d++){const g=f[d]||[];for(let x=0;x<g.length;x++){const w=g[x];w.extensions&&w.extensions[Rt]&&h[d][x].setExtension(Rt,c[w.extensions[Rt].packet])}}return this}write(e){const{json:r}=e.jsonDoc,n=[];for(const s of this.properties){n.push(s.toJSONLD());for(const a of s.listParents()){let c;switch(a.propertyType){case W.ROOT:c=r.asset;break;case W.SCENE:c=r.scenes[e.sceneIndexMap.get(a)];break;case W.NODE:c=r.nodes[e.nodeIndexMap.get(a)];break;case W.MESH:c=r.meshes[e.meshIndexMap.get(a)];break;case W.MATERIAL:c=r.materials[e.materialIndexMap.get(a)];break;case W.TEXTURE:c=r.images[e.imageIndexMap.get(a)];break;case W.ANIMATION:c=r.animations[e.animationIndexMap.get(a)];break;default:c=null,this.document.getLogger().warn(`[${Rt}]: Unsupported parent property, "${a.propertyType}"`)}c&&(c.extensions=c.extensions||{},c.extensions[Rt]={packet:n.length-1})}}return n.length>0&&(r.extensions=r.extensions||{},r.extensions[Rt]={packets:n}),this}}Oo.EXTENSION_NAME=Rt;const Do=[Rs,to,no,io,oo,lo,uo,po,yo,mo,To,Zs,_o,bo,Io,So,No,Oo];[...Do];const $o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Po=t=>{let e="";for(let r=0;r<16;r++)r%4!=3&&(r>0&&(e+=" "),e+=t[r]||0);return e},_d=(t=1,e=$o)=>`    <item objectid="${t}" transform="${Po(e)}" />
`,ya=t=>t?t.toISOString().substring(0,10):"";function Rd(t,{unit:e="millimeter",title:r="jscad model",author:n="",description:s="",application:a="jscad",creationDate:c=new Date,license:f="",modificationDate:h}={}){t.push(`<?xml version="1.0" encoding="UTF-8"?>
<model unit="${e}" xml:lang="en-US" xmlns="http://schemas.microsoft.com/3dmanufacturing/core/2015/02" xmlns:slic3rpe="http://schemas.slic3r.org/3mf/2017/06">
  <metadata name="slic3rpe:Version3mf">1</metadata>
  <metadata name="Title">${r}</metadata>
  <metadata name="Designer">${n}</metadata>
  <metadata name="Description">${s||r}</metadata>
  <metadata name="Copyright"></metadata>
  <metadata name="LicenseTerms">${f}</metadata>
  <metadata name="Rating"></metadata>
  <metadata name="CreationDate">${ya(c)}</metadata>
  <metadata name="ModificationDate">${ya(h||c)}</metadata>
  <metadata name="Application">${a}</metadata>
   `)}function bd(t,e,r,n){t.push(`<object id="${e}" type="model"${n==null?"":' name="'+n+'"'}>
`),t.push(` <components>
`),r.forEach(({objectID:s,transform:a})=>{Ad(t,s,a)}),t.push(` </components>
`),t.push(`</object>
`)}const Ad=(t,e=1,r=$o)=>{t.push(`    <component objectid="${e}" transform="${Po(r)}" />
`)};function Id(t,e,r,n,s,a){t.push(`  <object id="${e}" type="model"${a?' name="'+a+'"':""}>
   <mesh>
    <vertices>
`);for(let c=0;c<r.length;c+=3)t.push(`     <vertex x="${r[c].toPrecision(s)}" y="${r[c+1].toPrecision(s)}" z="${r[c+2].toPrecision(s)}" />
`);t.push(`    </vertices>
    <triangles>
`);for(let c=0;c<n.length;c+=3)t.push(`     <triangle v1="${n[c]}" v2="${n[c+1]}" v3="${n[c+2]}" />
`);return t.push(`    </triangles>
   </mesh>
  </object>
`),t}const xa={name:"[Content_Types].xml",content:`<?xml version="1.0" encoding="UTF-8"?>
<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">
<Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml" />
<Default Extension="model" ContentType="application/vnd.ms-package.3dmanufacturing-3dmodel+xml" />
<Default Extension="png" ContentType="image/png" />
</Types>`};function Sd({meshes:t=[],components:e=[],items:r=[],precision:n=17,header:s}){const a=[];return Rd(a,s),a.push(`  <resources>
`),r.length==0&&console.error("3MF empty build! Include items or simple."),t.forEach(({id:c,vertices:f,indices:h,name:d})=>Id(a,c,f,h,n,d)),e.forEach(({id:c,children:f,name:h})=>{bd(a,c,f,h)}),a.push(`  </resources>
`),a.push(`<build>
`),r.forEach(({objectID:c,transform:f})=>{a.push(_d(c,f))}),a.push(`</build>
`),a.push(`</model>
`),a.join("")}class Cd{constructor(){this.idSeq=0,this.lines=['<?xml version="1.0" encoding="UTF-8"?>','<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">']}get name(){return"_rels/.rels"}addRel(e,r){this.lines.push(`  <Relationship Target="${e}" Id="rel-${++this.idSeq}" Type="${r}" />`)}add3dModel(e){this.addRel(e,"http://schemas.microsoft.com/3dmanufacturing/2013/01/3dmodel")}addThumbnail(e){this.addRel(e,"http://schemas.openxmlformats.org/package/2006/relationships/metadata/thumbnail")}get content(){return this.lines.join(`
`)+`
</Relationships>`}}var He=Uint8Array,et=Uint16Array,Qs=Int32Array,ei=new He([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ti=new He([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ta=new He([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ko=function(t,e){for(var r=new et(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var s=new Qs(r[30]),n=1;n<30;++n)for(var a=r[n];a<r[n+1];++a)s[a]=a-r[n]<<5|n;return{b:r,r:s}},Uo=ko(ei,2),Nd=Uo.b,As=Uo.r;Nd[28]=258,As[258]=28;var Fd=ko(ti,0),Ea=Fd.r,Is=new et(32768);for(var Re=0;Re<32768;++Re){var Ct=(Re&43690)>>1|(Re&21845)<<1;Ct=(Ct&52428)>>2|(Ct&13107)<<2,Ct=(Ct&61680)>>4|(Ct&3855)<<4,Is[Re]=((Ct&65280)>>8|(Ct&255)<<8)>>1}var Vr=function(t,e,r){for(var n=t.length,s=0,a=new et(e);s<n;++s)t[s]&&++a[t[s]-1];var c=new et(e);for(s=1;s<e;++s)c[s]=c[s-1]+a[s-1]<<1;var f;if(r){f=new et(1<<e);var h=15-e;for(s=0;s<n;++s)if(t[s])for(var d=s<<4|t[s],g=e-t[s],x=c[t[s]-1]++<<g,w=x|(1<<g)-1;x<=w;++x)f[Is[x]>>h]=d}else for(f=new et(n),s=0;s<n;++s)t[s]&&(f[s]=Is[c[t[s]-1]++]>>15-t[s]);return f},er=new He(288);for(var Re=0;Re<144;++Re)er[Re]=8;for(var Re=144;Re<256;++Re)er[Re]=9;for(var Re=256;Re<280;++Re)er[Re]=7;for(var Re=280;Re<288;++Re)er[Re]=8;var In=new He(32);for(var Re=0;Re<32;++Re)In[Re]=5;var Od=Vr(er,9,0),Dd=Vr(In,5,0),Lo=function(t){return(t+7)/8|0},jo=function(t,e,r){(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length);var n=new He(r-e);return n.set(t.subarray(e,r)),n},$d=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],kn=function(t,e,r){var n=new Error(e||$d[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,kn),!r)throw n;return n},_t=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8},Cr=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8,t[n+2]|=r>>16},ds=function(t,e){for(var r=[],n=0;n<t.length;++n)t[n]&&r.push({s:n,f:t[n]});var s=r.length,a=r.slice();if(!s)return{t:Vo,l:0};if(s==1){var c=new He(r[0].s+1);return c[r[0].s]=1,{t:c,l:1}}r.sort(function(N,$){return N.f-$.f}),r.push({s:-1,f:25001});var f=r[0],h=r[1],d=0,g=1,x=2;for(r[0]={s:-1,f:f.f+h.f,l:f,r:h};g!=s-1;)f=r[r[d].f<r[x].f?d++:x++],h=r[d!=g&&r[d].f<r[x].f?d++:x++],r[g++]={s:-1,f:f.f+h.f,l:f,r:h};for(var w=a[0].s,n=1;n<s;++n)a[n].s>w&&(w=a[n].s);var M=new et(w+1),A=Ss(r[g-1],M,0);if(A>e){var n=0,F=0,m=A-e,C=1<<m;for(a.sort(function($,z){return M[z.s]-M[$.s]||$.f-z.f});n<s;++n){var T=a[n].s;if(M[T]>e)F+=C-(1<<A-M[T]),M[T]=e;else break}for(F>>=m;F>0;){var _=a[n].s;M[_]<e?F-=1<<e-M[_]++-1:++n}for(;n>=0&&F;--n){var b=a[n].s;M[b]==e&&(--M[b],++F)}A=e}return{t:new He(M),l:A}},Ss=function(t,e,r){return t.s==-1?Math.max(Ss(t.l,e,r+1),Ss(t.r,e,r+1)):e[t.s]=r},wa=function(t){for(var e=t.length;e&&!t[--e];);for(var r=new et(++e),n=0,s=t[0],a=1,c=function(h){r[n++]=h},f=1;f<=e;++f)if(t[f]==s&&f!=e)++a;else{if(!s&&a>2){for(;a>138;a-=138)c(32754);a>2&&(c(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(c(s),--a;a>6;a-=6)c(8304);a>2&&(c(a-3<<5|8208),a=0)}for(;a--;)c(s);a=1,s=t[f]}return{c:r.subarray(0,n),n:e}},Nr=function(t,e){for(var r=0,n=0;n<e.length;++n)r+=t[n]*e[n];return r},Bo=function(t,e,r){var n=r.length,s=Lo(e+2);t[s]=n&255,t[s+1]=n>>8,t[s+2]=t[s]^255,t[s+3]=t[s+1]^255;for(var a=0;a<n;++a)t[s+a+4]=r[a];return(s+4+n)*8},Ma=function(t,e,r,n,s,a,c,f,h,d,g){_t(e,g++,r),++s[256];for(var x=ds(s,15),w=x.t,M=x.l,A=ds(a,15),F=A.t,m=A.l,C=wa(w),T=C.c,_=C.n,b=wa(F),N=b.c,$=b.n,z=new et(19),B=0;B<T.length;++B)++z[T[B]&31];for(var B=0;B<N.length;++B)++z[N[B]&31];for(var k=ds(z,7),G=k.t,H=k.l,K=19;K>4&&!G[Ta[K-1]];--K);var L=d+5<<3,U=Nr(s,er)+Nr(a,In)+c,ee=Nr(s,w)+Nr(a,F)+c+14+3*K+Nr(z,G)+2*z[16]+3*z[17]+7*z[18];if(h>=0&&L<=U&&L<=ee)return Bo(e,g,t.subarray(h,h+d));var fe,re,ye,me;if(_t(e,g,1+(ee<U)),g+=2,ee<U){fe=Vr(w,M,0),re=w,ye=Vr(F,m,0),me=F;var xe=Vr(G,H,0);_t(e,g,_-257),_t(e,g+5,$-1),_t(e,g+10,K-4),g+=14;for(var B=0;B<K;++B)_t(e,g+3*B,G[Ta[B]]);g+=3*K;for(var Te=[T,N],_e=0;_e<2;++_e)for(var ke=Te[_e],B=0;B<ke.length;++B){var be=ke[B]&31;_t(e,g,xe[be]),g+=G[be],be>15&&(_t(e,g,ke[B]>>5&127),g+=ke[B]>>12)}}else fe=Od,re=er,ye=Dd,me=In;for(var B=0;B<f;++B){var Se=n[B];if(Se>255){var be=Se>>18&31;Cr(e,g,fe[be+257]),g+=re[be+257],be>7&&(_t(e,g,Se>>23&31),g+=ei[be]);var Qe=Se&31;Cr(e,g,ye[Qe]),g+=me[Qe],Qe>3&&(Cr(e,g,Se>>5&8191),g+=ti[Qe])}else Cr(e,g,fe[Se]),g+=re[Se]}return Cr(e,g,fe[256]),g+re[256]},Pd=new Qs([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Vo=new He(0),kd=function(t,e,r,n,s,a){var c=a.z||t.length,f=new He(n+c+5*(1+Math.ceil(c/7e3))+s),h=f.subarray(n,f.length-s),d=a.l,g=(a.r||0)&7;if(e){g&&(h[0]=a.r>>3);for(var x=Pd[e-1],w=x>>13,M=x&8191,A=(1<<r)-1,F=a.p||new et(32768),m=a.h||new et(A+1),C=Math.ceil(r/3),T=2*C,_=function(It){return(t[It]^t[It+1]<<C^t[It+2]<<T)&A},b=new Qs(25e3),N=new et(288),$=new et(32),z=0,B=0,k=a.i||0,G=0,H=a.w||0,K=0;k+2<c;++k){var L=_(k),U=k&32767,ee=m[L];if(F[U]=ee,m[L]=U,H<=k){var fe=c-k;if((z>7e3||G>24576)&&(fe>423||!d)){g=Ma(t,h,0,b,N,$,B,G,K,k-K,g),G=z=B=0,K=k;for(var re=0;re<286;++re)N[re]=0;for(var re=0;re<30;++re)$[re]=0}var ye=2,me=0,xe=M,Te=U-ee&32767;if(fe>2&&L==_(k-Te))for(var _e=Math.min(w,fe)-1,ke=Math.min(32767,k),be=Math.min(258,fe);Te<=ke&&--xe&&U!=ee;){if(t[k+ye]==t[k+ye-Te]){for(var Se=0;Se<be&&t[k+Se]==t[k+Se-Te];++Se);if(Se>ye){if(ye=Se,me=Te,Se>_e)break;for(var Qe=Math.min(Te,Se-2),Ve=0,re=0;re<Qe;++re){var rt=k-Te+re&32767,Ce=F[rt],dt=rt-Ce&32767;dt>Ve&&(Ve=dt,ee=rt)}}}U=ee,ee=F[U],Te+=U-ee&32767}if(me){b[G++]=268435456|As[ye]<<18|Ea[me];var ze=As[ye]&31,qe=Ea[me]&31;B+=ei[ze]+ti[qe],++N[257+ze],++$[qe],H=k+ye,++z}else b[G++]=t[k],++N[t[k]]}}for(k=Math.max(k,H);k<c;++k)b[G++]=t[k],++N[t[k]];g=Ma(t,h,d,b,N,$,B,G,K,k-K,g),d||(a.r=g&7|h[g/8|0]<<3,g-=7,a.h=m,a.p=F,a.i=k,a.w=H)}else{for(var k=a.w||0;k<c+d;k+=65535){var Nt=k+65535;Nt>=c&&(h[g/8|0]=d,Nt=c),g=Bo(h,g+1,t.subarray(k,Nt))}a.i=c}return jo(f,0,n+Lo(g)+s)},Ud=function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var r=e,n=9;--n;)r=(r&1&&-306674912)^r>>>1;t[e]=r}return t}(),Ld=function(){var t=-1;return{p:function(e){for(var r=t,n=0;n<e.length;++n)r=Ud[r&255^e[n]]^r>>>8;t=r},d:function(){return~t}}},jd=function(t,e,r,n,s){if(!s&&(s={l:1},e.dictionary)){var a=e.dictionary.subarray(-32768),c=new He(a.length+t.length);c.set(a),c.set(t,a.length),t=c,s.w=a.length}return kd(t,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):12+e.mem,r,n,s)},zo=function(t,e){var r={};for(var n in t)r[n]=t[n];for(var n in e)r[n]=e[n];return r},Ge=function(t,e,r){for(;r;++e)t[e]=r,r>>>=8};function Bd(t,e){return jd(t,e||{},0,0)}var Go=function(t,e,r,n){for(var s in t){var a=t[s],c=e+s,f=n;Array.isArray(a)&&(f=zo(n,a[1]),a=a[0]),a instanceof He?r[c]=[a,f]:(r[c+="/"]=[new He(0),f],Go(a,c,r,n))}},_a=typeof TextEncoder<"u"&&new TextEncoder,Vd=typeof TextDecoder<"u"&&new TextDecoder,zd=0;try{Vd.decode(Vo,{stream:!0}),zd=1}catch{}function zr(t,e){if(e){for(var r=new He(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r}if(_a)return _a.encode(t);for(var s=t.length,a=new He(t.length+(t.length>>1)),c=0,f=function(g){a[c++]=g},n=0;n<s;++n){if(c+5>a.length){var h=new He(c+8+(s-n<<1));h.set(a),a=h}var d=t.charCodeAt(n);d<128||e?f(d):d<2048?(f(192|d>>6),f(128|d&63)):d>55295&&d<57344?(d=65536+(d&1047552)|t.charCodeAt(++n)&1023,f(240|d>>18),f(128|d>>12&63),f(128|d>>6&63),f(128|d&63)):(f(224|d>>12),f(128|d>>6&63),f(128|d&63))}return jo(a,0,c)}var Cs=function(t){var e=0;if(t)for(var r in t){var n=t[r].length;n>65535&&kn(9),e+=n+4}return e},Ra=function(t,e,r,n,s,a,c,f){var h=n.length,d=r.extra,g=f&&f.length,x=Cs(d);Ge(t,e,c!=null?33639248:67324752),e+=4,c!=null&&(t[e++]=20,t[e++]=r.os),t[e]=20,e+=2,t[e++]=r.flag<<1|(a<0&&8),t[e++]=s&&8,t[e++]=r.compression&255,t[e++]=r.compression>>8;var w=new Date(r.mtime==null?Date.now():r.mtime),M=w.getFullYear()-1980;if((M<0||M>119)&&kn(10),Ge(t,e,M<<25|w.getMonth()+1<<21|w.getDate()<<16|w.getHours()<<11|w.getMinutes()<<5|w.getSeconds()>>1),e+=4,a!=-1&&(Ge(t,e,r.crc),Ge(t,e+4,a<0?-a-2:a),Ge(t,e+8,r.size)),Ge(t,e+12,h),Ge(t,e+14,x),e+=16,c!=null&&(Ge(t,e,g),Ge(t,e+6,r.attrs),Ge(t,e+10,c),e+=14),t.set(n,e),e+=h,x)for(var A in d){var F=d[A],m=F.length;Ge(t,e,+A),Ge(t,e+2,m),t.set(F,e+4),e+=4+m}return g&&(t.set(f,e),e+=g),e},Gd=function(t,e,r,n,s){Ge(t,e,101010256),Ge(t,e+8,r),Ge(t,e+10,r),Ge(t,e+12,n),Ge(t,e+16,s)};function Hd(t,e){e||(e={});var r={},n=[];Go(t,"",r,e);var s=0,a=0;for(var c in r){var f=r[c],h=f[0],d=f[1],g=d.level==0?0:8,x=zr(c),w=x.length,M=d.comment,A=M&&zr(M),F=A&&A.length,m=Cs(d.extra);w>65535&&kn(11);var C=g?Bd(h,d):h,T=C.length,_=Ld();_.p(h),n.push(zo(d,{size:h.length,crc:_.d(),c:C,f:x,m:A,u:w!=c.length||A&&M.length!=F,o:s,compression:g})),s+=30+w+m+T,a+=76+2*(w+m)+(F||0)+T}for(var b=new He(a+22),N=s,$=a-s,z=0;z<n.length;++z){var x=n[z];Ra(b,x.o,x,x.f,x.u,x.c.length);var B=30+x.f.length+Cs(x.extra);b.set(x.c,x.o+B),Ra(b,s,x,x.f,x.u,x.c.length,x.o,x.m),s+=16+B+(x.m?x.m.length:0)}return Gd(b,s,n.length,$,N),b}var Q=1e-6,le=typeof Float32Array<"u"?Float32Array:Array,ft=Math.random;function Ho(t){le=t}var qd=Math.PI/180;function Wd(t){return t*qd}function Xd(t,e){return Math.abs(t-e)<=Q*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Yd=Object.freeze({__proto__:null,get ARRAY_TYPE(){return le},EPSILON:Q,RANDOM:ft,equals:Xd,setMatrixArrayType:Ho,toRadian:Wd});function Kd(){var t=new le(4);return le!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function Jd(t){var e=new le(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Zd(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Qd(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function ep(t,e,r,n){var s=new le(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=n,s}function tp(t,e,r,n,s){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t}function rp(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function np(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=r*a-s*n;return c?(c=1/c,t[0]=a*c,t[1]=-n*c,t[2]=-s*c,t[3]=r*c,t):null}function sp(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function ip(t){return t[0]*t[3]-t[2]*t[1]}function qo(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=r[0],h=r[1],d=r[2],g=r[3];return t[0]=n*f+a*h,t[1]=s*f+c*h,t[2]=n*d+a*g,t[3]=s*d+c*g,t}function ap(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=Math.sin(r),h=Math.cos(r);return t[0]=n*h+a*f,t[1]=s*h+c*f,t[2]=n*-f+a*h,t[3]=s*-f+c*h,t}function op(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=r[0],h=r[1];return t[0]=n*f,t[1]=s*f,t[2]=a*h,t[3]=c*h,t}function cp(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t}function lp(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function fp(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function up(t){return Math.hypot(t[0],t[1],t[2],t[3])}function hp(t,e,r,n){return t[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-t[2]*r[1],[t,e,r]}function dp(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Wo(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function pp(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function gp(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=e[0],f=e[1],h=e[2],d=e[3];return Math.abs(r-c)<=Q*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-f)<=Q*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(s-h)<=Q*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(a-d)<=Q*Math.max(1,Math.abs(a),Math.abs(d))}function mp(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function vp(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}var yp=qo,xp=Wo,Tp=Object.freeze({__proto__:null,LDU:hp,add:dp,adjoint:sp,clone:Jd,copy:Zd,create:Kd,determinant:ip,equals:gp,exactEquals:pp,frob:up,fromRotation:cp,fromScaling:lp,fromValues:ep,identity:Qd,invert:np,mul:yp,multiply:qo,multiplyScalar:mp,multiplyScalarAndAdd:vp,rotate:ap,scale:op,set:tp,str:fp,sub:xp,subtract:Wo,transpose:rp});function Ep(){var t=new le(6);return le!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function wp(t){var e=new le(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Mp(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function _p(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function Rp(t,e,r,n,s,a){var c=new le(6);return c[0]=t,c[1]=e,c[2]=r,c[3]=n,c[4]=s,c[5]=a,c}function bp(t,e,r,n,s,a,c){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=a,t[5]=c,t}function Ap(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],f=e[5],h=r*a-n*s;return h?(h=1/h,t[0]=a*h,t[1]=-n*h,t[2]=-s*h,t[3]=r*h,t[4]=(s*f-a*c)*h,t[5]=(n*c-r*f)*h,t):null}function Ip(t){return t[0]*t[3]-t[1]*t[2]}function Xo(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=r[0],g=r[1],x=r[2],w=r[3],M=r[4],A=r[5];return t[0]=n*d+a*g,t[1]=s*d+c*g,t[2]=n*x+a*w,t[3]=s*x+c*w,t[4]=n*M+a*A+f,t[5]=s*M+c*A+h,t}function Sp(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=Math.sin(r),g=Math.cos(r);return t[0]=n*g+a*d,t[1]=s*g+c*d,t[2]=n*-d+a*g,t[3]=s*-d+c*g,t[4]=f,t[5]=h,t}function Cp(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=r[0],g=r[1];return t[0]=n*d,t[1]=s*d,t[2]=a*g,t[3]=c*g,t[4]=f,t[5]=h,t}function Np(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=r[0],g=r[1];return t[0]=n,t[1]=s,t[2]=a,t[3]=c,t[4]=n*d+a*g+f,t[5]=s*d+c*g+h,t}function Fp(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t[4]=0,t[5]=0,t}function Op(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function Dp(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function $p(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function Pp(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function kp(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function Yo(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function Up(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function Lp(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t}function jp(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function Bp(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=t[4],f=t[5],h=e[0],d=e[1],g=e[2],x=e[3],w=e[4],M=e[5];return Math.abs(r-h)<=Q*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-d)<=Q*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(s-g)<=Q*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(a-x)<=Q*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(c-w)<=Q*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(f-M)<=Q*Math.max(1,Math.abs(f),Math.abs(M))}var Vp=Xo,zp=Yo,Gp=Object.freeze({__proto__:null,add:kp,clone:wp,copy:Mp,create:Ep,determinant:Ip,equals:Bp,exactEquals:jp,frob:Pp,fromRotation:Fp,fromScaling:Op,fromTranslation:Dp,fromValues:Rp,identity:_p,invert:Ap,mul:Vp,multiply:Xo,multiplyScalar:Up,multiplyScalarAndAdd:Lp,rotate:Sp,scale:Cp,set:bp,str:$p,sub:zp,subtract:Yo,translate:Np});function Ko(){var t=new le(9);return le!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Hp(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function qp(t){var e=new le(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Wp(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Xp(t,e,r,n,s,a,c,f,h){var d=new le(9);return d[0]=t,d[1]=e,d[2]=r,d[3]=n,d[4]=s,d[5]=a,d[6]=c,d[7]=f,d[8]=h,d}function Yp(t,e,r,n,s,a,c,f,h,d){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=a,t[5]=c,t[6]=f,t[7]=h,t[8]=d,t}function Kp(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Jp(t,e){if(t===e){var r=e[1],n=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Zp(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],f=e[5],h=e[6],d=e[7],g=e[8],x=g*c-f*d,w=-g*a+f*h,M=d*a-c*h,A=r*x+n*w+s*M;return A?(A=1/A,t[0]=x*A,t[1]=(-g*n+s*d)*A,t[2]=(f*n-s*c)*A,t[3]=w*A,t[4]=(g*r-s*h)*A,t[5]=(-f*r+s*a)*A,t[6]=M*A,t[7]=(-d*r+n*h)*A,t[8]=(c*r-n*a)*A,t):null}function Qp(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],f=e[5],h=e[6],d=e[7],g=e[8];return t[0]=c*g-f*d,t[1]=s*d-n*g,t[2]=n*f-s*c,t[3]=f*h-a*g,t[4]=r*g-s*h,t[5]=s*a-r*f,t[6]=a*d-c*h,t[7]=n*h-r*d,t[8]=r*c-n*a,t}function eg(t){var e=t[0],r=t[1],n=t[2],s=t[3],a=t[4],c=t[5],f=t[6],h=t[7],d=t[8];return e*(d*a-c*h)+r*(-d*s+c*f)+n*(h*s-a*f)}function Jo(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],x=e[8],w=r[0],M=r[1],A=r[2],F=r[3],m=r[4],C=r[5],T=r[6],_=r[7],b=r[8];return t[0]=w*n+M*c+A*d,t[1]=w*s+M*f+A*g,t[2]=w*a+M*h+A*x,t[3]=F*n+m*c+C*d,t[4]=F*s+m*f+C*g,t[5]=F*a+m*h+C*x,t[6]=T*n+_*c+b*d,t[7]=T*s+_*f+b*g,t[8]=T*a+_*h+b*x,t}function tg(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],x=e[8],w=r[0],M=r[1];return t[0]=n,t[1]=s,t[2]=a,t[3]=c,t[4]=f,t[5]=h,t[6]=w*n+M*c+d,t[7]=w*s+M*f+g,t[8]=w*a+M*h+x,t}function rg(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],x=e[8],w=Math.sin(r),M=Math.cos(r);return t[0]=M*n+w*c,t[1]=M*s+w*f,t[2]=M*a+w*h,t[3]=M*c-w*n,t[4]=M*f-w*s,t[5]=M*h-w*a,t[6]=d,t[7]=g,t[8]=x,t}function ng(t,e,r){var n=r[0],s=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function sg(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function ig(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function ag(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function og(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function cg(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=r+r,f=n+n,h=s+s,d=r*c,g=n*c,x=n*f,w=s*c,M=s*f,A=s*h,F=a*c,m=a*f,C=a*h;return t[0]=1-x-A,t[3]=g-C,t[6]=w+m,t[1]=g+C,t[4]=1-d-A,t[7]=M-F,t[2]=w-m,t[5]=M+F,t[8]=1-d-x,t}function lg(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],f=e[5],h=e[6],d=e[7],g=e[8],x=e[9],w=e[10],M=e[11],A=e[12],F=e[13],m=e[14],C=e[15],T=r*f-n*c,_=r*h-s*c,b=r*d-a*c,N=n*h-s*f,$=n*d-a*f,z=s*d-a*h,B=g*F-x*A,k=g*m-w*A,G=g*C-M*A,H=x*m-w*F,K=x*C-M*F,L=w*C-M*m,U=T*L-_*K+b*H+N*G-$*k+z*B;return U?(U=1/U,t[0]=(f*L-h*K+d*H)*U,t[1]=(h*G-c*L-d*k)*U,t[2]=(c*K-f*G+d*B)*U,t[3]=(s*K-n*L-a*H)*U,t[4]=(r*L-s*G+a*k)*U,t[5]=(n*G-r*K-a*B)*U,t[6]=(F*z-m*$+C*N)*U,t[7]=(m*b-A*z-C*_)*U,t[8]=(A*$-F*b+C*T)*U,t):null}function fg(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function ug(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function hg(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function dg(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function Zo(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function pg(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function gg(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t}function mg(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function vg(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=t[4],f=t[5],h=t[6],d=t[7],g=t[8],x=e[0],w=e[1],M=e[2],A=e[3],F=e[4],m=e[5],C=e[6],T=e[7],_=e[8];return Math.abs(r-x)<=Q*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(n-w)<=Q*Math.max(1,Math.abs(n),Math.abs(w))&&Math.abs(s-M)<=Q*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(a-A)<=Q*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(c-F)<=Q*Math.max(1,Math.abs(c),Math.abs(F))&&Math.abs(f-m)<=Q*Math.max(1,Math.abs(f),Math.abs(m))&&Math.abs(h-C)<=Q*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(d-T)<=Q*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(g-_)<=Q*Math.max(1,Math.abs(g),Math.abs(_))}var yg=Jo,xg=Zo,Tg=Object.freeze({__proto__:null,add:dg,adjoint:Qp,clone:qp,copy:Wp,create:Ko,determinant:eg,equals:vg,exactEquals:mg,frob:hg,fromMat2d:og,fromMat4:Hp,fromQuat:cg,fromRotation:ig,fromScaling:ag,fromTranslation:sg,fromValues:Xp,identity:Kp,invert:Zp,mul:yg,multiply:Jo,multiplyScalar:pg,multiplyScalarAndAdd:gg,normalFromMat4:lg,projection:fg,rotate:rg,scale:ng,set:Yp,str:ug,sub:xg,subtract:Zo,translate:tg,transpose:Jp});function Eg(){var t=new le(16);return le!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function wg(t){var e=new le(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Mg(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function _g(t,e,r,n,s,a,c,f,h,d,g,x,w,M,A,F){var m=new le(16);return m[0]=t,m[1]=e,m[2]=r,m[3]=n,m[4]=s,m[5]=a,m[6]=c,m[7]=f,m[8]=h,m[9]=d,m[10]=g,m[11]=x,m[12]=w,m[13]=M,m[14]=A,m[15]=F,m}function Rg(t,e,r,n,s,a,c,f,h,d,g,x,w,M,A,F,m){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=a,t[5]=c,t[6]=f,t[7]=h,t[8]=d,t[9]=g,t[10]=x,t[11]=w,t[12]=M,t[13]=A,t[14]=F,t[15]=m,t}function Qo(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function bg(t,e){if(t===e){var r=e[1],n=e[2],s=e[3],a=e[6],c=e[7],f=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=a,t[11]=e[14],t[12]=s,t[13]=c,t[14]=f}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Ag(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],f=e[5],h=e[6],d=e[7],g=e[8],x=e[9],w=e[10],M=e[11],A=e[12],F=e[13],m=e[14],C=e[15],T=r*f-n*c,_=r*h-s*c,b=r*d-a*c,N=n*h-s*f,$=n*d-a*f,z=s*d-a*h,B=g*F-x*A,k=g*m-w*A,G=g*C-M*A,H=x*m-w*F,K=x*C-M*F,L=w*C-M*m,U=T*L-_*K+b*H+N*G-$*k+z*B;return U?(U=1/U,t[0]=(f*L-h*K+d*H)*U,t[1]=(s*K-n*L-a*H)*U,t[2]=(F*z-m*$+C*N)*U,t[3]=(w*$-x*z-M*N)*U,t[4]=(h*G-c*L-d*k)*U,t[5]=(r*L-s*G+a*k)*U,t[6]=(m*b-A*z-C*_)*U,t[7]=(g*z-w*b+M*_)*U,t[8]=(c*K-f*G+d*B)*U,t[9]=(n*G-r*K-a*B)*U,t[10]=(A*$-F*b+C*T)*U,t[11]=(x*b-g*$-M*T)*U,t[12]=(f*k-c*H-h*B)*U,t[13]=(r*H-n*k+s*B)*U,t[14]=(F*_-A*N-m*T)*U,t[15]=(g*N-x*_+w*T)*U,t):null}function Ig(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],f=e[5],h=e[6],d=e[7],g=e[8],x=e[9],w=e[10],M=e[11],A=e[12],F=e[13],m=e[14],C=e[15];return t[0]=f*(w*C-M*m)-x*(h*C-d*m)+F*(h*M-d*w),t[1]=-(n*(w*C-M*m)-x*(s*C-a*m)+F*(s*M-a*w)),t[2]=n*(h*C-d*m)-f*(s*C-a*m)+F*(s*d-a*h),t[3]=-(n*(h*M-d*w)-f*(s*M-a*w)+x*(s*d-a*h)),t[4]=-(c*(w*C-M*m)-g*(h*C-d*m)+A*(h*M-d*w)),t[5]=r*(w*C-M*m)-g*(s*C-a*m)+A*(s*M-a*w),t[6]=-(r*(h*C-d*m)-c*(s*C-a*m)+A*(s*d-a*h)),t[7]=r*(h*M-d*w)-c*(s*M-a*w)+g*(s*d-a*h),t[8]=c*(x*C-M*F)-g*(f*C-d*F)+A*(f*M-d*x),t[9]=-(r*(x*C-M*F)-g*(n*C-a*F)+A*(n*M-a*x)),t[10]=r*(f*C-d*F)-c*(n*C-a*F)+A*(n*d-a*f),t[11]=-(r*(f*M-d*x)-c*(n*M-a*x)+g*(n*d-a*f)),t[12]=-(c*(x*m-w*F)-g*(f*m-h*F)+A*(f*w-h*x)),t[13]=r*(x*m-w*F)-g*(n*m-s*F)+A*(n*w-s*x),t[14]=-(r*(f*m-h*F)-c*(n*m-s*F)+A*(n*h-s*f)),t[15]=r*(f*w-h*x)-c*(n*w-s*x)+g*(n*h-s*f),t}function Sg(t){var e=t[0],r=t[1],n=t[2],s=t[3],a=t[4],c=t[5],f=t[6],h=t[7],d=t[8],g=t[9],x=t[10],w=t[11],M=t[12],A=t[13],F=t[14],m=t[15],C=e*c-r*a,T=e*f-n*a,_=e*h-s*a,b=r*f-n*c,N=r*h-s*c,$=n*h-s*f,z=d*A-g*M,B=d*F-x*M,k=d*m-w*M,G=g*F-x*A,H=g*m-w*A,K=x*m-w*F;return C*K-T*H+_*G+b*k-N*B+$*z}function ec(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],x=e[8],w=e[9],M=e[10],A=e[11],F=e[12],m=e[13],C=e[14],T=e[15],_=r[0],b=r[1],N=r[2],$=r[3];return t[0]=_*n+b*f+N*x+$*F,t[1]=_*s+b*h+N*w+$*m,t[2]=_*a+b*d+N*M+$*C,t[3]=_*c+b*g+N*A+$*T,_=r[4],b=r[5],N=r[6],$=r[7],t[4]=_*n+b*f+N*x+$*F,t[5]=_*s+b*h+N*w+$*m,t[6]=_*a+b*d+N*M+$*C,t[7]=_*c+b*g+N*A+$*T,_=r[8],b=r[9],N=r[10],$=r[11],t[8]=_*n+b*f+N*x+$*F,t[9]=_*s+b*h+N*w+$*m,t[10]=_*a+b*d+N*M+$*C,t[11]=_*c+b*g+N*A+$*T,_=r[12],b=r[13],N=r[14],$=r[15],t[12]=_*n+b*f+N*x+$*F,t[13]=_*s+b*h+N*w+$*m,t[14]=_*a+b*d+N*M+$*C,t[15]=_*c+b*g+N*A+$*T,t}function Cg(t,e,r){var n=r[0],s=r[1],a=r[2],c,f,h,d,g,x,w,M,A,F,m,C;return e===t?(t[12]=e[0]*n+e[4]*s+e[8]*a+e[12],t[13]=e[1]*n+e[5]*s+e[9]*a+e[13],t[14]=e[2]*n+e[6]*s+e[10]*a+e[14],t[15]=e[3]*n+e[7]*s+e[11]*a+e[15]):(c=e[0],f=e[1],h=e[2],d=e[3],g=e[4],x=e[5],w=e[6],M=e[7],A=e[8],F=e[9],m=e[10],C=e[11],t[0]=c,t[1]=f,t[2]=h,t[3]=d,t[4]=g,t[5]=x,t[6]=w,t[7]=M,t[8]=A,t[9]=F,t[10]=m,t[11]=C,t[12]=c*n+g*s+A*a+e[12],t[13]=f*n+x*s+F*a+e[13],t[14]=h*n+w*s+m*a+e[14],t[15]=d*n+M*s+C*a+e[15]),t}function Ng(t,e,r){var n=r[0],s=r[1],a=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Fg(t,e,r,n){var s=n[0],a=n[1],c=n[2],f=Math.hypot(s,a,c),h,d,g,x,w,M,A,F,m,C,T,_,b,N,$,z,B,k,G,H,K,L,U,ee;return f<Q?null:(f=1/f,s*=f,a*=f,c*=f,h=Math.sin(r),d=Math.cos(r),g=1-d,x=e[0],w=e[1],M=e[2],A=e[3],F=e[4],m=e[5],C=e[6],T=e[7],_=e[8],b=e[9],N=e[10],$=e[11],z=s*s*g+d,B=a*s*g+c*h,k=c*s*g-a*h,G=s*a*g-c*h,H=a*a*g+d,K=c*a*g+s*h,L=s*c*g+a*h,U=a*c*g-s*h,ee=c*c*g+d,t[0]=x*z+F*B+_*k,t[1]=w*z+m*B+b*k,t[2]=M*z+C*B+N*k,t[3]=A*z+T*B+$*k,t[4]=x*G+F*H+_*K,t[5]=w*G+m*H+b*K,t[6]=M*G+C*H+N*K,t[7]=A*G+T*H+$*K,t[8]=x*L+F*U+_*ee,t[9]=w*L+m*U+b*ee,t[10]=M*L+C*U+N*ee,t[11]=A*L+T*U+$*ee,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Og(t,e,r){var n=Math.sin(r),s=Math.cos(r),a=e[4],c=e[5],f=e[6],h=e[7],d=e[8],g=e[9],x=e[10],w=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*s+d*n,t[5]=c*s+g*n,t[6]=f*s+x*n,t[7]=h*s+w*n,t[8]=d*s-a*n,t[9]=g*s-c*n,t[10]=x*s-f*n,t[11]=w*s-h*n,t}function Dg(t,e,r){var n=Math.sin(r),s=Math.cos(r),a=e[0],c=e[1],f=e[2],h=e[3],d=e[8],g=e[9],x=e[10],w=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*s-d*n,t[1]=c*s-g*n,t[2]=f*s-x*n,t[3]=h*s-w*n,t[8]=a*n+d*s,t[9]=c*n+g*s,t[10]=f*n+x*s,t[11]=h*n+w*s,t}function $g(t,e,r){var n=Math.sin(r),s=Math.cos(r),a=e[0],c=e[1],f=e[2],h=e[3],d=e[4],g=e[5],x=e[6],w=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*s+d*n,t[1]=c*s+g*n,t[2]=f*s+x*n,t[3]=h*s+w*n,t[4]=d*s-a*n,t[5]=g*s-c*n,t[6]=x*s-f*n,t[7]=w*s-h*n,t}function Pg(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function kg(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ug(t,e,r){var n=r[0],s=r[1],a=r[2],c=Math.hypot(n,s,a),f,h,d;return c<Q?null:(c=1/c,n*=c,s*=c,a*=c,f=Math.sin(e),h=Math.cos(e),d=1-h,t[0]=n*n*d+h,t[1]=s*n*d+a*f,t[2]=a*n*d-s*f,t[3]=0,t[4]=n*s*d-a*f,t[5]=s*s*d+h,t[6]=a*s*d+n*f,t[7]=0,t[8]=n*a*d+s*f,t[9]=s*a*d-n*f,t[10]=a*a*d+h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function Lg(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function jg(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Bg(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function tc(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=n+n,h=s+s,d=a+a,g=n*f,x=n*h,w=n*d,M=s*h,A=s*d,F=a*d,m=c*f,C=c*h,T=c*d;return t[0]=1-(M+F),t[1]=x+T,t[2]=w-C,t[3]=0,t[4]=x-T,t[5]=1-(g+F),t[6]=A+m,t[7]=0,t[8]=w+C,t[9]=A-m,t[10]=1-(g+M),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Vg(t,e){var r=new le(3),n=-e[0],s=-e[1],a=-e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],x=n*n+s*s+a*a+c*c;return x>0?(r[0]=(f*c+g*n+h*a-d*s)*2/x,r[1]=(h*c+g*s+d*n-f*a)*2/x,r[2]=(d*c+g*a+f*s-h*n)*2/x):(r[0]=(f*c+g*n+h*a-d*s)*2,r[1]=(h*c+g*s+d*n-f*a)*2,r[2]=(d*c+g*a+f*s-h*n)*2),tc(t,e,r),t}function rc(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function nc(t,e){var r=e[0],n=e[1],s=e[2],a=e[4],c=e[5],f=e[6],h=e[8],d=e[9],g=e[10];return t[0]=Math.hypot(r,n,s),t[1]=Math.hypot(a,c,f),t[2]=Math.hypot(h,d,g),t}function sc(t,e){var r=new le(3);nc(r,e);var n=1/r[0],s=1/r[1],a=1/r[2],c=e[0]*n,f=e[1]*s,h=e[2]*a,d=e[4]*n,g=e[5]*s,x=e[6]*a,w=e[8]*n,M=e[9]*s,A=e[10]*a,F=c+g+A,m=0;return F>0?(m=Math.sqrt(F+1)*2,t[3]=.25*m,t[0]=(x-M)/m,t[1]=(w-h)/m,t[2]=(f-d)/m):c>g&&c>A?(m=Math.sqrt(1+c-g-A)*2,t[3]=(x-M)/m,t[0]=.25*m,t[1]=(f+d)/m,t[2]=(w+h)/m):g>A?(m=Math.sqrt(1+g-c-A)*2,t[3]=(w-h)/m,t[0]=(f+d)/m,t[1]=.25*m,t[2]=(x+M)/m):(m=Math.sqrt(1+A-c-g)*2,t[3]=(f-d)/m,t[0]=(w+h)/m,t[1]=(x+M)/m,t[2]=.25*m),t}function zg(t,e,r,n){var s=e[0],a=e[1],c=e[2],f=e[3],h=s+s,d=a+a,g=c+c,x=s*h,w=s*d,M=s*g,A=a*d,F=a*g,m=c*g,C=f*h,T=f*d,_=f*g,b=n[0],N=n[1],$=n[2];return t[0]=(1-(A+m))*b,t[1]=(w+_)*b,t[2]=(M-T)*b,t[3]=0,t[4]=(w-_)*N,t[5]=(1-(x+m))*N,t[6]=(F+C)*N,t[7]=0,t[8]=(M+T)*$,t[9]=(F-C)*$,t[10]=(1-(x+A))*$,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Gg(t,e,r,n,s){var a=e[0],c=e[1],f=e[2],h=e[3],d=a+a,g=c+c,x=f+f,w=a*d,M=a*g,A=a*x,F=c*g,m=c*x,C=f*x,T=h*d,_=h*g,b=h*x,N=n[0],$=n[1],z=n[2],B=s[0],k=s[1],G=s[2],H=(1-(F+C))*N,K=(M+b)*N,L=(A-_)*N,U=(M-b)*$,ee=(1-(w+C))*$,fe=(m+T)*$,re=(A+_)*z,ye=(m-T)*z,me=(1-(w+F))*z;return t[0]=H,t[1]=K,t[2]=L,t[3]=0,t[4]=U,t[5]=ee,t[6]=fe,t[7]=0,t[8]=re,t[9]=ye,t[10]=me,t[11]=0,t[12]=r[0]+B-(H*B+U*k+re*G),t[13]=r[1]+k-(K*B+ee*k+ye*G),t[14]=r[2]+G-(L*B+fe*k+me*G),t[15]=1,t}function Hg(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=r+r,f=n+n,h=s+s,d=r*c,g=n*c,x=n*f,w=s*c,M=s*f,A=s*h,F=a*c,m=a*f,C=a*h;return t[0]=1-x-A,t[1]=g+C,t[2]=w-m,t[3]=0,t[4]=g-C,t[5]=1-d-A,t[6]=M+F,t[7]=0,t[8]=w+m,t[9]=M-F,t[10]=1-d-x,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function qg(t,e,r,n,s,a,c){var f=1/(r-e),h=1/(s-n),d=1/(a-c);return t[0]=a*2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*h,t[6]=0,t[7]=0,t[8]=(r+e)*f,t[9]=(s+n)*h,t[10]=(c+a)*d,t[11]=-1,t[12]=0,t[13]=0,t[14]=c*a*2*d,t[15]=0,t}function ic(t,e,r,n,s){var a=1/Math.tan(e/2),c;return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(c=1/(n-s),t[10]=(s+n)*c,t[14]=2*s*n*c):(t[10]=-1,t[14]=-2*n),t}var Wg=ic;function Xg(t,e,r,n,s){var a=1/Math.tan(e/2),c;return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(c=1/(n-s),t[10]=s*c,t[14]=s*n*c):(t[10]=-1,t[14]=-n),t}function Yg(t,e,r,n){var s=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),c=Math.tan(e.leftDegrees*Math.PI/180),f=Math.tan(e.rightDegrees*Math.PI/180),h=2/(c+f),d=2/(s+a);return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=d,t[6]=0,t[7]=0,t[8]=-((c-f)*h*.5),t[9]=(s-a)*d*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t}function ac(t,e,r,n,s,a,c){var f=1/(e-r),h=1/(n-s),d=1/(a-c);return t[0]=-2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*d,t[11]=0,t[12]=(e+r)*f,t[13]=(s+n)*h,t[14]=(c+a)*d,t[15]=1,t}var Kg=ac;function Jg(t,e,r,n,s,a,c){var f=1/(e-r),h=1/(n-s),d=1/(a-c);return t[0]=-2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=d,t[11]=0,t[12]=(e+r)*f,t[13]=(s+n)*h,t[14]=a*d,t[15]=1,t}function Zg(t,e,r,n){var s,a,c,f,h,d,g,x,w,M,A=e[0],F=e[1],m=e[2],C=n[0],T=n[1],_=n[2],b=r[0],N=r[1],$=r[2];return Math.abs(A-b)<Q&&Math.abs(F-N)<Q&&Math.abs(m-$)<Q?Qo(t):(g=A-b,x=F-N,w=m-$,M=1/Math.hypot(g,x,w),g*=M,x*=M,w*=M,s=T*w-_*x,a=_*g-C*w,c=C*x-T*g,M=Math.hypot(s,a,c),M?(M=1/M,s*=M,a*=M,c*=M):(s=0,a=0,c=0),f=x*c-w*a,h=w*s-g*c,d=g*a-x*s,M=Math.hypot(f,h,d),M?(M=1/M,f*=M,h*=M,d*=M):(f=0,h=0,d=0),t[0]=s,t[1]=f,t[2]=g,t[3]=0,t[4]=a,t[5]=h,t[6]=x,t[7]=0,t[8]=c,t[9]=d,t[10]=w,t[11]=0,t[12]=-(s*A+a*F+c*m),t[13]=-(f*A+h*F+d*m),t[14]=-(g*A+x*F+w*m),t[15]=1,t)}function Qg(t,e,r,n){var s=e[0],a=e[1],c=e[2],f=n[0],h=n[1],d=n[2],g=s-r[0],x=a-r[1],w=c-r[2],M=g*g+x*x+w*w;M>0&&(M=1/Math.sqrt(M),g*=M,x*=M,w*=M);var A=h*w-d*x,F=d*g-f*w,m=f*x-h*g;return M=A*A+F*F+m*m,M>0&&(M=1/Math.sqrt(M),A*=M,F*=M,m*=M),t[0]=A,t[1]=F,t[2]=m,t[3]=0,t[4]=x*m-w*F,t[5]=w*A-g*m,t[6]=g*F-x*A,t[7]=0,t[8]=g,t[9]=x,t[10]=w,t[11]=0,t[12]=s,t[13]=a,t[14]=c,t[15]=1,t}function e1(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function t1(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function r1(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function oc(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function n1(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function s1(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t}function i1(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function a1(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=t[4],f=t[5],h=t[6],d=t[7],g=t[8],x=t[9],w=t[10],M=t[11],A=t[12],F=t[13],m=t[14],C=t[15],T=e[0],_=e[1],b=e[2],N=e[3],$=e[4],z=e[5],B=e[6],k=e[7],G=e[8],H=e[9],K=e[10],L=e[11],U=e[12],ee=e[13],fe=e[14],re=e[15];return Math.abs(r-T)<=Q*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(n-_)<=Q*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(s-b)<=Q*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(a-N)<=Q*Math.max(1,Math.abs(a),Math.abs(N))&&Math.abs(c-$)<=Q*Math.max(1,Math.abs(c),Math.abs($))&&Math.abs(f-z)<=Q*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(h-B)<=Q*Math.max(1,Math.abs(h),Math.abs(B))&&Math.abs(d-k)<=Q*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(g-G)<=Q*Math.max(1,Math.abs(g),Math.abs(G))&&Math.abs(x-H)<=Q*Math.max(1,Math.abs(x),Math.abs(H))&&Math.abs(w-K)<=Q*Math.max(1,Math.abs(w),Math.abs(K))&&Math.abs(M-L)<=Q*Math.max(1,Math.abs(M),Math.abs(L))&&Math.abs(A-U)<=Q*Math.max(1,Math.abs(A),Math.abs(U))&&Math.abs(F-ee)<=Q*Math.max(1,Math.abs(F),Math.abs(ee))&&Math.abs(m-fe)<=Q*Math.max(1,Math.abs(m),Math.abs(fe))&&Math.abs(C-re)<=Q*Math.max(1,Math.abs(C),Math.abs(re))}var o1=ec,c1=oc,l1=Object.freeze({__proto__:null,add:r1,adjoint:Ig,clone:wg,copy:Mg,create:Eg,determinant:Sg,equals:a1,exactEquals:i1,frob:t1,fromQuat:Hg,fromQuat2:Vg,fromRotation:Ug,fromRotationTranslation:tc,fromRotationTranslationScale:zg,fromRotationTranslationScaleOrigin:Gg,fromScaling:kg,fromTranslation:Pg,fromValues:_g,fromXRotation:Lg,fromYRotation:jg,fromZRotation:Bg,frustum:qg,getRotation:sc,getScaling:nc,getTranslation:rc,identity:Qo,invert:Ag,lookAt:Zg,mul:o1,multiply:ec,multiplyScalar:n1,multiplyScalarAndAdd:s1,ortho:Kg,orthoNO:ac,orthoZO:Jg,perspective:Wg,perspectiveFromFieldOfView:Yg,perspectiveNO:ic,perspectiveZO:Xg,rotate:Fg,rotateX:Og,rotateY:Dg,rotateZ:$g,scale:Ng,set:Rg,str:e1,sub:c1,subtract:oc,targetTo:Qg,translate:Cg,transpose:bg});function ri(){var t=new le(3);return le!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function f1(t){var e=new le(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function cc(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function Ns(t,e,r){var n=new le(3);return n[0]=t,n[1]=e,n[2]=r,n}function u1(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function h1(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function d1(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function lc(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function fc(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function uc(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function p1(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function g1(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function m1(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function v1(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function y1(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function x1(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function T1(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function hc(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return Math.hypot(r,n,s)}function dc(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return r*r+n*n+s*s}function pc(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function E1(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function w1(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function gc(t,e){var r=e[0],n=e[1],s=e[2],a=r*r+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function ni(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Tn(t,e,r){var n=e[0],s=e[1],a=e[2],c=r[0],f=r[1],h=r[2];return t[0]=s*h-a*f,t[1]=a*c-n*h,t[2]=n*f-s*c,t}function M1(t,e,r,n){var s=e[0],a=e[1],c=e[2];return t[0]=s+n*(r[0]-s),t[1]=a+n*(r[1]-a),t[2]=c+n*(r[2]-c),t}function _1(t,e,r,n,s,a){var c=a*a,f=c*(2*a-3)+1,h=c*(a-2)+a,d=c*(a-1),g=c*(3-2*a);return t[0]=e[0]*f+r[0]*h+n[0]*d+s[0]*g,t[1]=e[1]*f+r[1]*h+n[1]*d+s[1]*g,t[2]=e[2]*f+r[2]*h+n[2]*d+s[2]*g,t}function R1(t,e,r,n,s,a){var c=1-a,f=c*c,h=a*a,d=f*c,g=3*a*f,x=3*h*c,w=h*a;return t[0]=e[0]*d+r[0]*g+n[0]*x+s[0]*w,t[1]=e[1]*d+r[1]*g+n[1]*x+s[1]*w,t[2]=e[2]*d+r[2]*g+n[2]*x+s[2]*w,t}function b1(t,e){e=e||1;var r=ft()*2*Math.PI,n=ft()*2-1,s=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*s,t[1]=Math.sin(r)*s,t[2]=n*e,t}function A1(t,e,r){var n=e[0],s=e[1],a=e[2],c=r[3]*n+r[7]*s+r[11]*a+r[15];return c=c||1,t[0]=(r[0]*n+r[4]*s+r[8]*a+r[12])/c,t[1]=(r[1]*n+r[5]*s+r[9]*a+r[13])/c,t[2]=(r[2]*n+r[6]*s+r[10]*a+r[14])/c,t}function I1(t,e,r){var n=e[0],s=e[1],a=e[2];return t[0]=n*r[0]+s*r[3]+a*r[6],t[1]=n*r[1]+s*r[4]+a*r[7],t[2]=n*r[2]+s*r[5]+a*r[8],t}function S1(t,e,r){var n=r[0],s=r[1],a=r[2],c=r[3],f=e[0],h=e[1],d=e[2],g=s*d-a*h,x=a*f-n*d,w=n*h-s*f,M=s*w-a*x,A=a*g-n*w,F=n*x-s*g,m=c*2;return g*=m,x*=m,w*=m,M*=2,A*=2,F*=2,t[0]=f+g+M,t[1]=h+x+A,t[2]=d+w+F,t}function C1(t,e,r,n){var s=[],a=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],a[0]=s[0],a[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),a[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t}function N1(t,e,r,n){var s=[],a=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],a[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),a[1]=s[1],a[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t}function F1(t,e,r,n){var s=[],a=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],a[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),a[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),a[2]=s[2],t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t}function O1(t,e){var r=t[0],n=t[1],s=t[2],a=e[0],c=e[1],f=e[2],h=Math.sqrt(r*r+n*n+s*s),d=Math.sqrt(a*a+c*c+f*f),g=h*d,x=g&&ni(t,e)/g;return Math.acos(Math.min(Math.max(x,-1),1))}function D1(t){return t[0]=0,t[1]=0,t[2]=0,t}function $1(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function P1(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function k1(t,e){var r=t[0],n=t[1],s=t[2],a=e[0],c=e[1],f=e[2];return Math.abs(r-a)<=Q*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-c)<=Q*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(s-f)<=Q*Math.max(1,Math.abs(s),Math.abs(f))}var U1=lc,L1=fc,j1=uc,B1=hc,V1=dc,mc=cc,z1=pc,G1=function(){var t=ri();return function(e,r,n,s,a,c){var f,h;for(r||(r=3),n||(n=0),s?h=Math.min(s*r+n,e.length):h=e.length,f=n;f<h;f+=r)t[0]=e[f],t[1]=e[f+1],t[2]=e[f+2],a(t,t,c),e[f]=t[0],e[f+1]=t[1],e[f+2]=t[2];return e}}(),H1=Object.freeze({__proto__:null,add:d1,angle:O1,bezier:R1,ceil:p1,clone:f1,copy:u1,create:ri,cross:Tn,dist:B1,distance:hc,div:j1,divide:uc,dot:ni,equals:k1,exactEquals:P1,floor:g1,forEach:G1,fromValues:Ns,hermite:_1,inverse:w1,len:mc,length:cc,lerp:M1,max:v1,min:m1,mul:L1,multiply:fc,negate:E1,normalize:gc,random:b1,rotateX:C1,rotateY:N1,rotateZ:F1,round:y1,scale:x1,scaleAndAdd:T1,set:h1,sqrDist:V1,sqrLen:z1,squaredDistance:dc,squaredLength:pc,str:$1,sub:U1,subtract:lc,transformMat3:I1,transformMat4:A1,transformQuat:S1,zero:D1});function vc(){var t=new le(4);return le!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function yc(t){var e=new le(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function xc(t,e,r,n){var s=new le(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=n,s}function Tc(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Ec(t,e,r,n,s){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t}function wc(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Mc(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function _c(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function Rc(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function q1(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function W1(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function X1(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function Y1(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function K1(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function bc(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function J1(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}function Ac(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2],a=e[3]-t[3];return Math.hypot(r,n,s,a)}function Ic(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2],a=e[3]-t[3];return r*r+n*n+s*s+a*a}function si(t){var e=t[0],r=t[1],n=t[2],s=t[3];return Math.hypot(e,r,n,s)}function ii(t){var e=t[0],r=t[1],n=t[2],s=t[3];return e*e+r*r+n*n+s*s}function Z1(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function Q1(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function Sc(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=r*r+n*n+s*s+a*a;return c>0&&(c=1/Math.sqrt(c)),t[0]=r*c,t[1]=n*c,t[2]=s*c,t[3]=a*c,t}function Cc(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function e0(t,e,r,n){var s=r[0]*n[1]-r[1]*n[0],a=r[0]*n[2]-r[2]*n[0],c=r[0]*n[3]-r[3]*n[0],f=r[1]*n[2]-r[2]*n[1],h=r[1]*n[3]-r[3]*n[1],d=r[2]*n[3]-r[3]*n[2],g=e[0],x=e[1],w=e[2],M=e[3];return t[0]=x*d-w*h+M*f,t[1]=-(g*d)+w*c-M*a,t[2]=g*h-x*c+M*s,t[3]=-(g*f)+x*a-w*s,t}function Nc(t,e,r,n){var s=e[0],a=e[1],c=e[2],f=e[3];return t[0]=s+n*(r[0]-s),t[1]=a+n*(r[1]-a),t[2]=c+n*(r[2]-c),t[3]=f+n*(r[3]-f),t}function t0(t,e){e=e||1;var r,n,s,a,c,f;do r=ft()*2-1,n=ft()*2-1,c=r*r+n*n;while(c>=1);do s=ft()*2-1,a=ft()*2-1,f=s*s+a*a;while(f>=1);var h=Math.sqrt((1-c)/f);return t[0]=e*r,t[1]=e*n,t[2]=e*s*h,t[3]=e*a*h,t}function r0(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3];return t[0]=r[0]*n+r[4]*s+r[8]*a+r[12]*c,t[1]=r[1]*n+r[5]*s+r[9]*a+r[13]*c,t[2]=r[2]*n+r[6]*s+r[10]*a+r[14]*c,t[3]=r[3]*n+r[7]*s+r[11]*a+r[15]*c,t}function n0(t,e,r){var n=e[0],s=e[1],a=e[2],c=r[0],f=r[1],h=r[2],d=r[3],g=d*n+f*a-h*s,x=d*s+h*n-c*a,w=d*a+c*s-f*n,M=-c*n-f*s-h*a;return t[0]=g*d+M*-c+x*-h-w*-f,t[1]=x*d+M*-f+w*-c-g*-h,t[2]=w*d+M*-h+g*-f-x*-c,t[3]=e[3],t}function s0(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function i0(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Fc(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Oc(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=e[0],f=e[1],h=e[2],d=e[3];return Math.abs(r-c)<=Q*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-f)<=Q*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(s-h)<=Q*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(a-d)<=Q*Math.max(1,Math.abs(a),Math.abs(d))}var a0=Mc,o0=_c,c0=Rc,l0=Ac,f0=Ic,u0=si,h0=ii,d0=function(){var t=vc();return function(e,r,n,s,a,c){var f,h;for(r||(r=4),n||(n=0),s?h=Math.min(s*r+n,e.length):h=e.length,f=n;f<h;f+=r)t[0]=e[f],t[1]=e[f+1],t[2]=e[f+2],t[3]=e[f+3],a(t,t,c),e[f]=t[0],e[f+1]=t[1],e[f+2]=t[2],e[f+3]=t[3];return e}}(),p0=Object.freeze({__proto__:null,add:wc,ceil:q1,clone:yc,copy:Tc,create:vc,cross:e0,dist:l0,distance:Ac,div:c0,divide:Rc,dot:Cc,equals:Oc,exactEquals:Fc,floor:W1,forEach:d0,fromValues:xc,inverse:Q1,len:u0,length:si,lerp:Nc,max:Y1,min:X1,mul:o0,multiply:_c,negate:Z1,normalize:Sc,random:t0,round:K1,scale:bc,scaleAndAdd:J1,set:Ec,sqrDist:f0,sqrLen:h0,squaredDistance:Ic,squaredLength:ii,str:i0,sub:a0,subtract:Mc,transformMat4:r0,transformQuat:n0,zero:s0});function Sn(){var t=new le(4);return le!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function g0(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Dc(t,e,r){r=r*.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function m0(t,e){var r=Math.acos(e[3])*2,n=Math.sin(r/2);return n>Q?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r}function v0(t,e){var r=oi(t,e);return Math.acos(2*r*r-1)}function $c(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=r[0],h=r[1],d=r[2],g=r[3];return t[0]=n*g+c*f+s*d-a*h,t[1]=s*g+c*h+a*f-n*d,t[2]=a*g+c*d+n*h-s*f,t[3]=c*g-n*f-s*h-a*d,t}function Pc(t,e,r){r*=.5;var n=e[0],s=e[1],a=e[2],c=e[3],f=Math.sin(r),h=Math.cos(r);return t[0]=n*h+c*f,t[1]=s*h+a*f,t[2]=a*h-s*f,t[3]=c*h-n*f,t}function kc(t,e,r){r*=.5;var n=e[0],s=e[1],a=e[2],c=e[3],f=Math.sin(r),h=Math.cos(r);return t[0]=n*h-a*f,t[1]=s*h+c*f,t[2]=a*h+n*f,t[3]=c*h-s*f,t}function Uc(t,e,r){r*=.5;var n=e[0],s=e[1],a=e[2],c=e[3],f=Math.sin(r),h=Math.cos(r);return t[0]=n*h+s*f,t[1]=s*h-n*f,t[2]=a*h+c*f,t[3]=c*h-a*f,t}function y0(t,e){var r=e[0],n=e[1],s=e[2];return t[0]=r,t[1]=n,t[2]=s,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-s*s)),t}function Lc(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=Math.sqrt(r*r+n*n+s*s),f=Math.exp(a),h=c>0?f*Math.sin(c)/c:0;return t[0]=r*h,t[1]=n*h,t[2]=s*h,t[3]=f*Math.cos(c),t}function jc(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=Math.sqrt(r*r+n*n+s*s),f=c>0?Math.atan2(c,a)/c:0;return t[0]=r*f,t[1]=n*f,t[2]=s*f,t[3]=.5*Math.log(r*r+n*n+s*s+a*a),t}function x0(t,e,r){return jc(t,e),Vc(t,t,r),Lc(t,t),t}function En(t,e,r,n){var s=e[0],a=e[1],c=e[2],f=e[3],h=r[0],d=r[1],g=r[2],x=r[3],w,M,A,F,m;return M=s*h+a*d+c*g+f*x,M<0&&(M=-M,h=-h,d=-d,g=-g,x=-x),1-M>Q?(w=Math.acos(M),A=Math.sin(w),F=Math.sin((1-n)*w)/A,m=Math.sin(n*w)/A):(F=1-n,m=n),t[0]=F*s+m*h,t[1]=F*a+m*d,t[2]=F*c+m*g,t[3]=F*f+m*x,t}function T0(t){var e=ft(),r=ft(),n=ft(),s=Math.sqrt(1-e),a=Math.sqrt(e);return t[0]=s*Math.sin(2*Math.PI*r),t[1]=s*Math.cos(2*Math.PI*r),t[2]=a*Math.sin(2*Math.PI*n),t[3]=a*Math.cos(2*Math.PI*n),t}function E0(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=r*r+n*n+s*s+a*a,f=c?1/c:0;return t[0]=-r*f,t[1]=-n*f,t[2]=-s*f,t[3]=a*f,t}function w0(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Bc(t,e){var r=e[0]+e[4]+e[8],n;if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);var a=(s+1)%3,c=(s+2)%3;n=Math.sqrt(e[s*3+s]-e[a*3+a]-e[c*3+c]+1),t[s]=.5*n,n=.5/n,t[3]=(e[a*3+c]-e[c*3+a])*n,t[a]=(e[a*3+s]+e[s*3+a])*n,t[c]=(e[c*3+s]+e[s*3+c])*n}return t}function M0(t,e,r,n){var s=.5*Math.PI/180;e*=s,r*=s,n*=s;var a=Math.sin(e),c=Math.cos(e),f=Math.sin(r),h=Math.cos(r),d=Math.sin(n),g=Math.cos(n);return t[0]=a*h*g-c*f*d,t[1]=c*f*g+a*h*d,t[2]=c*h*d-a*f*g,t[3]=c*h*g+a*f*d,t}function _0(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var R0=yc,b0=xc,ai=Tc,A0=Ec,I0=wc,S0=$c,Vc=bc,oi=Cc,C0=Nc,ci=si,N0=ci,li=ii,F0=li,fi=Sc,O0=Fc,D0=Oc,$0=function(){var t=ri(),e=Ns(1,0,0),r=Ns(0,1,0);return function(n,s,a){var c=ni(s,a);return c<-.999999?(Tn(t,e,s),mc(t)<1e-6&&Tn(t,r,s),gc(t,t),Dc(n,t,Math.PI),n):c>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Tn(t,s,a),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+c,fi(n,n))}}(),P0=function(){var t=Sn(),e=Sn();return function(r,n,s,a,c,f){return En(t,n,c,f),En(e,s,a,f),En(r,t,e,2*f*(1-f)),r}}(),k0=function(){var t=Ko();return function(e,r,n,s){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],fi(e,Bc(e,t))}}(),U0=Object.freeze({__proto__:null,add:I0,calculateW:y0,clone:R0,conjugate:w0,copy:ai,create:Sn,dot:oi,equals:D0,exactEquals:O0,exp:Lc,fromEuler:M0,fromMat3:Bc,fromValues:b0,getAngle:v0,getAxisAngle:m0,identity:g0,invert:E0,len:N0,length:ci,lerp:C0,ln:jc,mul:S0,multiply:$c,normalize:fi,pow:x0,random:T0,rotateX:Pc,rotateY:kc,rotateZ:Uc,rotationTo:$0,scale:Vc,set:A0,setAxes:k0,setAxisAngle:Dc,slerp:En,sqlerp:P0,sqrLen:F0,squaredLength:li,str:_0});function L0(){var t=new le(8);return le!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function j0(t){var e=new le(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function B0(t,e,r,n,s,a,c,f){var h=new le(8);return h[0]=t,h[1]=e,h[2]=r,h[3]=n,h[4]=s,h[5]=a,h[6]=c,h[7]=f,h}function V0(t,e,r,n,s,a,c){var f=new le(8);f[0]=t,f[1]=e,f[2]=r,f[3]=n;var h=s*.5,d=a*.5,g=c*.5;return f[4]=h*n+d*r-g*e,f[5]=d*n+g*t-h*r,f[6]=g*n+h*e-d*t,f[7]=-h*t-d*e-g*r,f}function zc(t,e,r){var n=r[0]*.5,s=r[1]*.5,a=r[2]*.5,c=e[0],f=e[1],h=e[2],d=e[3];return t[0]=c,t[1]=f,t[2]=h,t[3]=d,t[4]=n*d+s*h-a*f,t[5]=s*d+a*c-n*h,t[6]=a*d+n*f-s*c,t[7]=-n*c-s*f-a*h,t}function z0(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0]*.5,t[5]=e[1]*.5,t[6]=e[2]*.5,t[7]=0,t}function G0(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function H0(t,e){var r=Sn();sc(r,e);var n=new le(3);return rc(n,e),zc(t,r,n),t}function Gc(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function q0(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function W0(t,e,r,n,s,a,c,f,h){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=a,t[5]=c,t[6]=f,t[7]=h,t}var X0=ai;function Y0(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var K0=ai;function J0(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function Z0(t,e){var r=e[4],n=e[5],s=e[6],a=e[7],c=-e[0],f=-e[1],h=-e[2],d=e[3];return t[0]=(r*d+a*c+n*h-s*f)*2,t[1]=(n*d+a*f+s*c-r*h)*2,t[2]=(s*d+a*h+r*f-n*c)*2,t}function Q0(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=r[0]*.5,h=r[1]*.5,d=r[2]*.5,g=e[4],x=e[5],w=e[6],M=e[7];return t[0]=n,t[1]=s,t[2]=a,t[3]=c,t[4]=c*f+s*d-a*h+g,t[5]=c*h+a*f-n*d+x,t[6]=c*d+n*h-s*f+w,t[7]=-n*f-s*h-a*d+M,t}function em(t,e,r){var n=-e[0],s=-e[1],a=-e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],x=f*c+g*n+h*a-d*s,w=h*c+g*s+d*n-f*a,M=d*c+g*a+f*s-h*n,A=g*c-f*n-h*s-d*a;return Pc(t,e,r),n=t[0],s=t[1],a=t[2],c=t[3],t[4]=x*c+A*n+w*a-M*s,t[5]=w*c+A*s+M*n-x*a,t[6]=M*c+A*a+x*s-w*n,t[7]=A*c-x*n-w*s-M*a,t}function tm(t,e,r){var n=-e[0],s=-e[1],a=-e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],x=f*c+g*n+h*a-d*s,w=h*c+g*s+d*n-f*a,M=d*c+g*a+f*s-h*n,A=g*c-f*n-h*s-d*a;return kc(t,e,r),n=t[0],s=t[1],a=t[2],c=t[3],t[4]=x*c+A*n+w*a-M*s,t[5]=w*c+A*s+M*n-x*a,t[6]=M*c+A*a+x*s-w*n,t[7]=A*c-x*n-w*s-M*a,t}function rm(t,e,r){var n=-e[0],s=-e[1],a=-e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],x=f*c+g*n+h*a-d*s,w=h*c+g*s+d*n-f*a,M=d*c+g*a+f*s-h*n,A=g*c-f*n-h*s-d*a;return Uc(t,e,r),n=t[0],s=t[1],a=t[2],c=t[3],t[4]=x*c+A*n+w*a-M*s,t[5]=w*c+A*s+M*n-x*a,t[6]=M*c+A*a+x*s-w*n,t[7]=A*c-x*n-w*s-M*a,t}function nm(t,e,r){var n=r[0],s=r[1],a=r[2],c=r[3],f=e[0],h=e[1],d=e[2],g=e[3];return t[0]=f*c+g*n+h*a-d*s,t[1]=h*c+g*s+d*n-f*a,t[2]=d*c+g*a+f*s-h*n,t[3]=g*c-f*n-h*s-d*a,f=e[4],h=e[5],d=e[6],g=e[7],t[4]=f*c+g*n+h*a-d*s,t[5]=h*c+g*s+d*n-f*a,t[6]=d*c+g*a+f*s-h*n,t[7]=g*c-f*n-h*s-d*a,t}function sm(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=r[0],h=r[1],d=r[2],g=r[3];return t[0]=n*g+c*f+s*d-a*h,t[1]=s*g+c*h+a*f-n*d,t[2]=a*g+c*d+n*h-s*f,t[3]=c*g-n*f-s*h-a*d,f=r[4],h=r[5],d=r[6],g=r[7],t[4]=n*g+c*f+s*d-a*h,t[5]=s*g+c*h+a*f-n*d,t[6]=a*g+c*d+n*h-s*f,t[7]=c*g-n*f-s*h-a*d,t}function im(t,e,r,n){if(Math.abs(n)<Q)return Gc(t,e);var s=Math.hypot(r[0],r[1],r[2]);n=n*.5;var a=Math.sin(n),c=a*r[0]/s,f=a*r[1]/s,h=a*r[2]/s,d=Math.cos(n),g=e[0],x=e[1],w=e[2],M=e[3];t[0]=g*d+M*c+x*h-w*f,t[1]=x*d+M*f+w*c-g*h,t[2]=w*d+M*h+g*f-x*c,t[3]=M*d-g*c-x*f-w*h;var A=e[4],F=e[5],m=e[6],C=e[7];return t[4]=A*d+C*c+F*h-m*f,t[5]=F*d+C*f+m*c-A*h,t[6]=m*d+C*h+A*f-F*c,t[7]=C*d-A*c-F*f-m*h,t}function am(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t}function Hc(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=r[4],h=r[5],d=r[6],g=r[7],x=e[4],w=e[5],M=e[6],A=e[7],F=r[0],m=r[1],C=r[2],T=r[3];return t[0]=n*T+c*F+s*C-a*m,t[1]=s*T+c*m+a*F-n*C,t[2]=a*T+c*C+n*m-s*F,t[3]=c*T-n*F-s*m-a*C,t[4]=n*g+c*f+s*d-a*h+x*T+A*F+w*C-M*m,t[5]=s*g+c*h+a*f-n*d+w*T+A*m+M*F-x*C,t[6]=a*g+c*d+n*h-s*f+M*T+A*C+x*m-w*F,t[7]=c*g-n*f-s*h-a*d+A*T-x*F-w*m-M*C,t}var om=Hc;function cm(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t}var qc=oi;function lm(t,e,r,n){var s=1-n;return qc(e,r)<0&&(n=-n),t[0]=e[0]*s+r[0]*n,t[1]=e[1]*s+r[1]*n,t[2]=e[2]*s+r[2]*n,t[3]=e[3]*s+r[3]*n,t[4]=e[4]*s+r[4]*n,t[5]=e[5]*s+r[5]*n,t[6]=e[6]*s+r[6]*n,t[7]=e[7]*s+r[7]*n,t}function fm(t,e){var r=Un(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t}function um(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var Wc=ci,hm=Wc,Un=li,dm=Un;function pm(t,e){var r=Un(e);if(r>0){r=Math.sqrt(r);var n=e[0]/r,s=e[1]/r,a=e[2]/r,c=e[3]/r,f=e[4],h=e[5],d=e[6],g=e[7],x=n*f+s*h+a*d+c*g;t[0]=n,t[1]=s,t[2]=a,t[3]=c,t[4]=(f-n*x)/r,t[5]=(h-s*x)/r,t[6]=(d-a*x)/r,t[7]=(g-c*x)/r}return t}function gm(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function mm(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function vm(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=t[4],f=t[5],h=t[6],d=t[7],g=e[0],x=e[1],w=e[2],M=e[3],A=e[4],F=e[5],m=e[6],C=e[7];return Math.abs(r-g)<=Q*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(n-x)<=Q*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(s-w)<=Q*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(a-M)<=Q*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(c-A)<=Q*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(f-F)<=Q*Math.max(1,Math.abs(f),Math.abs(F))&&Math.abs(h-m)<=Q*Math.max(1,Math.abs(h),Math.abs(m))&&Math.abs(d-C)<=Q*Math.max(1,Math.abs(d),Math.abs(C))}var ym=Object.freeze({__proto__:null,add:am,clone:j0,conjugate:um,copy:Gc,create:L0,dot:qc,equals:vm,exactEquals:mm,fromMat4:H0,fromRotation:G0,fromRotationTranslation:zc,fromRotationTranslationValues:V0,fromTranslation:z0,fromValues:B0,getDual:Y0,getReal:X0,getTranslation:Z0,identity:q0,invert:fm,len:hm,length:Wc,lerp:lm,mul:om,multiply:Hc,normalize:pm,rotateAroundAxis:im,rotateByQuatAppend:nm,rotateByQuatPrepend:sm,rotateX:em,rotateY:tm,rotateZ:rm,scale:cm,set:W0,setDual:J0,setReal:K0,sqrLen:dm,squaredLength:Un,str:gm,translate:Q0});function Xc(){var t=new le(2);return le!=Float32Array&&(t[0]=0,t[1]=0),t}function xm(t){var e=new le(2);return e[0]=t[0],e[1]=t[1],e}function Tm(t,e){var r=new le(2);return r[0]=t,r[1]=e,r}function Em(t,e){return t[0]=e[0],t[1]=e[1],t}function wm(t,e,r){return t[0]=e,t[1]=r,t}function Mm(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Yc(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Kc(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function Jc(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function _m(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function Rm(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function bm(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function Am(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function Im(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Sm(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function Cm(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t}function Zc(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.hypot(r,n)}function Qc(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function el(t){var e=t[0],r=t[1];return Math.hypot(e,r)}function tl(t){var e=t[0],r=t[1];return e*e+r*r}function Nm(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Fm(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function Om(t,e){var r=e[0],n=e[1],s=r*r+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t}function Dm(t,e){return t[0]*e[0]+t[1]*e[1]}function $m(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t}function Pm(t,e,r,n){var s=e[0],a=e[1];return t[0]=s+n*(r[0]-s),t[1]=a+n*(r[1]-a),t}function km(t,e){e=e||1;var r=ft()*2*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function Um(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[2]*s,t[1]=r[1]*n+r[3]*s,t}function Lm(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[2]*s+r[4],t[1]=r[1]*n+r[3]*s+r[5],t}function jm(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[3]*s+r[6],t[1]=r[1]*n+r[4]*s+r[7],t}function Bm(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[4]*s+r[12],t[1]=r[1]*n+r[5]*s+r[13],t}function Vm(t,e,r,n){var s=e[0]-r[0],a=e[1]-r[1],c=Math.sin(n),f=Math.cos(n);return t[0]=s*f-a*c+r[0],t[1]=s*c+a*f+r[1],t}function zm(t,e){var r=t[0],n=t[1],s=e[0],a=e[1],c=Math.sqrt(r*r+n*n)*Math.sqrt(s*s+a*a),f=c&&(r*s+n*a)/c;return Math.acos(Math.min(Math.max(f,-1),1))}function Gm(t){return t[0]=0,t[1]=0,t}function Hm(t){return"vec2("+t[0]+", "+t[1]+")"}function qm(t,e){return t[0]===e[0]&&t[1]===e[1]}function Wm(t,e){var r=t[0],n=t[1],s=e[0],a=e[1];return Math.abs(r-s)<=Q*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-a)<=Q*Math.max(1,Math.abs(n),Math.abs(a))}var Xm=el,Ym=Yc,Km=Kc,Jm=Jc,Zm=Zc,Qm=Qc,ev=tl,tv=function(){var t=Xc();return function(e,r,n,s,a,c){var f,h;for(r||(r=2),n||(n=0),s?h=Math.min(s*r+n,e.length):h=e.length,f=n;f<h;f+=r)t[0]=e[f],t[1]=e[f+1],a(t,t,c),e[f]=t[0],e[f+1]=t[1];return e}}(),rv=Object.freeze({__proto__:null,add:Mm,angle:zm,ceil:_m,clone:xm,copy:Em,create:Xc,cross:$m,dist:Zm,distance:Zc,div:Jm,divide:Jc,dot:Dm,equals:Wm,exactEquals:qm,floor:Rm,forEach:tv,fromValues:Tm,inverse:Fm,len:Xm,length:el,lerp:Pm,max:Am,min:bm,mul:Km,multiply:Kc,negate:Nm,normalize:Om,random:km,rotate:Vm,round:Im,scale:Sm,scaleAndAdd:Cm,set:wm,sqrDist:Qm,sqrLen:ev,squaredDistance:Qc,squaredLength:tl,str:Hm,sub:Ym,subtract:Yc,transformMat2:Um,transformMat2d:Lm,transformMat3:jm,transformMat4:Bm,zero:Gm}),rl=Object.freeze({__proto__:null,glMatrix:Yd,mat2:Tp,mat2d:Gp,mat3:Tg,mat4:l1,quat:U0,quat2:ym,vec2:rv,vec3:H1,vec4:p0}),nv=(()=>{var t=import.meta.url;return async function(e={}){var r=e,n,s;r.ready=new Promise((i,o)=>{n=i,s=o});var a=!1;r.setup=function(){if(a)return;a=!0;function i(S,I,D=V=>V){if(I)for(let V of I)S.push_back(D(V));return S}function o(S,I=D=>D){const D=[],V=S.size();for(let J=0;J<V;J++)D.push(I(S.get(J)));return D}function l(S,I=D=>D){const D=[],V=S.size();for(let J=0;J<V;J++){const pe=S.get(J),ue=pe.size(),st=[];for(let We=0;We<ue;We++)st.push(I(pe.get(We)));D.push(st)}return D}function u(S){return S[0].length<3&&(S=[S]),i(new r.Vector2_vec2,S,I=>i(new r.Vector_vec2,I,D=>D instanceof Array?{x:D[0],y:D[1]}:D))}function p(S){for(let I=0;I<S.size();I++)S.get(I).delete();S.delete()}function v(S){return S[0]instanceof Array?{x:S[0][0],y:S[0][1]}:typeof S[0]=="number"?{x:S[0]||0,y:S[1]||0}:S[0]}function E(S){return S[0]instanceof Array?{x:S[0][0],y:S[0][1],z:S[0][2]}:typeof S[0]=="number"?{x:S[0]||0,y:S[1]||0,z:S[2]||0}:S[0]}function R(S){return S=="EvenOdd"?0:S=="NonZero"?1:S=="Negative"?3:2}function O(S){return S=="Round"?1:S=="Miter"?2:0}const P=r.CrossSection;function j(S,I="Positive"){if(S instanceof P)return S;{const D=u(S),V=new P(D,R(I));return p(D),V}}r.CrossSection.prototype.translate=function(...S){return this._Translate(v(S))},r.CrossSection.prototype.scale=function(S){return typeof S=="number"?this._Scale({x:S,y:S}):this._Scale(v([S]))},r.CrossSection.prototype.mirror=function(S){return this._Mirror(v([S]))},r.CrossSection.prototype.warp=function(S){const I=br(function(V){const J=ct(V,"float"),pe=ct(V+4,"float"),ue=[J,pe];S(ue),nr(V,ue[0],"float"),nr(V+4,ue[1],"float")},"vi"),D=this._Warp(I);return Ar(I),D},r.CrossSection.prototype.decompose=function(){const S=this._Decompose(),I=o(S);return S.delete(),I},r.CrossSection.prototype.bounds=function(){const S=this._Bounds();return{min:["x","y"].map(I=>S.min[I]),max:["x","y"].map(I=>S.max[I])}},r.CrossSection.prototype.offset=function(S,I="Square",D=2,V=0){return this._Offset(S,O(I),D,V)},r.CrossSection.prototype.extrude=function(S,I=0,D=0,V=[1,1],J=!1){V=v([V]);const pe=r._Extrude(this,S,I,D,V);return J?pe.translate([0,0,-S/2]):pe},r.CrossSection.prototype.revolve=function(S=0,I=360){return r._Revolve(this,S,I)},r.CrossSection.prototype.add=function(S){return this._add(j(S))},r.CrossSection.prototype.subtract=function(S){return this._subtract(j(S))},r.CrossSection.prototype.intersect=function(S){return this._intersect(j(S))},r.CrossSection.prototype.toPolygons=function(){const S=this._ToPolygons(),I=l(S);return S.delete(),I},r.Manifold.prototype.warp=function(S){const I=br(function(J){const pe=ct(J,"float"),ue=ct(J+4,"float"),st=ct(J+8,"float"),We=[pe,ue,st];S(We),nr(J,We[0],"float"),nr(J+4,We[1],"float"),nr(J+8,We[2],"float")},"vi"),D=this._Warp(I);Ar(I);const V=D.status();if(V.value!==0)throw new r.ManifoldError(V.value);return D},r.Manifold.prototype.setProperties=function(S,I){const D=this.numProp(),V=br(function(pe,ue,st){const We=[];for(let Pe=0;Pe<S;++Pe)We[Pe]=ct(pe+4*Pe,"float");const cr=[];for(let Pe=0;Pe<3;++Pe)cr[Pe]=ct(ue+4*Pe,"float");const lr=[];for(let Pe=0;Pe<D;++Pe)lr[Pe]=ct(st+4*Pe,"float");I(We,cr,lr);for(let Pe=0;Pe<S;++Pe)nr(pe+4*Pe,We[Pe],"float")},"viii"),J=this._SetProperties(S,V);return Ar(V),J},r.Manifold.prototype.translate=function(...S){return this._Translate(E(S))},r.Manifold.prototype.rotate=function(S){return this._Rotate(...S)},r.Manifold.prototype.scale=function(S){return typeof S=="number"?this._Scale({x:S,y:S,z:S}):this._Scale(E([S]))},r.Manifold.prototype.mirror=function(S){return this._Mirror(E([S]))},r.Manifold.prototype.trimByPlane=function(S,I=0){return this._TrimByPlane(E([S]),I)},r.Manifold.prototype.split=function(S){const I=this._split(S),D=o(I);return I.delete(),D},r.Manifold.prototype.splitByPlane=function(S,I=0){const D=this._splitByPlane(E([S]),I),V=o(D);return D.delete(),V},r.Manifold.prototype.decompose=function(){const S=this._Decompose(),I=o(S);return S.delete(),I},r.Manifold.prototype.boundingBox=function(){const S=this._boundingBox();return{min:["x","y","z"].map(I=>S.min[I]),max:["x","y","z"].map(I=>S.max[I])}};class Y{constructor({numProp:I=3,triVerts:D=new Uint32Array,vertProperties:V=new Float32Array,mergeFromVert:J,mergeToVert:pe,runIndex:ue,runOriginalID:st,faceID:We,halfedgeTangent:cr,runTransform:lr}={}){this.numProp=I,this.triVerts=D,this.vertProperties=V,this.mergeFromVert=J,this.mergeToVert=pe,this.runIndex=ue,this.runOriginalID=st,this.faceID=We,this.halfedgeTangent=cr,this.runTransform=lr}get numTri(){return this.triVerts.length/3}get numVert(){return this.vertProperties.length/this.numProp}get numRun(){return this.runOriginalID.length}merge(){const{changed:I,mesh:D}=r._Merge(this);return Object.assign(this,{...D}),I}verts(I){return this.triVerts.subarray(3*I,3*(I+1))}position(I){return this.vertProperties.subarray(numProp*I,numProp*I+3)}extras(I){return this.vertProperties.subarray(numProp*I+3,numProp*(I+1))}tangent(I){return this.halfedgeTangent.subarray(4*I,4*(I+1))}transform(I){const D=new Array(16);for(const V of[0,1,2,3])for(const J of[0,1,2])D[4*V+J]=this.runTransform[12*I+3*V+J];return D[15]=1,D}}r.Mesh=Y,r.Manifold.prototype.getMesh=function(S=[0,0,0]){return S instanceof Array&&(S={0:S[0],1:S[1],2:S[2]}),new Y(this._GetMeshJS(S))},r.ManifoldError=function(I,...D){let V="Unknown error";switch(I){case r.status.NonFiniteVertex.value:V="Non-finite vertex";break;case r.status.NotManifold.value:V="Not manifold";break;case r.status.VertexOutOfBounds.value:V="Vertex index out of bounds";break;case r.status.PropertiesWrongLength.value:V="Properties have wrong length";break;case r.status.MissingPositionProperties.value:V="Less than three properties";break;case r.status.MergeVectorsDifferentLengths.value:V="Merge vectors have different lengths";break;case r.status.MergeIndexOutOfBounds.value:V="Merge index out of bounds";break;case r.status.TransformWrongLength.value:V="Transform vector has wrong length";break;case r.status.RunIndexWrongLength.value:V="Run index vector has wrong length";break;case r.status.FaceIDWrongLength.value:V="Face ID vector has wrong length";case r.status.InvalidConstruction.value:V="Manifold constructed with invalid parameters"}const J=Error.apply(this,[V,...D]);J.name=this.name="ManifoldError",this.message=J.message,this.stack=J.stack,this.code=I},r.ManifoldError.prototype=Object.create(Error.prototype,{constructor:{value:r.ManifoldError,writable:!0,configurable:!0}}),r.CrossSection=function(S,I="Positive"){const D=u(S),V=new P(D,R(I));return p(D),V},r.CrossSection.ofPolygons=function(S,I="Positive"){return new r.CrossSection(S,I)},r.CrossSection.square=function(...S){let I;S.length==0?I={x:1,y:1}:typeof S[0]=="number"?I={x:S[0],y:S[0]}:I=v(S);const D=S[1]||!1;return r._Square(I,D)},r.CrossSection.circle=function(S,I=0){return r._Circle(S,I)};function q(S){return function(...I){I.length==1&&(I=I[0]);const D=new r.Vector_crossSection;for(const J of I)D.push_back(j(J));const V=r["_crossSection"+S](D);return D.delete(),V}}r.CrossSection.compose=q("Compose"),r.CrossSection.union=q("UnionN"),r.CrossSection.difference=q("DifferenceN"),r.CrossSection.intersection=q("IntersectionN");function X(S,I){i(S,I,D=>D instanceof Array?{x:D[0],y:D[1]}:D)}r.CrossSection.hull=function(...S){S.length==1&&(S=S[0]);let I=new r.Vector_vec2;for(const V of S)if(V instanceof P)r._crossSectionCollectVertices(I,V);else if(V instanceof Array&&V.length==2&&typeof V[0]=="number")I.push_back({x:V[0],y:V[1]});else if(V.x)I.push_back(V);else{const pe=V[0].length==2&&typeof V[0][0]=="number"||V[0].x?[V]:V;for(const ue of pe)X(I,ue)}const D=r._crossSectionHullPoints(I);return I.delete(),D},r.CrossSection.prototype=Object.create(P.prototype),Object.defineProperty(r.CrossSection,Symbol.hasInstance,{get:()=>S=>S instanceof P});const Z=r.Manifold;r.Manifold=function(S){const I=new Z(S),D=I.status();if(D.value!==0)throw new r.ManifoldError(D.value);return I},r.Manifold.ofMesh=function(S){return new r.Manifold(S)},r.Manifold.tetrahedron=function(){return r._Tetrahedron()},r.Manifold.cube=function(...S){let I;S.length==0?I={x:1,y:1,z:1}:typeof S[0]=="number"?I={x:S[0],y:S[0],z:S[0]}:I=E(S);const D=S[1]||!1;return r._Cube(I,D)},r.Manifold.cylinder=function(S,I,D=-1,V=0,J=!1){return r._Cylinder(S,I,D,V,J)},r.Manifold.sphere=function(S,I=0){return r._Sphere(S,I)},r.Manifold.smooth=function(S,I=[]){const D=new r.Vector_smoothness;i(D,I);const V=r._Smooth(S,D);return D.delete(),V},r.Manifold.extrude=function(S,I,D=0,V=0,J=[1,1],pe=!1){return(S instanceof P?S:r.CrossSection(S,"Positive")).extrude(I,D,V,J,pe)},r.Manifold.revolve=function(S,I=0,D=360){return(S instanceof P?S:r.CrossSection(S,"Positive")).revolve(I,D)},r.Manifold.reserveIDs=function(S){return r._ReserveIDs(S)},r.Manifold.compose=function(S){const I=new r.Vector_manifold;i(I,S);const D=r._manifoldCompose(I);return I.delete(),D};function he(S){return function(...I){I.length==1&&(I=I[0]);const D=new r.Vector_manifold;for(const J of I)D.push_back(J);const V=r["_manifold"+S+"N"](D);return D.delete(),V}}r.Manifold.union=he("Union"),r.Manifold.difference=he("Difference"),r.Manifold.intersection=he("Intersection"),r.Manifold.levelSet=function(S,I,D,V=0){const J={min:{x:I.min[0],y:I.min[1],z:I.min[2]},max:{x:I.max[0],y:I.max[1],z:I.max[2]}},pe=br(function(st){const We=ct(st,"float"),cr=ct(st+4,"float"),lr=ct(st+8,"float");return S([We,cr,lr])},"fi"),ue=r._LevelSet(pe,J,D,V);return Ar(pe),ue};function ge(S,I){i(S,I,D=>D instanceof Array?{x:D[0],y:D[1],z:D[2]}:D)}r.Manifold.hull=function(...S){S.length==1&&(S=S[0]);let I=new r.Vector_vec3;for(const V of S)V instanceof Z?r._manifoldCollectVertices(I,V):V instanceof Array&&V.length==3&&typeof V[0]=="number"?I.push_back({x:V[0],y:V[1],z:V[2]}):V.x?I.push_back(V):ge(I,V);const D=r._manifoldHullPoints(I);return I.delete(),D},r.Manifold.prototype=Object.create(Z.prototype),Object.defineProperty(r.Manifold,Symbol.hasInstance,{get:()=>S=>S instanceof Z}),r.triangulate=function(S,I=-1){const D=u(S),V=o(r._Triangulate(D,I),J=>[J[0],J[1],J[2]]);return p(D),V}};var c=Object.assign({},r),f="./this.program",h=typeof window=="object",d=typeof importScripts=="function",g=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",x="";function w(i){return r.locateFile?r.locateFile(i,x):x+i}var M,A,F;if(g){const{createRequire:i}=await import("./__vite-browser-external-4ed993c7.js");var m=i(import.meta.url),C=m("fs"),T=m("path");d?x=T.dirname(x)+"/":x=m("url").fileURLToPath(new URL("./",self.location)),M=(o,l)=>(o=rr(o)?new URL(o):T.normalize(o),C.readFileSync(o,l?void 0:"utf8")),F=o=>{var l=M(o,!0);return l.buffer||(l=new Uint8Array(l)),l},A=(o,l,u,p=!0)=>{o=rr(o)?new URL(o):T.normalize(o),C.readFile(o,p?void 0:"utf8",(v,E)=>{v?u(v):l(p?E.buffer:E)})},!r.thisProgram&&process.argv.length>1&&(f=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),r.inspect=()=>"[Emscripten Module object]"}else(h||d)&&(d?x=self.location.href:typeof document<"u"&&document.currentScript&&(x=document.currentScript.src),t&&(x=t),x.indexOf("blob:")!==0?x=x.substr(0,x.replace(/[?#].*/,"").lastIndexOf("/")+1):x="",M=i=>{var o=new XMLHttpRequest;return o.open("GET",i,!1),o.send(null),o.responseText},d&&(F=i=>{var o=new XMLHttpRequest;return o.open("GET",i,!1),o.responseType="arraybuffer",o.send(null),new Uint8Array(o.response)}),A=(i,o,l)=>{var u=new XMLHttpRequest;u.open("GET",i,!0),u.responseType="arraybuffer",u.onload=()=>{if(u.status==200||u.status==0&&u.response){o(u.response);return}l()},u.onerror=l,u.send(null)});var _=r.print||console.log.bind(console),b=r.printErr||console.error.bind(console);Object.assign(r,c),c=null,r.arguments&&r.arguments,r.thisProgram&&(f=r.thisProgram),r.quit&&r.quit;var N;r.wasmBinary&&(N=r.wasmBinary),typeof WebAssembly!="object"&&qe("no native wasm support detected");var $,z=!1;function B(i,o){i||qe(o)}var k,G,H,K,L,U,ee,fe;function re(){var i=$.buffer;r.HEAP8=k=new Int8Array(i),r.HEAP16=H=new Int16Array(i),r.HEAPU8=G=new Uint8Array(i),r.HEAPU16=K=new Uint16Array(i),r.HEAP32=L=new Int32Array(i),r.HEAPU32=U=new Uint32Array(i),r.HEAPF32=ee=new Float32Array(i),r.HEAPF64=fe=new Float64Array(i)}var ye=[],me=[],xe=[];function Te(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)be(r.preRun.shift());jn(ye)}function _e(){!r.noFSInit&&!y.init.initialized&&y.init(),y.ignorePermissions=!1,jn(me)}function ke(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)Qe(r.postRun.shift());jn(xe)}function be(i){ye.unshift(i)}function Se(i){me.unshift(i)}function Qe(i){xe.unshift(i)}var Ve=0,rt=null;function Ce(i){return i}function dt(i){Ve++,r.monitorRunDependencies&&r.monitorRunDependencies(Ve)}function ze(i){if(Ve--,r.monitorRunDependencies&&r.monitorRunDependencies(Ve),Ve==0&&rt){var o=rt;rt=null,o()}}function qe(i){r.onAbort&&r.onAbort(i),i="Aborted("+i+")",b(i),z=!0,i+=". Build with -sASSERTIONS for more info.";var o=new WebAssembly.RuntimeError(i);throw s(o),o}var Nt="data:application/octet-stream;base64,",It=i=>i.startsWith(Nt),rr=i=>i.startsWith("file://"),Tt;r.locateFile?(Tt="manifold.wasm",It(Tt)||(Tt=w(Tt))):Tt=new URL("/assets/manifold-49724b10.wasm",self.location).href;function Yr(i){if(i==Tt&&N)return new Uint8Array(N);if(F)return F(i);throw"both async and sync fetching of the wasm failed"}function hl(i){if(!N&&(h||d)){if(typeof fetch=="function"&&!rr(i))return fetch(i,{credentials:"same-origin"}).then(o=>{if(!o.ok)throw"failed to load wasm binary file at '"+i+"'";return o.arrayBuffer()}).catch(()=>Yr(i));if(A)return new Promise((o,l)=>{A(i,u=>o(new Uint8Array(u)),l)})}return Promise.resolve().then(()=>Yr(i))}function pi(i,o,l){return hl(i).then(u=>WebAssembly.instantiate(u,o)).then(u=>u).then(l,u=>{b(`failed to asynchronously prepare wasm: ${u}`),qe(u)})}function dl(i,o,l,u){return!i&&typeof WebAssembly.instantiateStreaming=="function"&&!It(o)&&!rr(o)&&!g&&typeof fetch=="function"?fetch(o,{credentials:"same-origin"}).then(p=>{var v=WebAssembly.instantiateStreaming(p,l);return v.then(u,function(E){return b(`wasm streaming compile failed: ${E}`),b("falling back to ArrayBuffer instantiation"),pi(o,l,u)})}):pi(o,l,u)}function pl(){var i={a:Eu};function o(u,p){return Me=u.exports,$=Me.La,re(),Dt=Me.Na,Se(Me.Ma),ze(),Me}dt();function l(u){o(u.instance)}if(r.instantiateWasm)try{return r.instantiateWasm(i,o)}catch(u){b(`Module.instantiateWasm callback failed with error: ${u}`),s(u)}return dl(N,Tt,i,l).catch(s),{}}var de,Le,jn=i=>{for(;i.length>0;)i.shift()(r)};function ct(i,o="i8"){switch(o.endsWith("*")&&(o="*"),o){case"i1":return k[i>>0];case"i8":return k[i>>0];case"i16":return H[i>>1];case"i32":return L[i>>2];case"i64":qe("to do getValue(i64) use WASM_BIGINT");case"float":return ee[i>>2];case"double":return fe[i>>3];case"*":return U[i>>2];default:qe(`invalid type for getValue: ${o}`)}}r.noExitRuntime;function nr(i,o,l="i8"){switch(l.endsWith("*")&&(l="*"),l){case"i1":k[i>>0]=o;break;case"i8":k[i>>0]=o;break;case"i16":H[i>>1]=o;break;case"i32":L[i>>2]=o;break;case"i64":qe("to do setValue(i64) use WASM_BIGINT");case"float":ee[i>>2]=o;break;case"double":fe[i>>3]=o;break;case"*":U[i>>2]=o;break;default:qe(`invalid type for setValue: ${l}`)}}var Kr=[],Jr=0,gl=i=>{var o=new Bn(i);return o.get_caught()||(o.set_caught(!0),Jr--),o.set_rethrown(!1),Kr.push(o),Vi(o.excPtr),o.get_exception_ptr()},Et=0,ml=()=>{ne(0,0);var i=Kr.pop();Bi(i.excPtr),Et=0};function Bn(i){this.excPtr=i,this.ptr=i-24,this.set_type=function(o){U[this.ptr+4>>2]=o},this.get_type=function(){return U[this.ptr+4>>2]},this.set_destructor=function(o){U[this.ptr+8>>2]=o},this.get_destructor=function(){return U[this.ptr+8>>2]},this.set_caught=function(o){o=o?1:0,k[this.ptr+12>>0]=o},this.get_caught=function(){return k[this.ptr+12>>0]!=0},this.set_rethrown=function(o){o=o?1:0,k[this.ptr+13>>0]=o},this.get_rethrown=function(){return k[this.ptr+13>>0]!=0},this.init=function(o,l){this.set_adjusted_ptr(0),this.set_type(o),this.set_destructor(l)},this.set_adjusted_ptr=function(o){U[this.ptr+16>>2]=o},this.get_adjusted_ptr=function(){return U[this.ptr+16>>2]},this.get_exception_ptr=function(){var o=Gi(this.get_type());if(o)return U[this.excPtr>>2];var l=this.get_adjusted_ptr();return l!==0?l:this.excPtr}}var vl=i=>{throw Et||(Et=i),Et},gi=i=>{var o=Et;if(!o)return Ir(0),0;var l=new Bn(o);l.set_adjusted_ptr(o);var u=l.get_type();if(!u)return Ir(0),o;for(var p in i){var v=i[p];if(v===0||v===u)break;var E=l.ptr+16;if(zi(v,u,E))return Ir(v),o}return Ir(u),o},yl=()=>gi([]),xl=i=>gi([i]),Tl=()=>{var i=Kr.pop();i||qe("no exception to throw");var o=i.excPtr;throw i.get_rethrown()||(Kr.push(i),i.set_rethrown(!0),i.set_caught(!1),Jr++),Et=o,Et},El=(i,o,l)=>{var u=new Bn(i);throw u.init(o,l),Et=i,Jr++,Et},wl=()=>Jr,Zr={},Vn=i=>{for(;i.length;){var o=i.pop(),l=i.pop();l(o)}};function zn(i){return this.fromWireType(L[i>>2])}var sr={},Ft={},Qr={},mi,en=i=>{throw new mi(i)},Ot=(i,o,l)=>{i.forEach(function(R){Qr[R]=o});function u(R){var O=l(R);O.length!==i.length&&en("Mismatched type converter count");for(var P=0;P<i.length;++P)pt(i[P],O[P])}var p=new Array(o.length),v=[],E=0;o.forEach((R,O)=>{Ft.hasOwnProperty(R)?p[O]=Ft[R]:(v.push(R),sr.hasOwnProperty(R)||(sr[R]=[]),sr[R].push(()=>{p[O]=Ft[R],++E,E===v.length&&u(p)}))}),v.length===0&&u(p)},Ml=i=>{var o=Zr[i];delete Zr[i];var l=o.rawConstructor,u=o.rawDestructor,p=o.fields,v=p.map(E=>E.getterReturnType).concat(p.map(E=>E.setterArgumentType));Ot([i],v,E=>{var R={};return p.forEach((O,P)=>{var j=O.fieldName,Y=E[P],q=O.getter,X=O.getterContext,Z=E[P+p.length],he=O.setter,ge=O.setterContext;R[j]={read:S=>Y.fromWireType(q(X,S)),write:(S,I)=>{var D=[];he(ge,S,Z.toWireType(D,I)),Vn(D)}}}),[{name:o.name,fromWireType:O=>{var P={};for(var j in R)P[j]=R[j].read(O);return u(O),P},toWireType:(O,P)=>{for(var j in R)if(!(j in P))throw new TypeError(`Missing field: "${j}"`);var Y=l();for(j in R)R[j].write(Y,P[j]);return O!==null&&O.push(u,Y),Y},argPackAdvance:gt,readValueFromPointer:zn,destructorFunction:u}]})},_l=(i,o,l,u,p)=>{},Rl=()=>{for(var i=new Array(256),o=0;o<256;++o)i[o]=String.fromCharCode(o);vi=i},vi,je=i=>{for(var o="",l=i;G[l];)o+=vi[G[l++]];return o},ir,ve=i=>{throw new ir(i)};function bl(i,o,l={}){var u=o.name;if(i||ve(`type "${u}" must have a positive integer typeid pointer`),Ft.hasOwnProperty(i)){if(l.ignoreDuplicateRegistrations)return;ve(`Cannot register type '${u}' twice`)}if(Ft[i]=o,delete Qr[i],sr.hasOwnProperty(i)){var p=sr[i];delete sr[i],p.forEach(v=>v())}}function pt(i,o,l={}){if(!("argPackAdvance"in o))throw new TypeError("registerType registeredInstance requires argPackAdvance");return bl(i,o,l)}var gt=8,Al=(i,o,l,u)=>{o=je(o),pt(i,{name:o,fromWireType:function(p){return!!p},toWireType:function(p,v){return v?l:u},argPackAdvance:gt,readValueFromPointer:function(p){return this.fromWireType(G[p])},destructorFunction:null})},Il=i=>({count:i.count,deleteScheduled:i.deleteScheduled,preservePointerOnDelete:i.preservePointerOnDelete,ptr:i.ptr,ptrType:i.ptrType,smartPtr:i.smartPtr,smartPtrType:i.smartPtrType}),Gn=i=>{function o(l){return l.$$.ptrType.registeredClass.name}ve(o(i)+" instance already deleted")},Hn=!1,yi=i=>{},Sl=i=>{i.smartPtr?i.smartPtrType.rawDestructor(i.smartPtr):i.ptrType.registeredClass.rawDestructor(i.ptr)},xi=i=>{i.count.value-=1;var o=i.count.value===0;o&&Sl(i)},Ti=(i,o,l)=>{if(o===l)return i;if(l.baseClass===void 0)return null;var u=Ti(i,o,l.baseClass);return u===null?null:l.downcast(u)},Ei={},Cl=()=>Object.keys(wr).length,Nl=()=>{var i=[];for(var o in wr)wr.hasOwnProperty(o)&&i.push(wr[o]);return i},Tr=[],qn=()=>{for(;Tr.length;){var i=Tr.pop();i.$$.deleteScheduled=!1,i.delete()}},Er,Fl=i=>{Er=i,Tr.length&&Er&&Er(qn)},Ol=()=>{r.getInheritedInstanceCount=Cl,r.getLiveInheritedInstances=Nl,r.flushPendingDeletes=qn,r.setDelayFunction=Fl},wr={},Dl=(i,o)=>{for(o===void 0&&ve("ptr should not be undefined");i.baseClass;)o=i.upcast(o),i=i.baseClass;return o},$l=(i,o)=>(o=Dl(i,o),wr[o]),tn=(i,o)=>{(!o.ptrType||!o.ptr)&&en("makeClassHandle requires ptr and ptrType");var l=!!o.smartPtrType,u=!!o.smartPtr;return l!==u&&en("Both smartPtrType and smartPtr must be specified"),o.count={value:1},Mr(Object.create(i,{$$:{value:o}}))};function Pl(i){var o=this.getPointee(i);if(!o)return this.destructor(i),null;var l=$l(this.registeredClass,o);if(l!==void 0){if(l.$$.count.value===0)return l.$$.ptr=o,l.$$.smartPtr=i,l.clone();var u=l.clone();return this.destructor(i),u}function p(){return this.isSmartPointer?tn(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:o,smartPtrType:this,smartPtr:i}):tn(this.registeredClass.instancePrototype,{ptrType:this,ptr:i})}var v=this.registeredClass.getActualType(o),E=Ei[v];if(!E)return p.call(this);var R;this.isConst?R=E.constPointerType:R=E.pointerType;var O=Ti(o,this.registeredClass,R.registeredClass);return O===null?p.call(this):this.isSmartPointer?tn(R.registeredClass.instancePrototype,{ptrType:R,ptr:O,smartPtrType:this,smartPtr:i}):tn(R.registeredClass.instancePrototype,{ptrType:R,ptr:O})}var Mr=i=>typeof FinalizationRegistry>"u"?(Mr=o=>o,i):(Hn=new FinalizationRegistry(o=>{xi(o.$$)}),Mr=o=>{var l=o.$$,u=!!l.smartPtr;if(u){var p={$$:l};Hn.register(o,p,o)}return o},yi=o=>Hn.unregister(o),Mr(i)),kl=()=>{Object.assign(rn.prototype,{isAliasOf(i){if(!(this instanceof rn)||!(i instanceof rn))return!1;var o=this.$$.ptrType.registeredClass,l=this.$$.ptr;i.$$=i.$$;for(var u=i.$$.ptrType.registeredClass,p=i.$$.ptr;o.baseClass;)l=o.upcast(l),o=o.baseClass;for(;u.baseClass;)p=u.upcast(p),u=u.baseClass;return o===u&&l===p},clone(){if(this.$$.ptr||Gn(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var i=Mr(Object.create(Object.getPrototypeOf(this),{$$:{value:Il(this.$$)}}));return i.$$.count.value+=1,i.$$.deleteScheduled=!1,i},delete(){this.$$.ptr||Gn(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ve("Object already scheduled for deletion"),yi(this),xi(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},isDeleted(){return!this.$$.ptr},deleteLater(){return this.$$.ptr||Gn(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ve("Object already scheduled for deletion"),Tr.push(this),Tr.length===1&&Er&&Er(qn),this.$$.deleteScheduled=!0,this}})};function rn(){}var ar=(i,o)=>Object.defineProperty(o,"name",{value:i}),wi=(i,o,l)=>{if(i[o].overloadTable===void 0){var u=i[o];i[o]=function(){return i[o].overloadTable.hasOwnProperty(arguments.length)||ve(`Function '${l}' called with an invalid number of arguments (${arguments.length}) - expects one of (${i[o].overloadTable})!`),i[o].overloadTable[arguments.length].apply(this,arguments)},i[o].overloadTable=[],i[o].overloadTable[u.argCount]=u}},Wn=(i,o,l)=>{r.hasOwnProperty(i)?((l===void 0||r[i].overloadTable!==void 0&&r[i].overloadTable[l]!==void 0)&&ve(`Cannot register public name '${i}' twice`),wi(r,i,i),r.hasOwnProperty(l)&&ve(`Cannot register multiple overloads of a function with the same number of arguments (${l})!`),r[i].overloadTable[l]=o):(r[i]=o,l!==void 0&&(r[i].numArguments=l))},Ul=48,Ll=57,jl=i=>{if(i===void 0)return"_unknown";i=i.replace(/[^a-zA-Z0-9_]/g,"$");var o=i.charCodeAt(0);return o>=Ul&&o<=Ll?`_${i}`:i};function Bl(i,o,l,u,p,v,E,R){this.name=i,this.constructor=o,this.instancePrototype=l,this.rawDestructor=u,this.baseClass=p,this.getActualType=v,this.upcast=E,this.downcast=R,this.pureVirtualFunctions=[]}var Xn=(i,o,l)=>{for(;o!==l;)o.upcast||ve(`Expected null or instance of ${l.name}, got an instance of ${o.name}`),i=o.upcast(i),o=o.baseClass;return i};function Vl(i,o){if(o===null)return this.isReference&&ve(`null is not a valid ${this.name}`),0;o.$$||ve(`Cannot pass "${Zn(o)}" as a ${this.name}`),o.$$.ptr||ve(`Cannot pass deleted object as a pointer of type ${this.name}`);var l=o.$$.ptrType.registeredClass,u=Xn(o.$$.ptr,l,this.registeredClass);return u}function zl(i,o){var l;if(o===null)return this.isReference&&ve(`null is not a valid ${this.name}`),this.isSmartPointer?(l=this.rawConstructor(),i!==null&&i.push(this.rawDestructor,l),l):0;o.$$||ve(`Cannot pass "${Zn(o)}" as a ${this.name}`),o.$$.ptr||ve(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&o.$$.ptrType.isConst&&ve(`Cannot convert argument of type ${o.$$.smartPtrType?o.$$.smartPtrType.name:o.$$.ptrType.name} to parameter type ${this.name}`);var u=o.$$.ptrType.registeredClass;if(l=Xn(o.$$.ptr,u,this.registeredClass),this.isSmartPointer)switch(o.$$.smartPtr===void 0&&ve("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:o.$$.smartPtrType===this?l=o.$$.smartPtr:ve(`Cannot convert argument of type ${o.$$.smartPtrType?o.$$.smartPtrType.name:o.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:l=o.$$.smartPtr;break;case 2:if(o.$$.smartPtrType===this)l=o.$$.smartPtr;else{var p=o.clone();l=this.rawShare(l,Be.toHandle(()=>p.delete())),i!==null&&i.push(this.rawDestructor,l)}break;default:ve("Unsupporting sharing policy")}return l}function Gl(i,o){if(o===null)return this.isReference&&ve(`null is not a valid ${this.name}`),0;o.$$||ve(`Cannot pass "${Zn(o)}" as a ${this.name}`),o.$$.ptr||ve(`Cannot pass deleted object as a pointer of type ${this.name}`),o.$$.ptrType.isConst&&ve(`Cannot convert argument of type ${o.$$.ptrType.name} to parameter type ${this.name}`);var l=o.$$.ptrType.registeredClass,u=Xn(o.$$.ptr,l,this.registeredClass);return u}function Mi(i){return this.fromWireType(U[i>>2])}var Hl=()=>{Object.assign(nn.prototype,{getPointee(i){return this.rawGetPointee&&(i=this.rawGetPointee(i)),i},destructor(i){this.rawDestructor&&this.rawDestructor(i)},argPackAdvance:gt,readValueFromPointer:Mi,deleteObject(i){i!==null&&i.delete()},fromWireType:Pl})};function nn(i,o,l,u,p,v,E,R,O,P,j){this.name=i,this.registeredClass=o,this.isReference=l,this.isConst=u,this.isSmartPointer=p,this.pointeeType=v,this.sharingPolicy=E,this.rawGetPointee=R,this.rawConstructor=O,this.rawShare=P,this.rawDestructor=j,!p&&o.baseClass===void 0?u?(this.toWireType=Vl,this.destructorFunction=null):(this.toWireType=Gl,this.destructorFunction=null):this.toWireType=zl}var _i=(i,o,l)=>{r.hasOwnProperty(i)||en("Replacing nonexistant public symbol"),r[i].overloadTable!==void 0&&l!==void 0?r[i].overloadTable[l]=o:(r[i]=o,r[i].argCount=l)},ql=(i,o,l)=>{var u=r["dynCall_"+i];return l&&l.length?u.apply(null,[o].concat(l)):u.call(null,o)},_r=[],Dt,ce=i=>{var o=_r[i];return o||(i>=_r.length&&(_r.length=i+1),_r[i]=o=Dt.get(i)),o},Wl=(i,o,l)=>{if(i.includes("j"))return ql(i,o,l);var u=ce(o).apply(null,l);return u},Xl=(i,o)=>{var l=[];return function(){return l.length=0,Object.assign(l,arguments),Wl(i,o,l)}},lt=(i,o)=>{i=je(i);function l(){return i.includes("j")?Xl(i,o):ce(o)}var u=l();return typeof u!="function"&&ve(`unknown function pointer with signature ${i}: ${o}`),u},Yl=(i,o)=>{var l=ar(o,function(u){this.name=o,this.message=u;var p=new Error(u).stack;p!==void 0&&(this.stack=this.toString()+`
`+p.replace(/^Error(:[^\n]*)?\n/,""))});return l.prototype=Object.create(i.prototype),l.prototype.constructor=l,l.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},l},Ri,bi=i=>{var o=ji(i),l=je(o);return Mt(o),l},sn=(i,o)=>{var l=[],u={};function p(v){if(!u[v]&&!Ft[v]){if(Qr[v]){Qr[v].forEach(p);return}l.push(v),u[v]=!0}}throw o.forEach(p),new Ri(`${i}: `+l.map(bi).join([", "]))},Kl=(i,o,l,u,p,v,E,R,O,P,j,Y,q)=>{j=je(j),v=lt(p,v),R&&(R=lt(E,R)),P&&(P=lt(O,P)),q=lt(Y,q);var X=jl(j);Wn(X,function(){sn(`Cannot construct ${j} due to unbound types`,[u])}),Ot([i,o,l],u?[u]:[],function(Z){Z=Z[0];var he,ge;u?(he=Z.registeredClass,ge=he.instancePrototype):ge=rn.prototype;var S=ar(j,function(){if(Object.getPrototypeOf(this)!==I)throw new ir("Use 'new' to construct "+j);if(D.constructor_body===void 0)throw new ir(j+" has no accessible constructor");var ue=D.constructor_body[arguments.length];if(ue===void 0)throw new ir(`Tried to invoke ctor of ${j} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(D.constructor_body).toString()}) parameters instead!`);return ue.apply(this,arguments)}),I=Object.create(ge,{constructor:{value:S}});S.prototype=I;var D=new Bl(j,S,I,q,he,v,R,P);D.baseClass&&(D.baseClass.__derivedClasses===void 0&&(D.baseClass.__derivedClasses=[]),D.baseClass.__derivedClasses.push(D));var V=new nn(j,D,!0,!1,!1),J=new nn(j+"*",D,!1,!1,!1),pe=new nn(j+" const*",D,!1,!0,!1);return Ei[i]={pointerType:J,constPointerType:pe},_i(X,S),[V,J,pe]})},Yn=(i,o)=>{for(var l=[],u=0;u<i;u++)l.push(U[o+u*4>>2]);return l};function Ai(i,o){if(!(i instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof i} which is not a function`);var l=ar(i.name||"unknownFunctionName",function(){});l.prototype=i.prototype;var u=new l,p=i.apply(u,o);return p instanceof Object?p:u}function Kn(i,o,l,u,p,v){var E=o.length;E<2&&ve("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var R=o[1]!==null&&l!==null,O=!1,P=1;P<o.length;++P)if(o[P]!==null&&o[P].destructorFunction===void 0){O=!0;break}for(var j=o[0].name!=="void",Y="",q="",P=0;P<E-2;++P)Y+=(P!==0?", ":"")+"arg"+P,q+=(P!==0?", ":"")+"arg"+P+"Wired";var X=`
        return function (${Y}) {
        if (arguments.length !== ${E-2}) {
          throwBindingError('function ${i} called with ' + arguments.length + ' arguments, expected ${E-2}');
        }`;O&&(X+=`var destructors = [];
`);var Z=O?"destructors":"null",he=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],ge=[ve,u,p,Vn,o[0],o[1]];R&&(X+="var thisWired = classParam.toWireType("+Z+`, this);
`);for(var P=0;P<E-2;++P)X+="var arg"+P+"Wired = argType"+P+".toWireType("+Z+", arg"+P+"); // "+o[P+2].name+`
`,he.push("argType"+P),ge.push(o[P+2]);if(R&&(q="thisWired"+(q.length>0?", ":"")+q),X+=(j||v?"var rv = ":"")+"invoker(fn"+(q.length>0?", ":"")+q+`);
`,O)X+=`runDestructors(destructors);
`;else for(var P=R?1:2;P<o.length;++P){var S=P===1?"thisWired":"arg"+(P-2)+"Wired";o[P].destructorFunction!==null&&(X+=S+"_dtor("+S+"); // "+o[P].name+`
`,he.push(S+"_dtor"),ge.push(o[P].destructorFunction))}j&&(X+=`var ret = retType.fromWireType(rv);
return ret;
`),X+=`}
`,he.push(X);var I=Ai(Function,he).apply(null,ge);return ar(i,I)}var Jl=(i,o,l,u,p,v)=>{var E=Yn(o,l);p=lt(u,p),Ot([],[i],function(R){R=R[0];var O=`constructor ${R.name}`;if(R.registeredClass.constructor_body===void 0&&(R.registeredClass.constructor_body=[]),R.registeredClass.constructor_body[o-1]!==void 0)throw new ir(`Cannot register multiple constructors with identical number of parameters (${o-1}) for class '${R.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return R.registeredClass.constructor_body[o-1]=()=>{sn(`Cannot construct ${R.name} due to unbound types`,E)},Ot([],E,P=>(P.splice(1,0,null),R.registeredClass.constructor_body[o-1]=Kn(O,P,null,p,v),[])),[]})},Ii=i=>{i=i.trim();const o=i.indexOf("(");return o!==-1?i.substr(0,o):i},Zl=(i,o,l,u,p,v,E,R,O)=>{var P=Yn(l,u);o=je(o),o=Ii(o),v=lt(p,v),Ot([],[i],function(j){j=j[0];var Y=`${j.name}.${o}`;o.startsWith("@@")&&(o=Symbol[o.substring(2)]),R&&j.registeredClass.pureVirtualFunctions.push(o);function q(){sn(`Cannot call ${Y} due to unbound types`,P)}var X=j.registeredClass.instancePrototype,Z=X[o];return Z===void 0||Z.overloadTable===void 0&&Z.className!==j.name&&Z.argCount===l-2?(q.argCount=l-2,q.className=j.name,X[o]=q):(wi(X,o,Y),X[o].overloadTable[l-2]=q),Ot([],P,function(he){var ge=Kn(Y,he,j,v,E,O);return X[o].overloadTable===void 0?(ge.argCount=l-2,X[o]=ge):X[o].overloadTable[l-2]=ge,[]}),[]})};function Ql(){Object.assign(Si.prototype,{get(i){return this.allocated[i]},has(i){return this.allocated[i]!==void 0},allocate(i){var o=this.freelist.pop()||this.allocated.length;return this.allocated[o]=i,o},free(i){this.allocated[i]=void 0,this.freelist.push(i)}})}function Si(){this.allocated=[void 0],this.freelist=[]}var nt=new Si,Jn=i=>{i>=nt.reserved&&--nt.get(i).refcount===0&&nt.free(i)},ef=()=>{for(var i=0,o=nt.reserved;o<nt.allocated.length;++o)nt.allocated[o]!==void 0&&++i;return i},tf=()=>{nt.allocated.push({value:void 0},{value:null},{value:!0},{value:!1}),nt.reserved=nt.allocated.length,r.count_emval_handles=ef},Be={toValue:i=>(i||ve("Cannot use deleted val. handle = "+i),nt.get(i).value),toHandle:i=>{switch(i){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return nt.allocate({refcount:1,value:i})}}},rf=(i,o)=>{o=je(o),pt(i,{name:o,fromWireType:l=>{var u=Be.toValue(l);return Jn(l),u},toWireType:(l,u)=>Be.toHandle(u),argPackAdvance:gt,readValueFromPointer:zn,destructorFunction:null})},nf=(i,o,l)=>{switch(o){case 1:return l?function(u){return this.fromWireType(k[u>>0])}:function(u){return this.fromWireType(G[u>>0])};case 2:return l?function(u){return this.fromWireType(H[u>>1])}:function(u){return this.fromWireType(K[u>>1])};case 4:return l?function(u){return this.fromWireType(L[u>>2])}:function(u){return this.fromWireType(U[u>>2])};default:throw new TypeError(`invalid integer width (${o}): ${i}`)}},sf=(i,o,l,u)=>{o=je(o);function p(){}p.values={},pt(i,{name:o,constructor:p,fromWireType:function(v){return this.constructor.values[v]},toWireType:(v,E)=>E.value,argPackAdvance:gt,readValueFromPointer:nf(o,l,u),destructorFunction:null}),Wn(o,p)},an=(i,o)=>{var l=Ft[i];return l===void 0&&ve(o+" has unknown type "+bi(i)),l},af=(i,o,l)=>{var u=an(i,"enum");o=je(o);var p=u.constructor,v=Object.create(u.constructor.prototype,{value:{value:l},constructor:{value:ar(`${u.name}_${o}`,function(){})}});p.values[l]=v,p[o]=v},Zn=i=>{if(i===null)return"null";var o=typeof i;return o==="object"||o==="array"||o==="function"?i.toString():""+i},of=(i,o)=>{switch(o){case 4:return function(l){return this.fromWireType(ee[l>>2])};case 8:return function(l){return this.fromWireType(fe[l>>3])};default:throw new TypeError(`invalid float width (${o}): ${i}`)}},cf=(i,o,l)=>{o=je(o),pt(i,{name:o,fromWireType:u=>u,toWireType:(u,p)=>p,argPackAdvance:gt,readValueFromPointer:of(o,l),destructorFunction:null})},lf=(i,o,l,u,p,v,E)=>{var R=Yn(o,l);i=je(i),i=Ii(i),p=lt(u,p),Wn(i,function(){sn(`Cannot call ${i} due to unbound types`,R)},o-1),Ot([],R,function(O){var P=[O[0],null].concat(O.slice(1));return _i(i,Kn(i,P,null,p,v,E),o-1),[]})},ff=(i,o,l)=>{switch(o){case 1:return l?u=>k[u>>0]:u=>G[u>>0];case 2:return l?u=>H[u>>1]:u=>K[u>>1];case 4:return l?u=>L[u>>2]:u=>U[u>>2];default:throw new TypeError(`invalid integer width (${o}): ${i}`)}},uf=(i,o,l,u,p)=>{o=je(o);var v=j=>j;if(u===0){var E=32-8*l;v=j=>j<<E>>>E}var R=o.includes("unsigned"),O=(j,Y)=>{},P;R?P=function(j,Y){return O(Y,this.name),Y>>>0}:P=function(j,Y){return O(Y,this.name),Y},pt(i,{name:o,fromWireType:v,toWireType:P,argPackAdvance:gt,readValueFromPointer:ff(o,l,u!==0),destructorFunction:null})},hf=(i,o,l)=>{var u=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],p=u[o];function v(E){var R=U[E>>2],O=U[E+4>>2];return new p(k.buffer,O,R)}l=je(l),pt(i,{name:l,fromWireType:v,argPackAdvance:gt,readValueFromPointer:v},{ignoreDuplicateRegistrations:!0})},Qn=(i,o,l,u)=>{if(!(u>0))return 0;for(var p=l,v=l+u-1,E=0;E<i.length;++E){var R=i.charCodeAt(E);if(R>=55296&&R<=57343){var O=i.charCodeAt(++E);R=65536+((R&1023)<<10)|O&1023}if(R<=127){if(l>=v)break;o[l++]=R}else if(R<=2047){if(l+1>=v)break;o[l++]=192|R>>6,o[l++]=128|R&63}else if(R<=65535){if(l+2>=v)break;o[l++]=224|R>>12,o[l++]=128|R>>6&63,o[l++]=128|R&63}else{if(l+3>=v)break;o[l++]=240|R>>18,o[l++]=128|R>>12&63,o[l++]=128|R>>6&63,o[l++]=128|R&63}}return o[l]=0,l-p},df=(i,o,l)=>Qn(i,G,o,l),es=i=>{for(var o=0,l=0;l<i.length;++l){var u=i.charCodeAt(l);u<=127?o++:u<=2047?o+=2:u>=55296&&u<=57343?(o+=4,++l):o+=3}return o},Ci=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,or=(i,o,l)=>{for(var u=o+l,p=o;i[p]&&!(p>=u);)++p;if(p-o>16&&i.buffer&&Ci)return Ci.decode(i.subarray(o,p));for(var v="";o<p;){var E=i[o++];if(!(E&128)){v+=String.fromCharCode(E);continue}var R=i[o++]&63;if((E&224)==192){v+=String.fromCharCode((E&31)<<6|R);continue}var O=i[o++]&63;if((E&240)==224?E=(E&15)<<12|R<<6|O:E=(E&7)<<18|R<<12|O<<6|i[o++]&63,E<65536)v+=String.fromCharCode(E);else{var P=E-65536;v+=String.fromCharCode(55296|P>>10,56320|P&1023)}}return v},on=(i,o)=>i?or(G,i,o):"",pf=(i,o)=>{o=je(o);var l=o==="std::string";pt(i,{name:o,fromWireType(u){var p=U[u>>2],v=u+4,E;if(l)for(var R=v,O=0;O<=p;++O){var P=v+O;if(O==p||G[P]==0){var j=P-R,Y=on(R,j);E===void 0?E=Y:(E+=String.fromCharCode(0),E+=Y),R=P+1}}else{for(var q=new Array(p),O=0;O<p;++O)q[O]=String.fromCharCode(G[v+O]);E=q.join("")}return Mt(u),E},toWireType(u,p){p instanceof ArrayBuffer&&(p=new Uint8Array(p));var v,E=typeof p=="string";E||p instanceof Uint8Array||p instanceof Uint8ClampedArray||p instanceof Int8Array||ve("Cannot pass non-string to std::string"),l&&E?v=es(p):v=p.length;var R=os(4+v+1),O=R+4;if(U[R>>2]=v,l&&E)df(p,O,v+1);else if(E)for(var P=0;P<v;++P){var j=p.charCodeAt(P);j>255&&(Mt(O),ve("String has UTF-16 code units that do not fit in 8 bits")),G[O+P]=j}else for(var P=0;P<v;++P)G[O+P]=p[P];return u!==null&&u.push(Mt,R),R},argPackAdvance:gt,readValueFromPointer:Mi,destructorFunction(u){Mt(u)}})},Ni=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,gf=(i,o)=>{for(var l=i,u=l>>1,p=u+o/2;!(u>=p)&&K[u];)++u;if(l=u<<1,l-i>32&&Ni)return Ni.decode(G.subarray(i,l));for(var v="",E=0;!(E>=o/2);++E){var R=H[i+E*2>>1];if(R==0)break;v+=String.fromCharCode(R)}return v},mf=(i,o,l)=>{if(l===void 0&&(l=2147483647),l<2)return 0;l-=2;for(var u=o,p=l<i.length*2?l/2:i.length,v=0;v<p;++v){var E=i.charCodeAt(v);H[o>>1]=E,o+=2}return H[o>>1]=0,o-u},vf=i=>i.length*2,yf=(i,o)=>{for(var l=0,u="";!(l>=o/4);){var p=L[i+l*4>>2];if(p==0)break;if(++l,p>=65536){var v=p-65536;u+=String.fromCharCode(55296|v>>10,56320|v&1023)}else u+=String.fromCharCode(p)}return u},xf=(i,o,l)=>{if(l===void 0&&(l=2147483647),l<4)return 0;for(var u=o,p=u+l-4,v=0;v<i.length;++v){var E=i.charCodeAt(v);if(E>=55296&&E<=57343){var R=i.charCodeAt(++v);E=65536+((E&1023)<<10)|R&1023}if(L[o>>2]=E,o+=4,o+4>p)break}return L[o>>2]=0,o-u},Tf=i=>{for(var o=0,l=0;l<i.length;++l){var u=i.charCodeAt(l);u>=55296&&u<=57343&&++l,o+=4}return o},Ef=(i,o,l)=>{l=je(l);var u,p,v,E,R;o===2?(u=gf,p=mf,E=vf,v=()=>K,R=1):o===4&&(u=yf,p=xf,E=Tf,v=()=>U,R=2),pt(i,{name:l,fromWireType:O=>{for(var P=U[O>>2],j=v(),Y,q=O+4,X=0;X<=P;++X){var Z=O+4+X*o;if(X==P||j[Z>>R]==0){var he=Z-q,ge=u(q,he);Y===void 0?Y=ge:(Y+=String.fromCharCode(0),Y+=ge),q=Z+o}}return Mt(O),Y},toWireType:(O,P)=>{typeof P!="string"&&ve(`Cannot pass non-string to C++ string type ${l}`);var j=E(P),Y=os(4+j+o);return U[Y>>2]=j>>R,p(P,Y+4,j+o),O!==null&&O.push(Mt,Y),Y},argPackAdvance:gt,readValueFromPointer:zn,destructorFunction(O){Mt(O)}})},wf=(i,o,l,u,p,v)=>{Zr[i]={name:je(o),rawConstructor:lt(l,u),rawDestructor:lt(p,v),fields:[]}},Mf=(i,o,l,u,p,v,E,R,O,P)=>{Zr[i].fields.push({fieldName:je(o),getterReturnType:l,getter:lt(u,p),getterContext:v,setterArgumentType:E,setter:lt(R,O),setterContext:P})},_f=(i,o)=>{o=je(o),pt(i,{isVoid:!0,name:o,argPackAdvance:0,fromWireType:()=>{},toWireType:(l,u)=>{}})},Fi=(i,o,l)=>{var u=[],p=i.toWireType(u,l);return u.length&&(U[o>>2]=Be.toHandle(u)),p},Rf=(i,o,l)=>(i=Be.toValue(i),o=an(o,"emval::as"),Fi(o,l,i)),bf={},Oi=i=>{var o=bf[i];return o===void 0?je(i):o},ts=[],Af=(i,o,l,u,p)=>(i=ts[i],o=Be.toValue(o),l=Oi(l),i(o,o[l],u,p)),If=(i,o)=>(i=Be.toValue(i),o=Be.toValue(o),i==o),Sf=i=>{var o=ts.length;return ts.push(i),o},Cf=(i,o)=>{for(var l=new Array(i),u=0;u<i;++u)l[u]=an(U[o+u*4>>2],"parameter "+u);return l},Nf=(i,o,l)=>{var u=Cf(i,o),p=u.shift();i--;var v=`return function (obj, func, destructorsRef, args) {
`,E=0,R=[];l===0&&R.push("obj");for(var O=["retType"],P=[p],j=0;j<i;++j)R.push("arg"+j),O.push("argType"+j),P.push(u[j]),v+=`  var arg${j} = argType${j}.readValueFromPointer(args${E?"+"+E:""});
`,E+=u[j].argPackAdvance;var Y=l===1?"new func":"func.call";v+=`  var rv = ${Y}(${R.join(", ")});
`;for(var j=0;j<i;++j)u[j].deleteObject&&(v+=`  argType${j}.deleteObject(arg${j});
`);p.isVoid||(O.push("emval_returnValue"),P.push(Fi),v+=`  return emval_returnValue(retType, destructorsRef, rv);
`),v+=`};
`,O.push(v);var q=Ai(Function,O).apply(null,P),X=`methodCaller<(${u.map(Z=>Z.name).join(", ")}) => ${p.name}>`;return Sf(ar(X,q))},Ff=(i,o)=>(i=Be.toValue(i),o=Be.toValue(o),Be.toHandle(i[o])),Of=i=>{i>4&&(nt.get(i).refcount+=1)},Df=i=>Be.toHandle(Oi(i)),$f=()=>Be.toHandle({}),Pf=i=>{var o=Be.toValue(i);Vn(o),Jn(i)},kf=(i,o,l)=>{i=Be.toValue(i),o=Be.toValue(o),l=Be.toValue(l),i[o]=l},Uf=(i,o)=>{i=an(i,"_emval_take_value");var l=i.readValueFromPointer(o);return Be.toHandle(l)},Lf=()=>{qe("")},jf=(i,o,l)=>G.copyWithin(i,o,o+l),Bf=()=>2147483648,Vf=i=>{var o=$.buffer,l=(i-o.byteLength+65535)/65536;try{return $.grow(l),re(),1}catch{}},zf=i=>{var o=G.length;i>>>=0;var l=Bf();if(i>l)return!1;for(var u=(O,P)=>O+(P-O%P)%P,p=1;p<=4;p*=2){var v=o*(1+.2/p);v=Math.min(v,i+100663296);var E=Math.min(l,u(Math.max(i,v),65536)),R=Vf(E);if(R)return!0}return!1},rs={},Gf=()=>f||"./this.program",Rr=()=>{if(!Rr.strings){var i=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",o={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:i,_:Gf()};for(var l in rs)rs[l]===void 0?delete o[l]:o[l]=rs[l];var u=[];for(var l in o)u.push(`${l}=${o[l]}`);Rr.strings=u}return Rr.strings},Hf=(i,o)=>{for(var l=0;l<i.length;++l)k[o++>>0]=i.charCodeAt(l);k[o>>0]=0},Ee={isAbs:i=>i.charAt(0)==="/",splitPath:i=>{var o=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return o.exec(i).slice(1)},normalizeArray:(i,o)=>{for(var l=0,u=i.length-1;u>=0;u--){var p=i[u];p==="."?i.splice(u,1):p===".."?(i.splice(u,1),l++):l&&(i.splice(u,1),l--)}if(o)for(;l;l--)i.unshift("..");return i},normalize:i=>{var o=Ee.isAbs(i),l=i.substr(-1)==="/";return i=Ee.normalizeArray(i.split("/").filter(u=>!!u),!o).join("/"),!i&&!o&&(i="."),i&&l&&(i+="/"),(o?"/":"")+i},dirname:i=>{var o=Ee.splitPath(i),l=o[0],u=o[1];return!l&&!u?".":(u&&(u=u.substr(0,u.length-1)),l+u)},basename:i=>{if(i==="/")return"/";i=Ee.normalize(i),i=i.replace(/\/$/,"");var o=i.lastIndexOf("/");return o===-1?i:i.substr(o+1)},join:function(){var i=Array.prototype.slice.call(arguments);return Ee.normalize(i.join("/"))},join2:(i,o)=>Ee.normalize(i+"/"+o)},qf=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return u=>crypto.getRandomValues(u);if(g)try{var i=m("crypto"),o=i.randomFillSync;if(o)return u=>i.randomFillSync(u);var l=i.randomBytes;return u=>(u.set(l(u.byteLength)),u)}catch{}qe("initRandomDevice")},Di=i=>(Di=qf())(i),wt={resolve:function(){for(var i="",o=!1,l=arguments.length-1;l>=-1&&!o;l--){var u=l>=0?arguments[l]:y.cwd();if(typeof u!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!u)return"";i=u+"/"+i,o=Ee.isAbs(u)}return i=Ee.normalizeArray(i.split("/").filter(p=>!!p),!o).join("/"),(o?"/":"")+i||"."},relative:(i,o)=>{i=wt.resolve(i).substr(1),o=wt.resolve(o).substr(1);function l(P){for(var j=0;j<P.length&&P[j]==="";j++);for(var Y=P.length-1;Y>=0&&P[Y]==="";Y--);return j>Y?[]:P.slice(j,Y-j+1)}for(var u=l(i.split("/")),p=l(o.split("/")),v=Math.min(u.length,p.length),E=v,R=0;R<v;R++)if(u[R]!==p[R]){E=R;break}for(var O=[],R=E;R<u.length;R++)O.push("..");return O=O.concat(p.slice(E)),O.join("/")}},ns=[];function cn(i,o,l){var u=l>0?l:es(i)+1,p=new Array(u),v=Qn(i,p,0,p.length);return o&&(p.length=v),p}var Wf=()=>{if(!ns.length){var i=null;if(g){var o=256,l=Buffer.alloc(o),u=0,p=process.stdin.fd;try{u=C.readSync(p,l)}catch(v){if(v.toString().includes("EOF"))u=0;else throw v}u>0?i=l.slice(0,u).toString("utf-8"):i=null}else typeof window<"u"&&typeof window.prompt=="function"?(i=window.prompt("Input: "),i!==null&&(i+=`
`)):typeof readline=="function"&&(i=readline(),i!==null&&(i+=`
`));if(!i)return null;ns=cn(i,!0)}return ns.shift()},$t={ttys:[],init(){},shutdown(){},register(i,o){$t.ttys[i]={input:[],output:[],ops:o},y.registerDevice(i,$t.stream_ops)},stream_ops:{open(i){var o=$t.ttys[i.node.rdev];if(!o)throw new y.ErrnoError(43);i.tty=o,i.seekable=!1},close(i){i.tty.ops.fsync(i.tty)},fsync(i){i.tty.ops.fsync(i.tty)},read(i,o,l,u,p){if(!i.tty||!i.tty.ops.get_char)throw new y.ErrnoError(60);for(var v=0,E=0;E<u;E++){var R;try{R=i.tty.ops.get_char(i.tty)}catch{throw new y.ErrnoError(29)}if(R===void 0&&v===0)throw new y.ErrnoError(6);if(R==null)break;v++,o[l+E]=R}return v&&(i.node.timestamp=Date.now()),v},write(i,o,l,u,p){if(!i.tty||!i.tty.ops.put_char)throw new y.ErrnoError(60);try{for(var v=0;v<u;v++)i.tty.ops.put_char(i.tty,o[l+v])}catch{throw new y.ErrnoError(29)}return u&&(i.node.timestamp=Date.now()),v}},default_tty_ops:{get_char(i){return Wf()},put_char(i,o){o===null||o===10?(_(or(i.output,0)),i.output=[]):o!=0&&i.output.push(o)},fsync(i){i.output&&i.output.length>0&&(_(or(i.output,0)),i.output=[])},ioctl_tcgets(i){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(i,o,l){return 0},ioctl_tiocgwinsz(i){return[24,80]}},default_tty1_ops:{put_char(i,o){o===null||o===10?(b(or(i.output,0)),i.output=[]):o!=0&&i.output.push(o)},fsync(i){i.output&&i.output.length>0&&(b(or(i.output,0)),i.output=[])}}},$i=i=>{qe()},oe={ops_table:null,mount(i){return oe.createNode(null,"/",16895,0)},createNode(i,o,l,u){if(y.isBlkdev(l)||y.isFIFO(l))throw new y.ErrnoError(63);oe.ops_table||(oe.ops_table={dir:{node:{getattr:oe.node_ops.getattr,setattr:oe.node_ops.setattr,lookup:oe.node_ops.lookup,mknod:oe.node_ops.mknod,rename:oe.node_ops.rename,unlink:oe.node_ops.unlink,rmdir:oe.node_ops.rmdir,readdir:oe.node_ops.readdir,symlink:oe.node_ops.symlink},stream:{llseek:oe.stream_ops.llseek}},file:{node:{getattr:oe.node_ops.getattr,setattr:oe.node_ops.setattr},stream:{llseek:oe.stream_ops.llseek,read:oe.stream_ops.read,write:oe.stream_ops.write,allocate:oe.stream_ops.allocate,mmap:oe.stream_ops.mmap,msync:oe.stream_ops.msync}},link:{node:{getattr:oe.node_ops.getattr,setattr:oe.node_ops.setattr,readlink:oe.node_ops.readlink},stream:{}},chrdev:{node:{getattr:oe.node_ops.getattr,setattr:oe.node_ops.setattr},stream:y.chrdev_stream_ops}});var p=y.createNode(i,o,l,u);return y.isDir(p.mode)?(p.node_ops=oe.ops_table.dir.node,p.stream_ops=oe.ops_table.dir.stream,p.contents={}):y.isFile(p.mode)?(p.node_ops=oe.ops_table.file.node,p.stream_ops=oe.ops_table.file.stream,p.usedBytes=0,p.contents=null):y.isLink(p.mode)?(p.node_ops=oe.ops_table.link.node,p.stream_ops=oe.ops_table.link.stream):y.isChrdev(p.mode)&&(p.node_ops=oe.ops_table.chrdev.node,p.stream_ops=oe.ops_table.chrdev.stream),p.timestamp=Date.now(),i&&(i.contents[o]=p,i.timestamp=p.timestamp),p},getFileDataAsTypedArray(i){return i.contents?i.contents.subarray?i.contents.subarray(0,i.usedBytes):new Uint8Array(i.contents):new Uint8Array(0)},expandFileStorage(i,o){var l=i.contents?i.contents.length:0;if(!(l>=o)){var u=1024*1024;o=Math.max(o,l*(l<u?2:1.125)>>>0),l!=0&&(o=Math.max(o,256));var p=i.contents;i.contents=new Uint8Array(o),i.usedBytes>0&&i.contents.set(p.subarray(0,i.usedBytes),0)}},resizeFileStorage(i,o){if(i.usedBytes!=o)if(o==0)i.contents=null,i.usedBytes=0;else{var l=i.contents;i.contents=new Uint8Array(o),l&&i.contents.set(l.subarray(0,Math.min(o,i.usedBytes))),i.usedBytes=o}},node_ops:{getattr(i){var o={};return o.dev=y.isChrdev(i.mode)?i.id:1,o.ino=i.id,o.mode=i.mode,o.nlink=1,o.uid=0,o.gid=0,o.rdev=i.rdev,y.isDir(i.mode)?o.size=4096:y.isFile(i.mode)?o.size=i.usedBytes:y.isLink(i.mode)?o.size=i.link.length:o.size=0,o.atime=new Date(i.timestamp),o.mtime=new Date(i.timestamp),o.ctime=new Date(i.timestamp),o.blksize=4096,o.blocks=Math.ceil(o.size/o.blksize),o},setattr(i,o){o.mode!==void 0&&(i.mode=o.mode),o.timestamp!==void 0&&(i.timestamp=o.timestamp),o.size!==void 0&&oe.resizeFileStorage(i,o.size)},lookup(i,o){throw y.genericErrors[44]},mknod(i,o,l,u){return oe.createNode(i,o,l,u)},rename(i,o,l){if(y.isDir(i.mode)){var u;try{u=y.lookupNode(o,l)}catch{}if(u)for(var p in u.contents)throw new y.ErrnoError(55)}delete i.parent.contents[i.name],i.parent.timestamp=Date.now(),i.name=l,o.contents[l]=i,o.timestamp=i.parent.timestamp,i.parent=o},unlink(i,o){delete i.contents[o],i.timestamp=Date.now()},rmdir(i,o){var l=y.lookupNode(i,o);for(var u in l.contents)throw new y.ErrnoError(55);delete i.contents[o],i.timestamp=Date.now()},readdir(i){var o=[".",".."];for(var l in i.contents)i.contents.hasOwnProperty(l)&&o.push(l);return o},symlink(i,o,l){var u=oe.createNode(i,o,41471,0);return u.link=l,u},readlink(i){if(!y.isLink(i.mode))throw new y.ErrnoError(28);return i.link}},stream_ops:{read(i,o,l,u,p){var v=i.node.contents;if(p>=i.node.usedBytes)return 0;var E=Math.min(i.node.usedBytes-p,u);if(E>8&&v.subarray)o.set(v.subarray(p,p+E),l);else for(var R=0;R<E;R++)o[l+R]=v[p+R];return E},write(i,o,l,u,p,v){if(o.buffer===k.buffer&&(v=!1),!u)return 0;var E=i.node;if(E.timestamp=Date.now(),o.subarray&&(!E.contents||E.contents.subarray)){if(v)return E.contents=o.subarray(l,l+u),E.usedBytes=u,u;if(E.usedBytes===0&&p===0)return E.contents=o.slice(l,l+u),E.usedBytes=u,u;if(p+u<=E.usedBytes)return E.contents.set(o.subarray(l,l+u),p),u}if(oe.expandFileStorage(E,p+u),E.contents.subarray&&o.subarray)E.contents.set(o.subarray(l,l+u),p);else for(var R=0;R<u;R++)E.contents[p+R]=o[l+R];return E.usedBytes=Math.max(E.usedBytes,p+u),u},llseek(i,o,l){var u=o;if(l===1?u+=i.position:l===2&&y.isFile(i.node.mode)&&(u+=i.node.usedBytes),u<0)throw new y.ErrnoError(28);return u},allocate(i,o,l){oe.expandFileStorage(i.node,o+l),i.node.usedBytes=Math.max(i.node.usedBytes,o+l)},mmap(i,o,l,u,p){if(!y.isFile(i.node.mode))throw new y.ErrnoError(43);var v,E,R=i.node.contents;if(!(p&2)&&R.buffer===k.buffer)E=!1,v=R.byteOffset;else{if((l>0||l+o<R.length)&&(R.subarray?R=R.subarray(l,l+o):R=Array.prototype.slice.call(R,l,l+o)),E=!0,v=$i(),!v)throw new y.ErrnoError(48);k.set(R,v)}return{ptr:v,allocated:E}},msync(i,o,l,u,p){return oe.stream_ops.write(i,o,0,u,l,!1),0}}},Xf=(i,o,l,u)=>{var p=u?"":`al ${i}`;A(i,v=>{B(v,`Loading data file "${i}" failed (no arrayBuffer).`),o(new Uint8Array(v)),p&&ze()},v=>{if(l)l();else throw`Loading data file "${i}" failed.`}),p&&dt()},Yf=(i,o,l,u,p,v)=>{y.createDataFile(i,o,l,u,p,v)},Kf=r.preloadPlugins||[],Jf=(i,o,l,u)=>{typeof Browser<"u"&&Browser.init();var p=!1;return Kf.forEach(v=>{p||v.canHandle(o)&&(v.handle(i,o,l,u),p=!0)}),p},Zf=(i,o,l,u,p,v,E,R,O,P)=>{var j=o?wt.resolve(Ee.join2(i,o)):i;function Y(q){function X(Z){P&&P(),R||Yf(i,o,Z,u,p,O),v&&v(),ze()}Jf(q,j,X,()=>{E&&E(),ze()})||X(q)}dt(),typeof l=="string"?Xf(l,q=>Y(q),E):Y(l)},Qf=i=>{var o={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},l=o[i];if(typeof l>"u")throw new Error(`Unknown file open mode: ${i}`);return l},ss=(i,o)=>{var l=0;return i&&(l|=365),o&&(l|=146),l},y={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath(i,o={}){if(i=wt.resolve(i),!i)return{path:"",node:null};var l={follow_mount:!0,recurse_count:0};if(o=Object.assign(l,o),o.recurse_count>8)throw new y.ErrnoError(32);for(var u=i.split("/").filter(Y=>!!Y),p=y.root,v="/",E=0;E<u.length;E++){var R=E===u.length-1;if(R&&o.parent)break;if(p=y.lookupNode(p,u[E]),v=Ee.join2(v,u[E]),y.isMountpoint(p)&&(!R||R&&o.follow_mount)&&(p=p.mounted.root),!R||o.follow)for(var O=0;y.isLink(p.mode);){var P=y.readlink(v);v=wt.resolve(Ee.dirname(v),P);var j=y.lookupPath(v,{recurse_count:o.recurse_count+1});if(p=j.node,O++>40)throw new y.ErrnoError(32)}}return{path:v,node:p}},getPath(i){for(var o;;){if(y.isRoot(i)){var l=i.mount.mountpoint;return o?l[l.length-1]!=="/"?`${l}/${o}`:l+o:l}o=o?`${i.name}/${o}`:i.name,i=i.parent}},hashName(i,o){for(var l=0,u=0;u<o.length;u++)l=(l<<5)-l+o.charCodeAt(u)|0;return(i+l>>>0)%y.nameTable.length},hashAddNode(i){var o=y.hashName(i.parent.id,i.name);i.name_next=y.nameTable[o],y.nameTable[o]=i},hashRemoveNode(i){var o=y.hashName(i.parent.id,i.name);if(y.nameTable[o]===i)y.nameTable[o]=i.name_next;else for(var l=y.nameTable[o];l;){if(l.name_next===i){l.name_next=i.name_next;break}l=l.name_next}},lookupNode(i,o){var l=y.mayLookup(i);if(l)throw new y.ErrnoError(l,i);for(var u=y.hashName(i.id,o),p=y.nameTable[u];p;p=p.name_next){var v=p.name;if(p.parent.id===i.id&&v===o)return p}return y.lookup(i,o)},createNode(i,o,l,u){var p=new y.FSNode(i,o,l,u);return y.hashAddNode(p),p},destroyNode(i){y.hashRemoveNode(i)},isRoot(i){return i===i.parent},isMountpoint(i){return!!i.mounted},isFile(i){return(i&61440)===32768},isDir(i){return(i&61440)===16384},isLink(i){return(i&61440)===40960},isChrdev(i){return(i&61440)===8192},isBlkdev(i){return(i&61440)===24576},isFIFO(i){return(i&61440)===4096},isSocket(i){return(i&49152)===49152},flagsToPermissionString(i){var o=["r","w","rw"][i&3];return i&512&&(o+="w"),o},nodePermissions(i,o){return y.ignorePermissions?0:o.includes("r")&&!(i.mode&292)||o.includes("w")&&!(i.mode&146)||o.includes("x")&&!(i.mode&73)?2:0},mayLookup(i){var o=y.nodePermissions(i,"x");return o||(i.node_ops.lookup?0:2)},mayCreate(i,o){try{var l=y.lookupNode(i,o);return 20}catch{}return y.nodePermissions(i,"wx")},mayDelete(i,o,l){var u;try{u=y.lookupNode(i,o)}catch(v){return v.errno}var p=y.nodePermissions(i,"wx");if(p)return p;if(l){if(!y.isDir(u.mode))return 54;if(y.isRoot(u)||y.getPath(u)===y.cwd())return 10}else if(y.isDir(u.mode))return 31;return 0},mayOpen(i,o){return i?y.isLink(i.mode)?32:y.isDir(i.mode)&&(y.flagsToPermissionString(o)!=="r"||o&512)?31:y.nodePermissions(i,y.flagsToPermissionString(o)):44},MAX_OPEN_FDS:4096,nextfd(){for(var i=0;i<=y.MAX_OPEN_FDS;i++)if(!y.streams[i])return i;throw new y.ErrnoError(33)},getStreamChecked(i){var o=y.getStream(i);if(!o)throw new y.ErrnoError(8);return o},getStream:i=>y.streams[i],createStream(i,o=-1){return y.FSStream||(y.FSStream=function(){this.shared={}},y.FSStream.prototype={},Object.defineProperties(y.FSStream.prototype,{object:{get(){return this.node},set(l){this.node=l}},isRead:{get(){return(this.flags&2097155)!==1}},isWrite:{get(){return(this.flags&2097155)!==0}},isAppend:{get(){return this.flags&1024}},flags:{get(){return this.shared.flags},set(l){this.shared.flags=l}},position:{get(){return this.shared.position},set(l){this.shared.position=l}}})),i=Object.assign(new y.FSStream,i),o==-1&&(o=y.nextfd()),i.fd=o,y.streams[o]=i,i},closeStream(i){y.streams[i]=null},chrdev_stream_ops:{open(i){var o=y.getDevice(i.node.rdev);i.stream_ops=o.stream_ops,i.stream_ops.open&&i.stream_ops.open(i)},llseek(){throw new y.ErrnoError(70)}},major:i=>i>>8,minor:i=>i&255,makedev:(i,o)=>i<<8|o,registerDevice(i,o){y.devices[i]={stream_ops:o}},getDevice:i=>y.devices[i],getMounts(i){for(var o=[],l=[i];l.length;){var u=l.pop();o.push(u),l.push.apply(l,u.mounts)}return o},syncfs(i,o){typeof i=="function"&&(o=i,i=!1),y.syncFSRequests++,y.syncFSRequests>1&&b(`warning: ${y.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var l=y.getMounts(y.root.mount),u=0;function p(E){return y.syncFSRequests--,o(E)}function v(E){if(E)return v.errored?void 0:(v.errored=!0,p(E));++u>=l.length&&p(null)}l.forEach(E=>{if(!E.type.syncfs)return v(null);E.type.syncfs(E,i,v)})},mount(i,o,l){var u=l==="/",p=!l,v;if(u&&y.root)throw new y.ErrnoError(10);if(!u&&!p){var E=y.lookupPath(l,{follow_mount:!1});if(l=E.path,v=E.node,y.isMountpoint(v))throw new y.ErrnoError(10);if(!y.isDir(v.mode))throw new y.ErrnoError(54)}var R={type:i,opts:o,mountpoint:l,mounts:[]},O=i.mount(R);return O.mount=R,R.root=O,u?y.root=O:v&&(v.mounted=R,v.mount&&v.mount.mounts.push(R)),O},unmount(i){var o=y.lookupPath(i,{follow_mount:!1});if(!y.isMountpoint(o.node))throw new y.ErrnoError(28);var l=o.node,u=l.mounted,p=y.getMounts(u);Object.keys(y.nameTable).forEach(E=>{for(var R=y.nameTable[E];R;){var O=R.name_next;p.includes(R.mount)&&y.destroyNode(R),R=O}}),l.mounted=null;var v=l.mount.mounts.indexOf(u);l.mount.mounts.splice(v,1)},lookup(i,o){return i.node_ops.lookup(i,o)},mknod(i,o,l){var u=y.lookupPath(i,{parent:!0}),p=u.node,v=Ee.basename(i);if(!v||v==="."||v==="..")throw new y.ErrnoError(28);var E=y.mayCreate(p,v);if(E)throw new y.ErrnoError(E);if(!p.node_ops.mknod)throw new y.ErrnoError(63);return p.node_ops.mknod(p,v,o,l)},create(i,o){return o=o!==void 0?o:438,o&=4095,o|=32768,y.mknod(i,o,0)},mkdir(i,o){return o=o!==void 0?o:511,o&=1023,o|=16384,y.mknod(i,o,0)},mkdirTree(i,o){for(var l=i.split("/"),u="",p=0;p<l.length;++p)if(l[p]){u+="/"+l[p];try{y.mkdir(u,o)}catch(v){if(v.errno!=20)throw v}}},mkdev(i,o,l){return typeof l>"u"&&(l=o,o=438),o|=8192,y.mknod(i,o,l)},symlink(i,o){if(!wt.resolve(i))throw new y.ErrnoError(44);var l=y.lookupPath(o,{parent:!0}),u=l.node;if(!u)throw new y.ErrnoError(44);var p=Ee.basename(o),v=y.mayCreate(u,p);if(v)throw new y.ErrnoError(v);if(!u.node_ops.symlink)throw new y.ErrnoError(63);return u.node_ops.symlink(u,p,i)},rename(i,o){var l=Ee.dirname(i),u=Ee.dirname(o),p=Ee.basename(i),v=Ee.basename(o),E,R,O;if(E=y.lookupPath(i,{parent:!0}),R=E.node,E=y.lookupPath(o,{parent:!0}),O=E.node,!R||!O)throw new y.ErrnoError(44);if(R.mount!==O.mount)throw new y.ErrnoError(75);var P=y.lookupNode(R,p),j=wt.relative(i,u);if(j.charAt(0)!==".")throw new y.ErrnoError(28);if(j=wt.relative(o,l),j.charAt(0)!==".")throw new y.ErrnoError(55);var Y;try{Y=y.lookupNode(O,v)}catch{}if(P!==Y){var q=y.isDir(P.mode),X=y.mayDelete(R,p,q);if(X)throw new y.ErrnoError(X);if(X=Y?y.mayDelete(O,v,q):y.mayCreate(O,v),X)throw new y.ErrnoError(X);if(!R.node_ops.rename)throw new y.ErrnoError(63);if(y.isMountpoint(P)||Y&&y.isMountpoint(Y))throw new y.ErrnoError(10);if(O!==R&&(X=y.nodePermissions(R,"w"),X))throw new y.ErrnoError(X);y.hashRemoveNode(P);try{R.node_ops.rename(P,O,v)}catch(Z){throw Z}finally{y.hashAddNode(P)}}},rmdir(i){var o=y.lookupPath(i,{parent:!0}),l=o.node,u=Ee.basename(i),p=y.lookupNode(l,u),v=y.mayDelete(l,u,!0);if(v)throw new y.ErrnoError(v);if(!l.node_ops.rmdir)throw new y.ErrnoError(63);if(y.isMountpoint(p))throw new y.ErrnoError(10);l.node_ops.rmdir(l,u),y.destroyNode(p)},readdir(i){var o=y.lookupPath(i,{follow:!0}),l=o.node;if(!l.node_ops.readdir)throw new y.ErrnoError(54);return l.node_ops.readdir(l)},unlink(i){var o=y.lookupPath(i,{parent:!0}),l=o.node;if(!l)throw new y.ErrnoError(44);var u=Ee.basename(i),p=y.lookupNode(l,u),v=y.mayDelete(l,u,!1);if(v)throw new y.ErrnoError(v);if(!l.node_ops.unlink)throw new y.ErrnoError(63);if(y.isMountpoint(p))throw new y.ErrnoError(10);l.node_ops.unlink(l,u),y.destroyNode(p)},readlink(i){var o=y.lookupPath(i),l=o.node;if(!l)throw new y.ErrnoError(44);if(!l.node_ops.readlink)throw new y.ErrnoError(28);return wt.resolve(y.getPath(l.parent),l.node_ops.readlink(l))},stat(i,o){var l=y.lookupPath(i,{follow:!o}),u=l.node;if(!u)throw new y.ErrnoError(44);if(!u.node_ops.getattr)throw new y.ErrnoError(63);return u.node_ops.getattr(u)},lstat(i){return y.stat(i,!0)},chmod(i,o,l){var u;if(typeof i=="string"){var p=y.lookupPath(i,{follow:!l});u=p.node}else u=i;if(!u.node_ops.setattr)throw new y.ErrnoError(63);u.node_ops.setattr(u,{mode:o&4095|u.mode&-4096,timestamp:Date.now()})},lchmod(i,o){y.chmod(i,o,!0)},fchmod(i,o){var l=y.getStreamChecked(i);y.chmod(l.node,o)},chown(i,o,l,u){var p;if(typeof i=="string"){var v=y.lookupPath(i,{follow:!u});p=v.node}else p=i;if(!p.node_ops.setattr)throw new y.ErrnoError(63);p.node_ops.setattr(p,{timestamp:Date.now()})},lchown(i,o,l){y.chown(i,o,l,!0)},fchown(i,o,l){var u=y.getStreamChecked(i);y.chown(u.node,o,l)},truncate(i,o){if(o<0)throw new y.ErrnoError(28);var l;if(typeof i=="string"){var u=y.lookupPath(i,{follow:!0});l=u.node}else l=i;if(!l.node_ops.setattr)throw new y.ErrnoError(63);if(y.isDir(l.mode))throw new y.ErrnoError(31);if(!y.isFile(l.mode))throw new y.ErrnoError(28);var p=y.nodePermissions(l,"w");if(p)throw new y.ErrnoError(p);l.node_ops.setattr(l,{size:o,timestamp:Date.now()})},ftruncate(i,o){var l=y.getStreamChecked(i);if(!(l.flags&2097155))throw new y.ErrnoError(28);y.truncate(l.node,o)},utime(i,o,l){var u=y.lookupPath(i,{follow:!0}),p=u.node;p.node_ops.setattr(p,{timestamp:Math.max(o,l)})},open(i,o,l){if(i==="")throw new y.ErrnoError(44);o=typeof o=="string"?Qf(o):o,l=typeof l>"u"?438:l,o&64?l=l&4095|32768:l=0;var u;if(typeof i=="object")u=i;else{i=Ee.normalize(i);try{var p=y.lookupPath(i,{follow:!(o&131072)});u=p.node}catch{}}var v=!1;if(o&64)if(u){if(o&128)throw new y.ErrnoError(20)}else u=y.mknod(i,l,0),v=!0;if(!u)throw new y.ErrnoError(44);if(y.isChrdev(u.mode)&&(o&=-513),o&65536&&!y.isDir(u.mode))throw new y.ErrnoError(54);if(!v){var E=y.mayOpen(u,o);if(E)throw new y.ErrnoError(E)}o&512&&!v&&y.truncate(u,0),o&=-131713;var R=y.createStream({node:u,path:y.getPath(u),flags:o,seekable:!0,position:0,stream_ops:u.stream_ops,ungotten:[],error:!1});return R.stream_ops.open&&R.stream_ops.open(R),r.logReadFiles&&!(o&1)&&(y.readFiles||(y.readFiles={}),i in y.readFiles||(y.readFiles[i]=1)),R},close(i){if(y.isClosed(i))throw new y.ErrnoError(8);i.getdents&&(i.getdents=null);try{i.stream_ops.close&&i.stream_ops.close(i)}catch(o){throw o}finally{y.closeStream(i.fd)}i.fd=null},isClosed(i){return i.fd===null},llseek(i,o,l){if(y.isClosed(i))throw new y.ErrnoError(8);if(!i.seekable||!i.stream_ops.llseek)throw new y.ErrnoError(70);if(l!=0&&l!=1&&l!=2)throw new y.ErrnoError(28);return i.position=i.stream_ops.llseek(i,o,l),i.ungotten=[],i.position},read(i,o,l,u,p){if(u<0||p<0)throw new y.ErrnoError(28);if(y.isClosed(i))throw new y.ErrnoError(8);if((i.flags&2097155)===1)throw new y.ErrnoError(8);if(y.isDir(i.node.mode))throw new y.ErrnoError(31);if(!i.stream_ops.read)throw new y.ErrnoError(28);var v=typeof p<"u";if(!v)p=i.position;else if(!i.seekable)throw new y.ErrnoError(70);var E=i.stream_ops.read(i,o,l,u,p);return v||(i.position+=E),E},write(i,o,l,u,p,v){if(u<0||p<0)throw new y.ErrnoError(28);if(y.isClosed(i))throw new y.ErrnoError(8);if(!(i.flags&2097155))throw new y.ErrnoError(8);if(y.isDir(i.node.mode))throw new y.ErrnoError(31);if(!i.stream_ops.write)throw new y.ErrnoError(28);i.seekable&&i.flags&1024&&y.llseek(i,0,2);var E=typeof p<"u";if(!E)p=i.position;else if(!i.seekable)throw new y.ErrnoError(70);var R=i.stream_ops.write(i,o,l,u,p,v);return E||(i.position+=R),R},allocate(i,o,l){if(y.isClosed(i))throw new y.ErrnoError(8);if(o<0||l<=0)throw new y.ErrnoError(28);if(!(i.flags&2097155))throw new y.ErrnoError(8);if(!y.isFile(i.node.mode)&&!y.isDir(i.node.mode))throw new y.ErrnoError(43);if(!i.stream_ops.allocate)throw new y.ErrnoError(138);i.stream_ops.allocate(i,o,l)},mmap(i,o,l,u,p){if(u&2&&!(p&2)&&(i.flags&2097155)!==2)throw new y.ErrnoError(2);if((i.flags&2097155)===1)throw new y.ErrnoError(2);if(!i.stream_ops.mmap)throw new y.ErrnoError(43);return i.stream_ops.mmap(i,o,l,u,p)},msync(i,o,l,u,p){return i.stream_ops.msync?i.stream_ops.msync(i,o,l,u,p):0},munmap:i=>0,ioctl(i,o,l){if(!i.stream_ops.ioctl)throw new y.ErrnoError(59);return i.stream_ops.ioctl(i,o,l)},readFile(i,o={}){if(o.flags=o.flags||0,o.encoding=o.encoding||"binary",o.encoding!=="utf8"&&o.encoding!=="binary")throw new Error(`Invalid encoding type "${o.encoding}"`);var l,u=y.open(i,o.flags),p=y.stat(i),v=p.size,E=new Uint8Array(v);return y.read(u,E,0,v,0),o.encoding==="utf8"?l=or(E,0):o.encoding==="binary"&&(l=E),y.close(u),l},writeFile(i,o,l={}){l.flags=l.flags||577;var u=y.open(i,l.flags,l.mode);if(typeof o=="string"){var p=new Uint8Array(es(o)+1),v=Qn(o,p,0,p.length);y.write(u,p,0,v,void 0,l.canOwn)}else if(ArrayBuffer.isView(o))y.write(u,o,0,o.byteLength,void 0,l.canOwn);else throw new Error("Unsupported data type");y.close(u)},cwd:()=>y.currentPath,chdir(i){var o=y.lookupPath(i,{follow:!0});if(o.node===null)throw new y.ErrnoError(44);if(!y.isDir(o.node.mode))throw new y.ErrnoError(54);var l=y.nodePermissions(o.node,"x");if(l)throw new y.ErrnoError(l);y.currentPath=o.path},createDefaultDirectories(){y.mkdir("/tmp"),y.mkdir("/home"),y.mkdir("/home/web_user")},createDefaultDevices(){y.mkdir("/dev"),y.registerDevice(y.makedev(1,3),{read:()=>0,write:(u,p,v,E,R)=>E}),y.mkdev("/dev/null",y.makedev(1,3)),$t.register(y.makedev(5,0),$t.default_tty_ops),$t.register(y.makedev(6,0),$t.default_tty1_ops),y.mkdev("/dev/tty",y.makedev(5,0)),y.mkdev("/dev/tty1",y.makedev(6,0));var i=new Uint8Array(1024),o=0,l=()=>(o===0&&(o=Di(i).byteLength),i[--o]);y.createDevice("/dev","random",l),y.createDevice("/dev","urandom",l),y.mkdir("/dev/shm"),y.mkdir("/dev/shm/tmp")},createSpecialDirectories(){y.mkdir("/proc");var i=y.mkdir("/proc/self");y.mkdir("/proc/self/fd"),y.mount({mount(){var o=y.createNode(i,"fd",16895,73);return o.node_ops={lookup(l,u){var p=+u,v=y.getStreamChecked(p),E={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>v.path}};return E.parent=E,E}},o}},{},"/proc/self/fd")},createStandardStreams(){r.stdin?y.createDevice("/dev","stdin",r.stdin):y.symlink("/dev/tty","/dev/stdin"),r.stdout?y.createDevice("/dev","stdout",null,r.stdout):y.symlink("/dev/tty","/dev/stdout"),r.stderr?y.createDevice("/dev","stderr",null,r.stderr):y.symlink("/dev/tty1","/dev/stderr"),y.open("/dev/stdin",0),y.open("/dev/stdout",1),y.open("/dev/stderr",1)},ensureErrnoError(){y.ErrnoError||(y.ErrnoError=function(o,l){this.name="ErrnoError",this.node=l,this.setErrno=function(u){this.errno=u},this.setErrno(o),this.message="FS error"},y.ErrnoError.prototype=new Error,y.ErrnoError.prototype.constructor=y.ErrnoError,[44].forEach(i=>{y.genericErrors[i]=new y.ErrnoError(i),y.genericErrors[i].stack="<generic error, no stack>"}))},staticInit(){y.ensureErrnoError(),y.nameTable=new Array(4096),y.mount(oe,{},"/"),y.createDefaultDirectories(),y.createDefaultDevices(),y.createSpecialDirectories(),y.filesystems={MEMFS:oe}},init(i,o,l){y.init.initialized=!0,y.ensureErrnoError(),r.stdin=i||r.stdin,r.stdout=o||r.stdout,r.stderr=l||r.stderr,y.createStandardStreams()},quit(){y.init.initialized=!1;for(var i=0;i<y.streams.length;i++){var o=y.streams[i];o&&y.close(o)}},findObject(i,o){var l=y.analyzePath(i,o);return l.exists?l.object:null},analyzePath(i,o){try{var l=y.lookupPath(i,{follow:!o});i=l.path}catch{}var u={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var l=y.lookupPath(i,{parent:!0});u.parentExists=!0,u.parentPath=l.path,u.parentObject=l.node,u.name=Ee.basename(i),l=y.lookupPath(i,{follow:!o}),u.exists=!0,u.path=l.path,u.object=l.node,u.name=l.node.name,u.isRoot=l.path==="/"}catch(p){u.error=p.errno}return u},createPath(i,o,l,u){i=typeof i=="string"?i:y.getPath(i);for(var p=o.split("/").reverse();p.length;){var v=p.pop();if(v){var E=Ee.join2(i,v);try{y.mkdir(E)}catch{}i=E}}return E},createFile(i,o,l,u,p){var v=Ee.join2(typeof i=="string"?i:y.getPath(i),o),E=ss(u,p);return y.create(v,E)},createDataFile(i,o,l,u,p,v){var E=o;i&&(i=typeof i=="string"?i:y.getPath(i),E=o?Ee.join2(i,o):i);var R=ss(u,p),O=y.create(E,R);if(l){if(typeof l=="string"){for(var P=new Array(l.length),j=0,Y=l.length;j<Y;++j)P[j]=l.charCodeAt(j);l=P}y.chmod(O,R|146);var q=y.open(O,577);y.write(q,l,0,l.length,0,v),y.close(q),y.chmod(O,R)}},createDevice(i,o,l,u){var p=Ee.join2(typeof i=="string"?i:y.getPath(i),o),v=ss(!!l,!!u);y.createDevice.major||(y.createDevice.major=64);var E=y.makedev(y.createDevice.major++,0);return y.registerDevice(E,{open(R){R.seekable=!1},close(R){u&&u.buffer&&u.buffer.length&&u(10)},read(R,O,P,j,Y){for(var q=0,X=0;X<j;X++){var Z;try{Z=l()}catch{throw new y.ErrnoError(29)}if(Z===void 0&&q===0)throw new y.ErrnoError(6);if(Z==null)break;q++,O[P+X]=Z}return q&&(R.node.timestamp=Date.now()),q},write(R,O,P,j,Y){for(var q=0;q<j;q++)try{u(O[P+q])}catch{throw new y.ErrnoError(29)}return j&&(R.node.timestamp=Date.now()),q}}),y.mkdev(p,v,E)},forceLoadFile(i){if(i.isDevice||i.isFolder||i.link||i.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(M)try{i.contents=cn(M(i.url),!0),i.usedBytes=i.contents.length}catch{throw new y.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile(i,o,l,u,p){function v(){this.lengthKnown=!1,this.chunks=[]}if(v.prototype.get=function(X){if(!(X>this.length-1||X<0)){var Z=X%this.chunkSize,he=X/this.chunkSize|0;return this.getter(he)[Z]}},v.prototype.setDataGetter=function(X){this.getter=X},v.prototype.cacheLength=function(){var X=new XMLHttpRequest;if(X.open("HEAD",l,!1),X.send(null),!(X.status>=200&&X.status<300||X.status===304))throw new Error("Couldn't load "+l+". Status: "+X.status);var Z=Number(X.getResponseHeader("Content-length")),he,ge=(he=X.getResponseHeader("Accept-Ranges"))&&he==="bytes",S=(he=X.getResponseHeader("Content-Encoding"))&&he==="gzip",I=1024*1024;ge||(I=Z);var D=(J,pe)=>{if(J>pe)throw new Error("invalid range ("+J+", "+pe+") or no bytes requested!");if(pe>Z-1)throw new Error("only "+Z+" bytes available! programmer error!");var ue=new XMLHttpRequest;if(ue.open("GET",l,!1),Z!==I&&ue.setRequestHeader("Range","bytes="+J+"-"+pe),ue.responseType="arraybuffer",ue.overrideMimeType&&ue.overrideMimeType("text/plain; charset=x-user-defined"),ue.send(null),!(ue.status>=200&&ue.status<300||ue.status===304))throw new Error("Couldn't load "+l+". Status: "+ue.status);return ue.response!==void 0?new Uint8Array(ue.response||[]):cn(ue.responseText||"",!0)},V=this;V.setDataGetter(J=>{var pe=J*I,ue=(J+1)*I-1;if(ue=Math.min(ue,Z-1),typeof V.chunks[J]>"u"&&(V.chunks[J]=D(pe,ue)),typeof V.chunks[J]>"u")throw new Error("doXHR failed!");return V.chunks[J]}),(S||!Z)&&(I=Z=1,Z=this.getter(0).length,I=Z,_("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=Z,this._chunkSize=I,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!d)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var E=new v;Object.defineProperties(E,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var R={isDevice:!1,contents:E}}else var R={isDevice:!1,url:l};var O=y.createFile(i,o,R,u,p);R.contents?O.contents=R.contents:R.url&&(O.contents=null,O.url=R.url),Object.defineProperties(O,{usedBytes:{get:function(){return this.contents.length}}});var P={},j=Object.keys(O.stream_ops);j.forEach(q=>{var X=O.stream_ops[q];P[q]=function(){return y.forceLoadFile(O),X.apply(null,arguments)}});function Y(q,X,Z,he,ge){var S=q.node.contents;if(ge>=S.length)return 0;var I=Math.min(S.length-ge,he);if(S.slice)for(var D=0;D<I;D++)X[Z+D]=S[ge+D];else for(var D=0;D<I;D++)X[Z+D]=S.get(ge+D);return I}return P.read=(q,X,Z,he,ge)=>(y.forceLoadFile(O),Y(q,X,Z,he,ge)),P.mmap=(q,X,Z,he,ge)=>{y.forceLoadFile(O);var S=$i();if(!S)throw new y.ErrnoError(48);return Y(q,k,S,X,Z),{ptr:S,allocated:!0}},O.stream_ops=P,O}},St={DEFAULT_POLLMASK:5,calculateAt(i,o,l){if(Ee.isAbs(o))return o;var u;if(i===-100)u=y.cwd();else{var p=St.getStreamFromFD(i);u=p.path}if(o.length==0){if(!l)throw new y.ErrnoError(44);return u}return Ee.join2(u,o)},doStat(i,o,l){try{var u=i(o)}catch(R){if(R&&R.node&&Ee.normalize(o)!==Ee.normalize(y.getPath(R.node)))return-54;throw R}L[l>>2]=u.dev,L[l+4>>2]=u.mode,U[l+8>>2]=u.nlink,L[l+12>>2]=u.uid,L[l+16>>2]=u.gid,L[l+20>>2]=u.rdev,Le=[u.size>>>0,(de=u.size,+Math.abs(de)>=1?de>0?+Math.floor(de/4294967296)>>>0:~~+Math.ceil((de-+(~~de>>>0))/4294967296)>>>0:0)],L[l+24>>2]=Le[0],L[l+28>>2]=Le[1],L[l+32>>2]=4096,L[l+36>>2]=u.blocks;var p=u.atime.getTime(),v=u.mtime.getTime(),E=u.ctime.getTime();return Le=[Math.floor(p/1e3)>>>0,(de=Math.floor(p/1e3),+Math.abs(de)>=1?de>0?+Math.floor(de/4294967296)>>>0:~~+Math.ceil((de-+(~~de>>>0))/4294967296)>>>0:0)],L[l+40>>2]=Le[0],L[l+44>>2]=Le[1],U[l+48>>2]=p%1e3*1e3,Le=[Math.floor(v/1e3)>>>0,(de=Math.floor(v/1e3),+Math.abs(de)>=1?de>0?+Math.floor(de/4294967296)>>>0:~~+Math.ceil((de-+(~~de>>>0))/4294967296)>>>0:0)],L[l+56>>2]=Le[0],L[l+60>>2]=Le[1],U[l+64>>2]=v%1e3*1e3,Le=[Math.floor(E/1e3)>>>0,(de=Math.floor(E/1e3),+Math.abs(de)>=1?de>0?+Math.floor(de/4294967296)>>>0:~~+Math.ceil((de-+(~~de>>>0))/4294967296)>>>0:0)],L[l+72>>2]=Le[0],L[l+76>>2]=Le[1],U[l+80>>2]=E%1e3*1e3,Le=[u.ino>>>0,(de=u.ino,+Math.abs(de)>=1?de>0?+Math.floor(de/4294967296)>>>0:~~+Math.ceil((de-+(~~de>>>0))/4294967296)>>>0:0)],L[l+88>>2]=Le[0],L[l+92>>2]=Le[1],0},doMsync(i,o,l,u,p){if(!y.isFile(o.node.mode))throw new y.ErrnoError(43);if(u&2)return 0;var v=G.slice(i,i+l);y.msync(o,v,p,l,u)},varargs:void 0,get(){var i=L[+St.varargs>>2];return St.varargs+=4,i},getp(){return St.get()},getStr(i){var o=on(i);return o},getStreamFromFD(i){var o=y.getStreamChecked(i);return o}},eu=(i,o)=>{var l=0;return Rr().forEach((u,p)=>{var v=o+l;U[i+p*4>>2]=v,Hf(u,v),l+=u.length+1}),0},tu=(i,o)=>{var l=Rr();U[i>>2]=l.length;var u=0;return l.forEach(p=>u+=p.length+1),U[o>>2]=u,0};function ru(i){try{var o=St.getStreamFromFD(i);return y.close(o),0}catch(l){if(typeof y>"u"||l.name!=="ErrnoError")throw l;return l.errno}}var nu=(i,o,l,u)=>{for(var p=0,v=0;v<l;v++){var E=U[o>>2],R=U[o+4>>2];o+=8;var O=y.read(i,k,E,R,u);if(O<0)return-1;if(p+=O,O<R)break;typeof u<"u"&&(u+=O)}return p};function su(i,o,l,u){try{var p=St.getStreamFromFD(i),v=nu(p,o,l);return U[u>>2]=v,0}catch(E){if(typeof y>"u"||E.name!=="ErrnoError")throw E;return E.errno}}var iu=(i,o)=>o+2097152>>>0<4194305-!!i?(i>>>0)+o*4294967296:NaN;function au(i,o,l,u,p){var v=iu(o,l);try{if(isNaN(v))return 61;var E=St.getStreamFromFD(i);return y.llseek(E,v,u),Le=[E.position>>>0,(de=E.position,+Math.abs(de)>=1?de>0?+Math.floor(de/4294967296)>>>0:~~+Math.ceil((de-+(~~de>>>0))/4294967296)>>>0:0)],L[p>>2]=Le[0],L[p+4>>2]=Le[1],E.getdents&&v===0&&u===0&&(E.getdents=null),0}catch(R){if(typeof y>"u"||R.name!=="ErrnoError")throw R;return R.errno}}var ou=(i,o,l,u)=>{for(var p=0,v=0;v<l;v++){var E=U[o>>2],R=U[o+4>>2];o+=8;var O=y.write(i,k,E,R,u);if(O<0)return-1;p+=O,typeof u<"u"&&(u+=O)}return p};function cu(i,o,l,u){try{var p=St.getStreamFromFD(i),v=ou(p,o,l);return U[u>>2]=v,0}catch(E){if(typeof y>"u"||E.name!=="ErrnoError")throw E;return E.errno}}var lu=i=>i,ln=i=>i%4===0&&(i%100!==0||i%400===0),fu=(i,o)=>{for(var l=0,u=0;u<=o;l+=i[u++]);return l},Pi=[31,29,31,30,31,30,31,31,30,31,30,31],ki=[31,28,31,30,31,30,31,31,30,31,30,31],uu=(i,o)=>{for(var l=new Date(i.getTime());o>0;){var u=ln(l.getFullYear()),p=l.getMonth(),v=(u?Pi:ki)[p];if(o>v-l.getDate())o-=v-l.getDate()+1,l.setDate(1),p<11?l.setMonth(p+1):(l.setMonth(0),l.setFullYear(l.getFullYear()+1));else return l.setDate(l.getDate()+o),l}return l},hu=(i,o)=>{k.set(i,o)},du=(i,o,l,u)=>{var p=U[u+40>>2],v={tm_sec:L[u>>2],tm_min:L[u+4>>2],tm_hour:L[u+8>>2],tm_mday:L[u+12>>2],tm_mon:L[u+16>>2],tm_year:L[u+20>>2],tm_wday:L[u+24>>2],tm_yday:L[u+28>>2],tm_isdst:L[u+32>>2],tm_gmtoff:L[u+36>>2],tm_zone:p?on(p):""},E=on(l),R={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var O in R)E=E.replace(new RegExp(O,"g"),R[O]);var P=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],j=["January","February","March","April","May","June","July","August","September","October","November","December"];function Y(I,D,V){for(var J=typeof I=="number"?I.toString():I||"";J.length<D;)J=V[0]+J;return J}function q(I,D){return Y(I,D,"0")}function X(I,D){function V(pe){return pe<0?-1:pe>0?1:0}var J;return(J=V(I.getFullYear()-D.getFullYear()))===0&&(J=V(I.getMonth()-D.getMonth()))===0&&(J=V(I.getDate()-D.getDate())),J}function Z(I){switch(I.getDay()){case 0:return new Date(I.getFullYear()-1,11,29);case 1:return I;case 2:return new Date(I.getFullYear(),0,3);case 3:return new Date(I.getFullYear(),0,2);case 4:return new Date(I.getFullYear(),0,1);case 5:return new Date(I.getFullYear()-1,11,31);case 6:return new Date(I.getFullYear()-1,11,30)}}function he(I){var D=uu(new Date(I.tm_year+1900,0,1),I.tm_yday),V=new Date(D.getFullYear(),0,4),J=new Date(D.getFullYear()+1,0,4),pe=Z(V),ue=Z(J);return X(pe,D)<=0?X(ue,D)<=0?D.getFullYear()+1:D.getFullYear():D.getFullYear()-1}var ge={"%a":I=>P[I.tm_wday].substring(0,3),"%A":I=>P[I.tm_wday],"%b":I=>j[I.tm_mon].substring(0,3),"%B":I=>j[I.tm_mon],"%C":I=>{var D=I.tm_year+1900;return q(D/100|0,2)},"%d":I=>q(I.tm_mday,2),"%e":I=>Y(I.tm_mday,2," "),"%g":I=>he(I).toString().substring(2),"%G":I=>he(I),"%H":I=>q(I.tm_hour,2),"%I":I=>{var D=I.tm_hour;return D==0?D=12:D>12&&(D-=12),q(D,2)},"%j":I=>q(I.tm_mday+fu(ln(I.tm_year+1900)?Pi:ki,I.tm_mon-1),3),"%m":I=>q(I.tm_mon+1,2),"%M":I=>q(I.tm_min,2),"%n":()=>`
`,"%p":I=>I.tm_hour>=0&&I.tm_hour<12?"AM":"PM","%S":I=>q(I.tm_sec,2),"%t":()=>"	","%u":I=>I.tm_wday||7,"%U":I=>{var D=I.tm_yday+7-I.tm_wday;return q(Math.floor(D/7),2)},"%V":I=>{var D=Math.floor((I.tm_yday+7-(I.tm_wday+6)%7)/7);if((I.tm_wday+371-I.tm_yday-2)%7<=2&&D++,D){if(D==53){var J=(I.tm_wday+371-I.tm_yday)%7;J!=4&&(J!=3||!ln(I.tm_year))&&(D=1)}}else{D=52;var V=(I.tm_wday+7-I.tm_yday-1)%7;(V==4||V==5&&ln(I.tm_year%400-1))&&D++}return q(D,2)},"%w":I=>I.tm_wday,"%W":I=>{var D=I.tm_yday+7-(I.tm_wday+6)%7;return q(Math.floor(D/7),2)},"%y":I=>(I.tm_year+1900).toString().substring(2),"%Y":I=>I.tm_year+1900,"%z":I=>{var D=I.tm_gmtoff,V=D>=0;return D=Math.abs(D)/60,D=D/60*100+D%60,(V?"+":"-")+("0000"+D).slice(-4)},"%Z":I=>I.tm_zone,"%%":()=>"%"};E=E.replace(/%%/g,"\0\0");for(var O in ge)E.includes(O)&&(E=E.replace(new RegExp(O,"g"),ge[O](v)));E=E.replace(/\0\0/g,"%");var S=cn(E,!1);return S.length>o?0:(hu(S,i),S.length-1)},pu=(i,o,l,u,p)=>du(i,o,l,u),Ui=(i,o)=>{i<128?o.push(i):o.push(i%128|128,i>>7)},gu=i=>{for(var o={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},l={parameters:[],results:i[0]=="v"?[]:[o[i[0]]]},u=1;u<i.length;++u)l.parameters.push(o[i[u]]);return l},mu=(i,o)=>{var l=i.slice(0,1),u=i.slice(1),p={i:127,p:127,j:126,f:125,d:124,e:111};o.push(96),Ui(u.length,o);for(var v=0;v<u.length;++v)o.push(p[u[v]]);l=="v"?o.push(0):o.push(1,p[l])},vu=(i,o)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(gu(o),i);var l=[1];mu(o,l);var u=[0,97,115,109,1,0,0,0,1];Ui(l.length,u),u.push.apply(u,l),u.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var p=new WebAssembly.Module(new Uint8Array(u)),v=new WebAssembly.Instance(p,{e:{f:i}}),E=v.exports.f;return E},yu=(i,o)=>{if(Pt)for(var l=i;l<i+o;l++){var u=ce(l);u&&Pt.set(u,l)}},Pt,xu=i=>(Pt||(Pt=new WeakMap,yu(0,Dt.length)),Pt.get(i)||0),is=[],Tu=()=>{if(is.length)return is.pop();try{Dt.grow(1)}catch(i){throw i instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":i}return Dt.length-1},as=(i,o)=>{Dt.set(i,o),_r[i]=Dt.get(i)},br=(i,o)=>{var l=xu(i);if(l)return l;var u=Tu();try{as(u,i)}catch(v){if(!(v instanceof TypeError))throw v;var p=vu(i,o);as(u,p)}return Pt.set(i,u),u},Ar=i=>{Pt.delete(ce(i)),as(i,null),is.push(i)};mi=r.InternalError=class extends Error{constructor(o){super(o),this.name="InternalError"}},Rl(),ir=r.BindingError=class extends Error{constructor(o){super(o),this.name="BindingError"}},kl(),Ol(),Hl(),Ri=r.UnboundTypeError=Yl(Error,"UnboundTypeError"),Ql(),tf();var Li=function(i,o,l,u){i||(i=this),this.parent=i,this.mount=i.mount,this.mounted=null,this.id=y.nextInode++,this.name=o,this.mode=l,this.node_ops={},this.stream_ops={},this.rdev=u},fn=365,un=146;Object.defineProperties(Li.prototype,{read:{get:function(){return(this.mode&fn)===fn},set:function(i){i?this.mode|=fn:this.mode&=~fn}},write:{get:function(){return(this.mode&un)===un},set:function(i){i?this.mode|=un:this.mode&=~un}},isFolder:{get:function(){return y.isDir(this.mode)}},isDevice:{get:function(){return y.isChrdev(this.mode)}}}),y.FSNode=Li,y.createPreloadedFile=Zf,y.staticInit();var Eu={B:gl,K:ml,a:yl,j:xl,S:Tl,h:El,oa:wl,d:vl,Ca:Ml,ca:_l,sa:Al,y:Kl,x:Jl,i:Zl,ra:rf,O:sf,t:af,U:cf,o:lf,A:uf,s:hf,T:pf,M:Ef,E:wf,Da:Mf,ua:_f,Ha:Rf,ta:Af,Ja:Jn,Ga:If,Aa:Nf,Ia:Ff,Fa:Of,H:Df,$:$f,ia:Pf,Ka:kf,z:Uf,L:Lf,qa:jf,pa:zf,ka:eu,la:tu,ma:ru,na:su,ba:au,R:cu,G:Iu,w:Ru,W:Xu,P:th,r:Gu,c:Au,b:Mu,n:_u,l:Cu,N:ku,D:Qu,Q:eh,J:rh,aa:lh,k:$u,g:bu,wa:Zu,f:Su,F:Ju,V:Yu,xa:Ku,u:Pu,za:Hu,Ba:Du,e:wu,X:Wu,Ea:Fu,m:Nu,p:Lu,ya:qu,_:ju,C:Uu,v:Vu,Y:zu,q:Ou,I:nh,Z:Bu,ga:ih,da:ch,ha:sh,ea:oh,fa:ah,va:lu,ja:pu},Me=pl(),Mt=i=>(Mt=Me.Oa)(i),os=i=>(os=Me.Pa)(i),ji=i=>(ji=Me.Qa)(i),ne=(i,o)=>(ne=Me.Ra)(i,o),Ir=i=>(Ir=Me.Sa)(i),se=()=>(se=Me.Ta)(),ie=i=>(ie=Me.Ua)(i),Bi=i=>(Bi=Me.Va)(i),Vi=i=>(Vi=Me.Wa)(i),zi=(i,o,l)=>(zi=Me.Xa)(i,o,l),Gi=i=>(Gi=Me.Ya)(i),Hi=r.dynCall_viijii=(i,o,l,u,p,v,E)=>(Hi=r.dynCall_viijii=Me.Za)(i,o,l,u,p,v,E),qi=r.dynCall_viiij=(i,o,l,u,p,v)=>(qi=r.dynCall_viiij=Me._a)(i,o,l,u,p,v),Wi=r.dynCall_vijiii=(i,o,l,u,p,v,E)=>(Wi=r.dynCall_vijiii=Me.$a)(i,o,l,u,p,v,E),Xi=r.dynCall_vijii=(i,o,l,u,p,v)=>(Xi=r.dynCall_vijii=Me.ab)(i,o,l,u,p,v),Yi=r.dynCall_viiji=(i,o,l,u,p,v)=>(Yi=r.dynCall_viiji=Me.bb)(i,o,l,u,p,v);r.dynCall_jiji=(i,o,l,u,p)=>(r.dynCall_jiji=Me.cb)(i,o,l,u,p);var Ki=r.dynCall_jiiii=(i,o,l,u,p)=>(Ki=r.dynCall_jiiii=Me.db)(i,o,l,u,p);r.dynCall_iiiiij=(i,o,l,u,p,v,E)=>(r.dynCall_iiiiij=Me.eb)(i,o,l,u,p,v,E),r.dynCall_iiiiijj=(i,o,l,u,p,v,E,R,O)=>(r.dynCall_iiiiijj=Me.fb)(i,o,l,u,p,v,E,R,O),r.dynCall_iiiiiijj=(i,o,l,u,p,v,E,R,O,P)=>(r.dynCall_iiiiiijj=Me.gb)(i,o,l,u,p,v,E,R,O,P);function wu(i,o,l,u){var p=se();try{ce(i)(o,l,u)}catch(v){if(ie(p),v!==v+0)throw v;ne(1,0)}}function Mu(i,o,l){var u=se();try{return ce(i)(o,l)}catch(p){if(ie(u),p!==p+0)throw p;ne(1,0)}}function _u(i,o,l,u){var p=se();try{return ce(i)(o,l,u)}catch(v){if(ie(p),v!==v+0)throw v;ne(1,0)}}function Ru(i,o,l,u,p,v){var E=se();try{return ce(i)(o,l,u,p,v)}catch(R){if(ie(E),R!==R+0)throw R;ne(1,0)}}function bu(i,o){var l=se();try{ce(i)(o)}catch(u){if(ie(l),u!==u+0)throw u;ne(1,0)}}function Au(i,o){var l=se();try{return ce(i)(o)}catch(u){if(ie(l),u!==u+0)throw u;ne(1,0)}}function Iu(i,o,l,u){var p=se();try{return ce(i)(o,l,u)}catch(v){if(ie(p),v!==v+0)throw v;ne(1,0)}}function Su(i,o,l){var u=se();try{ce(i)(o,l)}catch(p){if(ie(u),p!==p+0)throw p;ne(1,0)}}function Cu(i,o,l,u,p){var v=se();try{return ce(i)(o,l,u,p)}catch(E){if(ie(v),E!==E+0)throw E;ne(1,0)}}function Nu(i,o,l,u,p){var v=se();try{ce(i)(o,l,u,p)}catch(E){if(ie(v),E!==E+0)throw E;ne(1,0)}}function Fu(i,o,l,u,p,v,E){var R=se();try{ce(i)(o,l,u,p,v,E)}catch(O){if(ie(R),O!==O+0)throw O;ne(1,0)}}function Ou(i,o,l,u,p,v,E,R,O,P,j){var Y=se();try{ce(i)(o,l,u,p,v,E,R,O,P,j)}catch(q){if(ie(Y),q!==q+0)throw q;ne(1,0)}}function Du(i,o,l,u,p,v,E){var R=se();try{ce(i)(o,l,u,p,v,E)}catch(O){if(ie(R),O!==O+0)throw O;ne(1,0)}}function $u(i){var o=se();try{ce(i)()}catch(l){if(ie(o),l!==l+0)throw l;ne(1,0)}}function Pu(i,o,l,u){var p=se();try{ce(i)(o,l,u)}catch(v){if(ie(p),v!==v+0)throw v;ne(1,0)}}function ku(i,o,l,u,p,v){var E=se();try{return ce(i)(o,l,u,p,v)}catch(R){if(ie(E),R!==R+0)throw R;ne(1,0)}}function Uu(i,o,l,u,p,v,E){var R=se();try{ce(i)(o,l,u,p,v,E)}catch(O){if(ie(R),O!==O+0)throw O;ne(1,0)}}function Lu(i,o,l,u,p,v){var E=se();try{ce(i)(o,l,u,p,v)}catch(R){if(ie(E),R!==R+0)throw R;ne(1,0)}}function ju(i,o,l,u,p,v,E){var R=se();try{ce(i)(o,l,u,p,v,E)}catch(O){if(ie(R),O!==O+0)throw O;ne(1,0)}}function Bu(i,o,l,u,p,v,E,R,O,P,j,Y,q,X,Z,he,ge,S,I){var D=se();try{ce(i)(o,l,u,p,v,E,R,O,P,j,Y,q,X,Z,he,ge,S,I)}catch(V){if(ie(D),V!==V+0)throw V;ne(1,0)}}function Vu(i,o,l,u,p,v,E,R){var O=se();try{ce(i)(o,l,u,p,v,E,R)}catch(P){if(ie(O),P!==P+0)throw P;ne(1,0)}}function zu(i,o,l,u,p,v,E,R,O,P){var j=se();try{ce(i)(o,l,u,p,v,E,R,O,P)}catch(Y){if(ie(j),Y!==Y+0)throw Y;ne(1,0)}}function Gu(i){var o=se();try{return ce(i)()}catch(l){if(ie(o),l!==l+0)throw l;ne(1,0)}}function Hu(i,o,l,u,p,v){var E=se();try{ce(i)(o,l,u,p,v)}catch(R){if(ie(E),R!==R+0)throw R;ne(1,0)}}function qu(i,o,l,u,p,v,E){var R=se();try{ce(i)(o,l,u,p,v,E)}catch(O){if(ie(R),O!==O+0)throw O;ne(1,0)}}function Wu(i,o,l,u,p){var v=se();try{ce(i)(o,l,u,p)}catch(E){if(ie(v),E!==E+0)throw E;ne(1,0)}}function Xu(i,o,l){var u=se();try{return ce(i)(o,l)}catch(p){if(ie(u),p!==p+0)throw p;ne(1,0)}}function Yu(i,o,l,u,p){var v=se();try{ce(i)(o,l,u,p)}catch(E){if(ie(v),E!==E+0)throw E;ne(1,0)}}function Ku(i,o,l,u,p,v,E,R,O){var P=se();try{ce(i)(o,l,u,p,v,E,R,O)}catch(j){if(ie(P),j!==j+0)throw j;ne(1,0)}}function Ju(i,o,l,u,p,v){var E=se();try{ce(i)(o,l,u,p,v)}catch(R){if(ie(E),R!==R+0)throw R;ne(1,0)}}function Zu(i,o,l,u){var p=se();try{ce(i)(o,l,u)}catch(v){if(ie(p),v!==v+0)throw v;ne(1,0)}}function Qu(i,o,l,u,p,v,E){var R=se();try{return ce(i)(o,l,u,p,v,E)}catch(O){if(ie(R),O!==O+0)throw O;ne(1,0)}}function eh(i,o,l,u,p,v,E,R){var O=se();try{return ce(i)(o,l,u,p,v,E,R)}catch(P){if(ie(O),P!==P+0)throw P;ne(1,0)}}function th(i,o,l,u){var p=se();try{return ce(i)(o,l,u)}catch(v){if(ie(p),v!==v+0)throw v;ne(1,0)}}function rh(i,o,l,u,p,v,E,R,O,P,j,Y){var q=se();try{return ce(i)(o,l,u,p,v,E,R,O,P,j,Y)}catch(X){if(ie(q),X!==X+0)throw X;ne(1,0)}}function nh(i,o,l,u,p,v,E,R,O,P,j,Y,q,X,Z,he){var ge=se();try{ce(i)(o,l,u,p,v,E,R,O,P,j,Y,q,X,Z,he)}catch(S){if(ie(ge),S!==S+0)throw S;ne(1,0)}}function sh(i,o,l,u,p,v,E){var R=se();try{Hi(i,o,l,u,p,v,E)}catch(O){if(ie(R),O!==O+0)throw O;ne(1,0)}}function ih(i,o,l,u,p,v){var E=se();try{qi(i,o,l,u,p,v)}catch(R){if(ie(E),R!==R+0)throw R;ne(1,0)}}function ah(i,o,l,u,p,v,E){var R=se();try{Wi(i,o,l,u,p,v,E)}catch(O){if(ie(R),O!==O+0)throw O;ne(1,0)}}function oh(i,o,l,u,p,v){var E=se();try{Xi(i,o,l,u,p,v)}catch(R){if(ie(E),R!==R+0)throw R;ne(1,0)}}function ch(i,o,l,u,p,v){var E=se();try{Yi(i,o,l,u,p,v)}catch(R){if(ie(E),R!==R+0)throw R;ne(1,0)}}function lh(i,o,l,u,p){var v=se();try{return Ki(i,o,l,u,p)}catch(E){if(ie(v),E!==E+0)throw E;ne(1,0)}}r.addFunction=br,r.removeFunction=Ar;var hn;rt=function i(){hn||Ji(),hn||(rt=i)};function Ji(){if(Ve>0||(Te(),Ve>0))return;function i(){hn||(hn=!0,r.calledRun=!0,!z&&(_e(),n(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),ke()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),i()},1)):i()}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return Ji(),e.ready}})();const yt="EXT_mesh_manifold",ba="MERGE";class ui extends $e{static EXTENSION_NAME=yt;init(){ui.EXTENSION_NAME=yt,this.propertyType="ManifoldPrimitive",this.parentTypes=[W.MESH]}getDefaults(){return Object.assign(super.getDefaults(),{manifoldPrimitive:null,mergeIndices:null,mergeValues:null})}getMergeIndices(){return this.getRef("mergeIndices")}getMergeValues(){return this.getRef("mergeValues")}setMerge(e,r){if(e.getCount()!==r.getCount())throw new Error("merge vectors must be the same length.");return this.setRef("mergeIndices",e),this.setRef("mergeValues",r)}getRunIndex(){return this.get("runIndex")}setRunIndex(e){return this.set("runIndex",e)}setIndices(e){return this.setRef("indices",e)}getIndices(){return this.getRef("indices")}}class nl extends Ie{extensionName=yt;prewriteTypes=[W.ACCESSOR];static EXTENSION_NAME=yt;createManifoldPrimitive(){return new ui(this.document.getGraph())}read(e){const{json:r}=e.jsonDoc;return(r.meshes||[]).forEach((s,a)=>{if(!s.extensions||!s.extensions[yt])return;const c=e.meshes[a],f=this.createManifoldPrimitive();c.setExtension(yt,f);const h=s.extensions[yt];if(h.manifoldPrimitive){let d=0;const g=[];g.push(d);for(const x of c.listPrimitives()){const w=x.getIndices();if(!w){console.log("Skipping non-indexed primitive ",x.getName());continue}d+=w.getCount(),g.push(d)}f.setRunIndex(g),f.setIndices(e.accessors[h.manifoldPrimitive.indices])}h.mergeIndices!=null&&h.mergeValues!=null&&f.setMerge(e.accessors[h.mergeIndices],e.accessors[h.mergeValues])}),this}prewrite(e){return this.document.getRoot().listMeshes().forEach(r=>{const n=r.getExtension(yt);if(!n)return;const s=n.getIndices();e.addAccessorToUsageGroup(s,ut.BufferViewUsage.ELEMENT_ARRAY_BUFFER);const a=n.getMergeIndices(),c=n.getMergeValues();!a||!c||(e.addAccessorToUsageGroup(a,ba),e.addAccessorToUsageGroup(c,ba))}),this}write(e){const{json:r}=e.jsonDoc;return this.document.getRoot().listMeshes().forEach(n=>{const s=n.getExtension(yt);if(!s)return;const a=e.meshIndexMap.get(n),c=r.meshes[a],f=s.getRunIndex(),h=f.length-1;if(h!==c.primitives.length)throw new Error("The number of primitives must be exactly one less than the length of runIndex.");const d=e.accessorIndexMap.get(s.getMergeIndices()),g=e.accessorIndexMap.get(s.getMergeValues()),x=r.accessors[d],w=r.accessors[g],M=c.primitives[0],A={indices:e.accessorIndexMap.get(s.getIndices()),mode:M.mode,attributes:{POSITION:M.attributes.POSITION}},F=r.accessors[A.indices];if(F){x&&w&&(F.sparse={count:x.count,indices:{bufferView:x.bufferView,byteOffset:x.byteOffset,componentType:x.componentType},values:{bufferView:w.bufferView,byteOffset:w.byteOffset}});for(let m=0;m<h;++m){const C=r.accessors[c.primitives[m].indices];C.bufferView=F.bufferView,C.byteOffset=F.byteOffset+4*f[m],C.count=f[m+1]-f[m]}c.extensions=c.extensions||{},c.extensions[yt]={manifoldPrimitive:A,mergeIndices:d,mergeValues:g}}}),this}}const Fr={POSITION:{type:te.Type.VEC3,components:3},NORMAL:{type:te.Type.VEC3,components:3},TANGENT:{type:te.Type.VEC4,components:4},TEXCOORD_0:{type:te.Type.VEC2,components:2},TEXCOORD_1:{type:te.Type.VEC2,components:2},COLOR_0:{type:te.Type.VEC3,components:3},JOINTS_0:{type:te.Type.VEC4,components:4},WEIGHTS_0:{type:te.Type.VEC4,components:4},SKIP_1:{type:null,components:1},SKIP_2:{type:null,components:2},SKIP_3:{type:null,components:3},SKIP_4:{type:null,components:4}};function sv(t){return t.registerExtensions([nl])}function Aa(t,e,r){t.getRoot().listBuffers().length===0&&t.createBuffer();const n=t.getRoot().listBuffers()[0],s=t.createExtension(nl),a=t.createMesh(),c=[],f=[],h=new Map,d=e.runIndex.length-1;let g=-1;for(let _=0;_<d;++_){const b=e.runOriginalID[_];if(b==g)continue;g=b,c.push(e.runIndex[_]);const N=t.createAccessor("primitive indices of ID "+b).setBuffer(n).setType(te.Type.SCALAR).setArray(new Uint32Array(1)),$=t.createPrimitive().setIndices(N),z=r.get(b);if(z){const{material:B,attributes:k}=z;if(k.length<1||k[0]!=="POSITION")throw new Error('First attribute must be "POSITION".');$.setMaterial(B),h.set($,k),z.attributes.forEach((G,H)=>{if(H>=f.length)f.push(G);else{const K=Fr[G].components,L=Fr[f[H]].components;if(K!=L)throw new Error("Attribute sizes do not correspond: "+G+" and "+f[H]);Fr[f[H]].type==null&&(f[H]=G)}})}else h.set($,["POSITION"]);a.addPrimitive($)}c.push(e.runIndex[d]);const x=e.numVert,w=e.numProp;let M=0;f.forEach((_,b)=>{const N=Fr[_];if(N==null)throw new Error(_+" is not a recognized attribute.");if(N.type==null){++M;return}const $=N.components;if(M+$>w)throw new Error("Too many attribute channels.");const z=new Float32Array($*x);for(let k=0;k<x;++k)for(let G=0;G<$;++G){let H=e.vertProperties[w*k+M+G];_=="COLOR_0"&&(H=Math.max(0,Math.min(1,H))),z[$*k+G]=H}const B=t.createAccessor(_).setBuffer(n).setType(N.type).setArray(z);for(const k of a.listPrimitives()){const G=h.get(k);G.length>b&&Fr[G[b]].type!=null&&k.setAttribute(_,B)}M+=$});const A=s.createManifoldPrimitive();a.setExtension("EXT_mesh_manifold",A);const F=t.createAccessor("manifold indices").setBuffer(n).setType(te.Type.SCALAR).setArray(e.triVerts);A.setIndices(F),A.setRunIndex(c);const m=[...Array(e.numVert).keys()],C=[],T=[];if(e.mergeFromVert&&e.mergeToVert){for(const[_,b]of e.mergeFromVert.entries())m[b]=e.mergeToVert[_];for(const[_,b]of e.triVerts.entries()){const N=m[b];b!==N&&(C.push(_),T.push(N))}}if(C.length>0){const _=t.createAccessor("merge from").setBuffer(n).setType(te.Type.SCALAR).setArray(new Uint32Array(C)),b=t.createAccessor("merge to").setBuffer(n).setType(te.Type.SCALAR).setArray(new Uint32Array(T));A.setMerge(_,b)}return a}const ot=await nv();ot.setup();Ho(Array);const sl=sv(new Oh);sl.registerExtensions(Do);const iv=["cube","cylinder","sphere","tetrahedron","extrude","revolve","compose","union","difference","intersection","levelSet","smooth","ofMesh","hull"],av=["add","subtract","intersect","decompose","warp","transform","translate","rotate","scale","mirror","refine","setProperties","asOriginal","trimByPlane","split","splitByPlane","hull"],ov=["square","circle","union","difference","intersection","compose","ofPolygons","hull"],cv=["add","subtract","intersect","rectClip","decompose","transform","translate","rotate","scale","mirror","simplify","offset","hull"],il=["show","only","setMaterial"],lv=["setMinCircularAngle","setMinCircularEdgeLength","setCircularSegments","getCircularSegments","Mesh","GLTFNode","Manifold","CrossSection"],Ia=il.concat(lv),Cn=new Array;function Ln(t,e,r){const n=ot[t],s=r?n:n.prototype;for(const a of e)if(a!="cylinder"){const c=s[a];s[a]=function(...f){const h=c(...f);return Cn.push(h),h}}}Ln("Manifold",av,!1);Ln("Manifold",iv,!0);Ln("CrossSection",cv,!1);Ln("CrossSection",ov,!0);for(const t of il){const e=ot[t];ot[t]=function(...r){const n=e(...r);return Cn.push(n),n}}ot.cleanup=function(){for(const t of Cn)if(t instanceof Array)for(const e of t)e.delete();else t.delete();Cn.length=0};let hi=!1;const Nn=new Map,di=new Map,fv=30,al={roughness:.2,metallic:1,baseColorFactor:[1,1,0],alpha:1,unlit:!1,animationLength:1,animationMode:"loop"},uv={baseColorFactor:[1,0,0],alpha:.25,roughness:1,metallic:0},hv={baseColorFactor:[.5,.5,.5],alpha:.25,roughness:1,metallic:0},Kt=new Array,Fn=new Map,wn=new Map,Qt=new Map;let Wr=1,On,Dn,Fs;function dv(){hi=!1,Nn.clear(),di.clear(),Kt.length=0,Fn.clear(),wn.clear(),Qt.clear(),Wr=1}class pv{_parent;manifold;translation;rotation;scale;material;name;constructor(e){this._parent=e,Kt.push(this)}clone(e){const r={...this};return r._parent=e,Kt.push(r),r}get parent(){return this._parent}}ot.GLTFNode=pv;const hr={...al};ot.setMaterial=(t,e)=>{const r=t.asOriginal();return Fn.set(r.originalID(),e),r};function ol(t,e){let r=t.asOriginal();return e.set(r.originalID(),r.getMesh()),r}ot.show=t=>ol(t,Nn);ot.only=t=>(hi=!0,ol(t,di));self.postMessage(null);if(self.console){const t=self.console.log;self.console.log=function(...e){let r="";for(const n of e)n==null?r+="undefined":typeof n=="object"?r+=JSON.stringify(n,null,4):r+=n.toString();self.postMessage({log:r}),t(...e)}}function dr(...t){self.console&&self.console.log(...t)}self.onmessage=async t=>{const e=`const globalDefaults = {};
`+t.data+`
return exportModels(globalDefaults, typeof result === "undefined" ? undefined : result);
`;try{await new Function("exportModels","glMatrix","module",...Ia,e)(xv,rl,ot,...Ia.map(n=>ot[n]))}catch(r){console.log(r.toString()),self.postMessage({objectURL:null})}finally{ot.cleanup(),dv()}};function cl(t){const{quat:e}=rl,r=Math.PI/180,n=e.create();return e.rotateZ(n,n,r*t[2]),e.rotateY(n,n,r*t[1]),e.rotateX(n,n,r*t[0]),n}function ps(t,e,r,n){const s=r[e];if(s==null)return null;if(typeof s!="function")return s;const a=Dn.getCount(),c=e=="rotation"?4:3,f=new Float32Array(c*a);for(let x=0;x<a;++x){const w=x/(a-1),M=s(hr.animationMode!=="ping-pong"?w:(1-Math.cos(w*2*Math.PI))/2);f.set(c===4?cl(M):M,c*x)}const h=t.createAccessor(r.name+" "+e+" frames").setBuffer(t.getRoot().listBuffers()[0]).setArray(f).setType(c===4?te.Type.VEC4:te.Type.VEC3),d=t.createAnimationSampler().setInput(Dn).setOutput(h).setInterpolation("LINEAR"),g=t.createAnimationChannel().setTargetPath(e).setTargetNode(n).setSampler(d);return On.addSampler(d),On.addChannel(g),Fs=!0,s(0)}function gv(t,e){const r=t.createNode(e.name),n=ps(t,"translation",e,r);n!=null&&r.setTranslation(n);const s=ps(t,"rotation",e,r);s!=null&&r.setRotation(cl(s));const a=ps(t,"scale",e,r);return a!=null&&r.setScale(a),r}function ll(t){return t==null?{}:(t.material==null&&(t.material=ll(t.parent)),t.material)}function mv(t,e={}){const r={...hr};Object.assign(r,e);const{roughness:n,metallic:s,baseColorFactor:a,alpha:c,unlit:f}=r,h=t.createMaterial(e.name??"");if(f){const d=t.createExtension(Zs).createUnlit();h.setExtension("KHR_materials_unlit",d)}return c<1&&h.setAlphaMode(yr.AlphaMode.BLEND).setDoubleSided(!0),h.setRoughnessFactor(n).setMetallicFactor(s).setBaseColorFactor([...a,c])}function $n(t,e){return wn.has(e)||wn.set(e,mv(t,e)),wn.get(e)}function fl(t,e,r,n,s={}){const a=n.numTri();if(a==0){dr("Empty manifold, skipping.");return}dr(`Triangles: ${a.toLocaleString()}`);const c=n.boundingBox(),f=[0,0,0];for(let w=0;w<3;w++)f[w]=Math.round((c.max[w]-c.min[w])*10)/10;dr(`Bounding Box: X = ${f[0].toLocaleString()} mm, Y = ${f[1].toLocaleString()} mm, Z = ${f[2].toLocaleString()} mm`);const h=Math.round(n.getProperties().volume/10);dr(`Genus: ${n.genus().toLocaleString()}, Volume: ${(h/100).toLocaleString()} cm^3`);const d=n.getMesh(),g=new Map;for(const w of d.runOriginalID){const M=Fn.get(w)||s;g.set(w,{material:$n(t,hi?hv:M),attributes:["POSITION",...M.attributes??[]]})}r.setMesh(Aa(t,d,g));const x=d.numProp===3?d.vertProperties:new Float32Array(d.numVert*3);if(d.numProp>3)for(let w=0;w<d.numVert;++w)for(let M=0;M<3;++M)x[w*3+M]=d.vertProperties[w*d.numProp+M];Qt.set(n,Wr),e.meshes.push({vertices:x,indices:d.triVerts,id:`${Wr++}`});for(const[w,M]of d.runOriginalID.entries()){const A=Nn.has(M),F=A?Nn.get(M):di.get(M);if(F==null)continue;g.get(M).material=$n(t,A?uv:Fn.get(M)||s);const m=t.createNode("debug").setMesh(Aa(t,F,g)).setMatrix(d.transform(w));r.addChild(m)}}function ul(t,e){t.setMesh(e.getMesh()),e.listChildren().forEach(r=>{const n=r.clone();t.addChild(n)})}function vv(t,e,r,n,s){ul(e,r);const a=t.createMesh();e.setMesh(a),r.getMesh().listPrimitives().forEach(c=>{const f=c.clone();c.getMaterial()===s&&f.setMaterial(n),a.addPrimitive(f)})}function yv(t,e,r,n){const s=gv(t,r),{manifold:a}=r;if(a!=null){const c=ll(r),f=n.get(a);if(f==null){fl(t,e,s,a,c);const h=new Map;h.set(c,s),n.set(a,h)}else{const h=f.get(c);if(h==null){const[d,g]=f.entries().next().value;vv(t,s,g,$n(t,c),$n(t,d)),f.set(c,s)}else ul(s,h)}}return Qt.set(r,Wr),e.components.push({id:`${Wr++}`,name:r.name,children:a==null?[]:[{objectID:`${Qt.get(a)}`}]}),s}async function xv(t,e){Object.assign(hr,al),Object.assign(hr,t);const r=new ks,n=Math.sqrt(2)/2,s=1/1e3,a=r.createNode("wrapper").setRotation([-n,0,0,n]).setScale([s,s,s]);r.createScene().addChild(a),On=r.createAnimation(""),Fs=!1;const c=Math.round(hr.animationLength*fv)+1,f=new Float32Array(c);for(let m=0;m<c;++m)f[m]=m*hr.animationLength/(c-1);Dn=r.createAccessor("animation times").setBuffer(r.createBuffer()).setArray(f).setType(te.Type.SCALAR);const h={meshes:[],components:[],items:[],precision:7,header:{unit:"millimeter",title:"ManifoldCAD.org model",description:"ManifoldCAD.org model",application:"ManifoldCAD.org"}};if(Kt.length>0){const m=new Map,C=new Map;let T=0;for(const _ of Kt)m.set(_,yv(r,h,_,C)),_.manifold&&++T;for(const _ of Kt){const b=m.get(_),N={objectID:`${Qt.get(_)}`,transform:b.getMatrix()},{parent:$}=_;$==null?(a.addChild(b),h.items.push(N)):(m.get($).addChild(b),h.components.find(B=>B.id==`${Qt.get($)}`).children.push(N))}dr("Total glTF nodes: ",Kt.length,", Total mesh references: ",T)}else{if(e==null){dr('No output because "result" is undefined and no "GLTFNode"s were created.');return}const m=r.createNode();fl(r,h,m,e),a.addChild(m),h.items.push({objectID:`${Qt.get(e)}`})}Fs||(Dn.dispose(),On.dispose());const d=await sl.writeBinary(r),g=new Blob([d],{type:"application/octet-stream"}),x=new Cd;x.add3dModel("3D/3dmodel.model");const w=Sd(h),M={};M["3D/3dmodel.model"]=zr(w),M[xa.name]=zr(xa.content),M[x.name]=zr(x.content);const A=Hd(M),F=new Blob([A],{type:"application/vnd.ms-package.3dmanufacturing-3dmodel+xml"});self.postMessage({glbURL:URL.createObjectURL(g),threeMFURL:URL.createObjectURL(F)})}
