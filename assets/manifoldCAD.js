import"./modulepreload-polyfill.js";function te(){return new Worker("/assets/worker-ea100c6b.js",{type:"module"})}const h=self.examples.functionBodies;navigator.serviceWorker&&navigator.serviceWorker.register("/service-worker.js",{scope:"./index.html"});let l;const ne=document.querySelector("#file"),m=document.querySelector("#current"),N=document.querySelector("#file .uparrow"),U=document.querySelector("#fileDropdown"),I=document.querySelector("#save"),w=document.querySelector("#saveDropdown"),x=document.querySelector("#save .uparrow"),oe=function(){U.classList.remove("show"),w.classList.remove("show"),N.classList.remove("down"),x.classList.remove("down")},le=function(e){e.stopPropagation(),U.classList.toggle("show"),N.classList.toggle("down")},ce=function(e){e.stopPropagation(),w.classList.toggle("show"),x.classList.toggle("down")};ne.onclick=le;x.parentElement.onclick=ce;document.body.onclick=oe;const y="ManifoldCAD";function L(e){return window.localStorage.getItem(y+e)}function g(e,t){window.localStorage.setItem(y+e,t)}function j(e){window.localStorage.removeItem(y+e)}function ie(e){if(e>=window.localStorage.length)return;const t=window.localStorage.key(e);if(t.startsWith(y))return t.slice(y.length)}function k(){if(l){const e=m.textContent;h.get(e)||g(e,l.getValue())}}window.onpagehide=k;window.beforeunload=k;let M=!1,O=!0;function D(e){if(l){M=!0,m.textContent=e,g("currentName",e);const t=h.get(e)??L(e)??"";O=h.get(e)!=null,l.setValue(t)}}function R(e){const t=document.createElement("div");t.classList.add("item");const n=document.createElement("button");t.appendChild(n),n.type="button",n.classList.add("blue","item");const o=document.createElement("span");return n.appendChild(o),o.textContent=e,n.onclick=function(){k(),D(o.textContent)},n.onkeyup=function(c){c.preventDefault()},n}function P(e){const t=document.createElement("button");return t.classList.add("icon"),e.parentElement.appendChild(t),t}function z(e){let t=1,n=e;for(;L(n)!=null||h.get(n)!=null;)n=e+" "+t++;return n}function V(e){const t=e.firstChild,n=P(e);n.classList.add("edit"),n.onclick=function(f){f.stopPropagation();const s=t.textContent,_=L(s),v=document.createElement("form"),a=document.createElement("input");a.classList.add("name"),a.value=s,t.textContent="",e.appendChild(v),v.appendChild(a),a.focus(),a.setSelectionRange(0,s.length);function ee(){const b=a.value;if(a.blur(),!b)return;const E=z(b);t.textContent=E,m.textContent==s&&(m.textContent=E),j(s),g(E,_)}v.onsubmit=ee,a.onclick=function(b){b.stopPropagation()},a.onblur=function(){e.removeChild(v),t.textContent=s}};const o=P(e);o.classList.add("trash");let c=0;o.onclick=function(f){if(f.stopPropagation(),e.classList.contains("blue"))c=performance.now(),e.classList.remove("blue"),e.classList.add("red"),document.body.addEventListener("click",function(){e.classList.add("blue"),e.classList.remove("red")},{once:!0});else if(performance.now()-c>500){j(t.textContent),m.textContent==t.textContent&&D("Intro");const s=e.parentElement;s.parentElement.removeChild(s)}}}const A=document.querySelector("#new");function H(e){const t=z("New Script");g(t,e);const n=R(t);A.insertAdjacentElement("afterend",n.parentElement),V(n),n.click()}A.onclick=function(){H("")};const r=document.querySelector("#compile"),K=document.querySelector("#poster");let q=!1,G=!0;function J(){r.disabled=!1,G?r.click():K.textContent="Auto-run disabled due to prior failure"}let F;async function re(){const e=await fetch("/manifold-global-types.d.ts").then(n=>n.text()),t=await fetch("/manifold-encapsulated-types.d.ts").then(n=>n.text());return`
${e.replaceAll("export","")}
${t.replace(/^import.*$/gm,"").replaceAll("export","declare")}
declare interface ManifoldToplevel {
  CrossSection: typeof T.CrossSection;
  Manifold: typeof T.Manifold;
  Mesh: typeof T.Mesh;
  triangulate: typeof T.triangulate;
  setMinCircularAngle: typeof T.setMinCircularAngle;
  setMinCircularEdgeLength: typeof T.setMinCircularEdgeLength;
  setCircularSegments: typeof T.setCircularSegments;
  getCircularSegments: typeof T.getCircularSegments;
  setup: () => void;
}
declare const module: ManifoldToplevel;
`}async function se(){return`${(await fetch("/editor.d.ts").then(t=>t.text())).replace(/^import.*$/gm,"")}`}require.config({paths:{vs:"https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min/vs"}});require(["vs/editor/editor.main"],async function(){monaco.languages.typescript.typescriptDefaults.addExtraLib(await re()),monaco.languages.typescript.typescriptDefaults.addExtraLib(await se()),l=monaco.editor.create(document.getElementById("editor"),{language:"typescript",automaticLayout:!0}),F=await(await monaco.languages.typescript.getTypeScriptWorker())(l.getModel().uri),l.getModel().updateOptions({tabSize:2});for(const[n]of h){const o=R(n);U.appendChild(o.parentElement)}let t=m.textContent;for(let n=0;n<window.localStorage.length;n++){const o=ie(n);if(o)if(o==="currentName")t=L(o);else if(o==="safe")G=L(o)!=="false";else{const c=R(o);A.insertAdjacentElement("afterend",c.parentElement),V(c)}}D(t),q&&J(),l.onDidChangeModelContent(n=>{if(r.disabled=!1,M){M=!1;return}if(O){const o=l.getPosition();H(l.getValue()),l.setPosition(o)}}),window.onresize=()=>{l.layout({})}});const u=document.querySelector("model-viewer"),ae=document.querySelector("#animation"),C=document.querySelector("#play"),p=document.querySelector("#scrubber");let B=!1;u.addEventListener("load",()=>{const e=u.availableAnimations.length>0;ae.style.display=e?"flex":"none",e&&Q()});function Q(){u.play(),C.classList.remove("play"),C.classList.add("pause"),B=!1,p.classList.add("hide")}function ue(){u.pause(),C.classList.remove("pause"),C.classList.add("play"),B=!0,p.max=u.duration,p.value=u.currentTime,p.classList.remove("hide")}C.onclick=function(){B?Q():ue()};p.oninput=function(){u.currentTime=p.value};const d=document.querySelector("#console"),de=console.log;console.log=function(e){d.textContent+=e+`\r
`,d.scrollTop=d.scrollHeight,de(e)};function fe(){d.textContent=""}function me(){r.firstChild.style.visibility="hidden",r.classList.add("red","cancel")}function pe(){r.firstChild.style.visibility="visible",r.classList.remove("red","cancel")}let X=performance.now();function Y(){pe();const e=performance.now(),t=d.textContent;d.textContent=t.substring(t.indexOf(`
`)+1),console.log(`Took ${(Math.round((e-X)/10)/100).toLocaleString()} seconds`)}const i={glbURL:null,threeMFURL:null};let S=null;function W(){S=new te,S.onmessage=function(e){if(e.data==null){F!=null&&!q&&J(),q=!0;return}if(e.data.log!=null){d.textContent+=e.data.log+`\r
`,d.scrollTop=d.scrollHeight;return}Y(),r.disabled=!0,i.threeMFURL!=null&&(URL.revokeObjectURL(i.threeMFURL),i.threeMFURL=null),URL.revokeObjectURL(i.glbURL),i.glbURL=e.data.glbURL,i.threeMFURL=e.data.threeMFURL,T.disabled=i.threeMFURL==null,u.src=i.glbURL,i.glbURL==null?(u.showPoster(),K.textContent="Error",W()):g("safe","true")}}W();async function ge(){k(),g("safe","false"),me(),fe(),console.log("Running...");const e=await F.getEmitOutput(l.getModel().uri.toString());S.postMessage(e.outputFiles[0].text),X=performance.now()}function we(){S.terminate(),W(),Y(),console.log("Run canceled")}r.onclick=function(){r.classList.contains("cancel")?we():ge()};function Z(e,t,n){const o=e.parentElement;return()=>{const c=I.firstElementChild;c!==o&&(w.insertBefore(c,w.firstElementChild),I.insertBefore(o,w),o.appendChild(x.parentElement));const f=document.createElement("a");f.download=t,f.href=i[n],f.click()}}const $=document.querySelector("#glb");$.onclick=Z($,"manifold.glb","glbURL");const T=document.querySelector("#threemf");T.onclick=Z(T,"manifold.3mf","threeMFURL");
